



<!doctype html>
<html lang="ja" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="クリップボードへコピー">
      
        <meta name="lang:clipboard.copied" content="コピーしました">
      
        <meta name="lang:search.language" content="jp">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="何も見つかりませんでした">
      
        <meta name="lang:search.result.one" content="1件見つかりました">
      
        <meta name="lang:search.result.other" content="#件見つかりました">
      
        <meta name="lang:search.tokenizer" content="[\s\-　、。，．]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.1.2">
    
    
      
        <title>とりあえず触ってみる - Terraformで構築するAWS</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.3020aac5.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.224b79ff.css">
      
      
        
        
        <meta name="theme-color" content="#546e7a">
      
    
    
      <script src="../../assets/javascripts/modernizr.01ccdecf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../assets/custom.css">
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="blue-grey" data-md-color-accent="blue-grey">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#_1" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Terraformで構築するAWS" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Terraformで構築するAWS
            </span>
            <span class="md-header-nav__topic">
              とりあえず触ってみる
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="検索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            検索キーワードを入力してください
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="Terraformで構築するAWS" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Terraformで構築するAWS
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      はじめてのTerraform
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        はじめてのTerraform
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../about/" title="Terraformとは" class="md-nav__link">
      Terraformとは
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../preparation/" title="環境を準備する" class="md-nav__link">
      環境を準備する
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        とりあえず触ってみる
      </label>
    
    <a href="./" title="とりあえず触ってみる" class="md-nav__link md-nav__link--active">
      とりあえず触ってみる
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">目次</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" title="準備" class="md-nav__link">
    準備
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hcl" title="HCLを書く" class="md-nav__link">
    HCLを書く
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#provider" title="provider" class="md-nav__link">
    provider
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource" title="resource" class="md-nav__link">
    resource
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#resource_1" title="resourceの定義と命名" class="md-nav__link">
    resourceの定義と命名
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" title="リソースのプロパティ" class="md-nav__link">
    リソースのプロパティ
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#terraform" title="Terraformの実行" class="md-nav__link">
    Terraformの実行
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" title="初期化" class="md-nav__link">
    初期化
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" title="適用" class="md-nav__link">
    適用
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" title="リソースの変更を行う" class="md-nav__link">
    リソースの変更を行う
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#terraform_1" title="Terraformが管理しているリソース" class="md-nav__link">
    Terraformが管理しているリソース
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" title="削除する" class="md-nav__link">
    削除する
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      ハンズオン
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        ハンズオン
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../handson/about/" title="概要" class="md-nav__link">
      概要
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../handson/vpc/" title="VPC" class="md-nav__link">
      VPC
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../handson/alb/" title="ALB" class="md-nav__link">
      ALB
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../handson/ecs/" title="ECS" class="md-nav__link">
      ECS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../handson/https/" title="https化" class="md-nav__link">
      https化
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../handson/syntax/" title="シンタックスの活用" class="md-nav__link">
      シンタックスの活用
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      laravelを動かす
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        laravelを動かす
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../laravel/about/" title="概要" class="md-nav__link">
      概要
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../laravel/docker-compose/" title="docker-composeの起動" class="md-nav__link">
      docker-composeの起動
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../laravel/rds/" title="RDS" class="md-nav__link">
      RDS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../laravel/ecr/" title="ECR" class="md-nav__link">
      ECR
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../laravel/ecs/" title="ECS" class="md-nav__link">
      ECS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../laravel/cleanup/" title="片付け" class="md-nav__link">
      片付け
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../next-step/" title="Next Step" class="md-nav__link">
      Next Step
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">目次</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" title="準備" class="md-nav__link">
    準備
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hcl" title="HCLを書く" class="md-nav__link">
    HCLを書く
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#provider" title="provider" class="md-nav__link">
    provider
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource" title="resource" class="md-nav__link">
    resource
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#resource_1" title="resourceの定義と命名" class="md-nav__link">
    resourceの定義と命名
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" title="リソースのプロパティ" class="md-nav__link">
    リソースのプロパティ
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#terraform" title="Terraformの実行" class="md-nav__link">
    Terraformの実行
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" title="初期化" class="md-nav__link">
    初期化
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" title="適用" class="md-nav__link">
    適用
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" title="リソースの変更を行う" class="md-nav__link">
    リソースの変更を行う
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#terraform_1" title="Terraformが管理しているリソース" class="md-nav__link">
    Terraformが管理しているリソース
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" title="削除する" class="md-nav__link">
    削除する
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>とりあえず触ってみる</h1>
                
                <p><img alt="vpc" src="../imgs/handson-vpc.png" /></p>
<p>まずはTerraformを使ってみましょう。<br />
この章ではVPCの起動することを目標に、よく使用されるシンタックスを学んでいきます。</p>
<h2 id="_1">準備<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>新しいTerminalを立ち上げ、以下のコマンドでこの章用のディレクトリを作成し、作成したディレクトリに移動してください。  </p>
<div class="codehilite"><pre><span></span><span class="gp">$</span> <span class="nb">cd</span> ~/Desktop/terraform-handson
<span class="gp">$</span> mkdir vpc-handson
<span class="gp">$</span> <span class="nb">cd</span> vpc-handson
</pre></div>


<p>Terraformを立ち上げているTerminalにもディレクトリが作成されていることを確認します。</p>
<div class="codehilite"><pre><span></span><span class="gp">#</span> ls
<span class="go">vpc-handson</span>
</pre></div>


<h2 id="hcl">HCLを書く<a class="headerlink" href="#hcl" title="Permanent link">&para;</a></h2>
<p>VPCを立ち上げるためのコードを書きます。<br />
以下のコードを <code>main.tf</code> の命名で <code>vpc-handson/</code> 配下に作成してください。</p>
<div class="codehilite"><pre><span></span><span class="n">provider</span> <span class="s2">&quot;aws&quot;</span> <span class="p">{</span>
  <span class="n">region</span> <span class="o">=</span> <span class="s2">&quot;ap-northeast-1&quot;</span>
<span class="p">}</span>

<span class="n">resource</span> <span class="s2">&quot;aws_vpc&quot;</span> <span class="s2">&quot;main&quot;</span> <span class="p">{</span>
  <span class="n">cidr_block</span> <span class="o">=</span> <span class="s2">&quot;10.0.0.0/16&quot;</span>

  <span class="n">tags</span> <span class="o">=</span> <span class="p">{</span>
    <span class="no">Name</span> <span class="o">=</span> <span class="s2">&quot;vpc-handson&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>今回は <code>provider</code> と <code>resource</code> の2つを定義しました。</p>
<h3 id="provider">provider<a class="headerlink" href="#provider" title="Permanent link">&para;</a></h3>
<p>providerはその名の通りプロバイダの定義を行います。<br />
今回はAWSを使用したいため <code>aws</code> と宣言していますが、他にも <code>gcp</code> や <code>azure</code> など様々なプロバイダが用意されています。</p>
<p>また、providerブロック内で <code>region = "ap-northeast-1"</code> と定義しています。<br />
ここで指定したリージョンにVPCやEC2などの各種リソースを作成します。<br />
今回は"ap-northeast-1"(東京リージョン)を指定します。</p>
<h3 id="resource">resource<a class="headerlink" href="#resource" title="Permanent link">&para;</a></h3>
<p>resourceはVPCやEC2のような起動したいリソースを定義します。<br />
今回はコードへVPCを定義しました。これを実行することで <strong>「vpc-handsonという名前でCIDRが10.0.0.0/16のVPC」</strong> が作成されます。  </p>
<p>記述したコードがどのような意味を持つか、1つずつ見ていきましょう。</p>
<p>1行目から見ていきましょう。  </p>
<h4 id="resource_1">resourceの定義と命名<a class="headerlink" href="#resource_1" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="n">resource</span> <span class="s2">&quot;aws_vpc&quot;</span> <span class="s2">&quot;main&quot;</span> <span class="p">{</span>
</pre></div>


<p>ここでは <strong>「"aws_vpc"というリソースを"main"という名前」</strong> で作成しています。<br />
<code>resource "aws_vpc"</code> まではAWSのVPCを作成するという意味で、 <code>"main"</code> はTerraformで定義する他のリソースから参照する際に使用します。</p>
<p>例として「VPCを作成し、作成したVPC内にSubnetを作成する」コードを載せます。</p>
<div class="codehilite"><pre><span></span><span class="c1"># AWSプロバイダの定義</span>
<span class="n">provider</span> <span class="s2">&quot;aws&quot;</span> <span class="p">{</span>
  <span class="n">region</span> <span class="o">=</span> <span class="s2">&quot;ap-northeast-1&quot;</span>
<span class="p">}</span>

<span class="c1"># VPCを作成する</span>
<span class="n">resource</span> <span class="s2">&quot;aws_vpc&quot;</span> <span class="s2">&quot;main&quot;</span> <span class="p">{</span> <span class="c1"># &quot;main&quot; という命名を行う</span>
  <span class="n">cidr_block</span> <span class="o">=</span> <span class="s2">&quot;10.0.0.0/16&quot;</span>

  <span class="n">tags</span> <span class="o">=</span> <span class="p">{</span>
    <span class="no">Name</span> <span class="o">=</span> <span class="s2">&quot;vpc-handson&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># Subnetを作成する</span>
<span class="n">resource</span> <span class="s2">&quot;aws_subnet&quot;</span> <span class="s2">&quot;main&quot;</span> <span class="p">{</span> <span class="c1"># 別のリソースであれば命名が被っていても問題ないです</span>
  <span class="n">vpc_id</span>     <span class="o">=</span> <span class="s2">&quot;${aws_vpc.main.id}&quot;</span> <span class="c1"># aws_vpc.mainでmainと命名されたVPCを参照し、そのVPCのIDを取得する</span>
  <span class="n">cidr_block</span> <span class="o">=</span> <span class="s2">&quot;10.0.1.0/24&quot;</span>
<span class="p">}</span>
</pre></div>


<h4 id="_2">リソースのプロパティ<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h4>
<p>話を戻して、ブロック内のプロパティについて説明します。<br />
今回作成するVPCは以下の通り、「"vpc-handson"という名前を付け、CIDRを10.0.0.0/16に設定する」ように記述されています。</p>
<div class="codehilite"><pre><span></span>  <span class="n">cidr_block</span> <span class="o">=</span> <span class="s2">&quot;10.0.0.0/16&quot;</span>

  <span class="n">tags</span> <span class="o">=</span> <span class="p">{</span>
    <span class="no">Name</span> <span class="o">=</span> <span class="s2">&quot;vpc-handson&quot;</span>
  <span class="p">}</span>
</pre></div>


<p>これはVPCやEC2などのリソース毎にプロパティが異なります。<br />
実際にTerraformのコードを記述する際はTerraformのリファレンスを見ながら記述していきます。</p>
<p><a href="https://www.terraform.io/docs/providers/aws/r/vpc.html">AWS: aws_vpc - Terraform by HashiCorp</a></p>
<div class="admonition note">
<p class="admonition-title">Terraformリファレンスの先へ</p>
<p>TerraformはGolangでできており、AWSプロバイダはAWS SDK のAPIを叩いています。<br />
実際にどのような値がどのようなバリデーションになっているのか、より詳細を知りたい場合はAWSのAPIリファレンスを見てみるのもありでしょう。<br />
<a href="https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_CreateVpc.html">CreateVpc - Amazon Elastic Compute Cloud</a></p>
</div>
<h2 id="terraform">Terraformの実行<a class="headerlink" href="#terraform" title="Permanent link">&para;</a></h2>
<h3 id="_3">初期化<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<p>Terraformで新しく設定を記述した場合、初期化を行う必要があります。<br />
素のTerraformはプロバイダーが内部に組み込まれていないので、今回であればAWSプロバイダーのダウンロードが行われます。</p>
<p>初期化を行ってみましょう。</p>
<div class="codehilite"><pre><span></span><span class="gp">#</span> terraform init

<span class="go">Initializing provider plugins...</span>
<span class="go">- Checking for available provider plugins on https://releases.hashicorp.com...</span>
<span class="go">- Downloading plugin for provider &quot;aws&quot; (2.6.0)...</span>

<span class="go">The following providers do not have any version constraints in configuration,</span>
<span class="go">so the latest version was installed.</span>

<span class="go">To prevent automatic upgrades to new major versions that may contain breaking</span>
<span class="go">changes, it is recommended to add version = &quot;...&quot; constraints to the</span>
<span class="go">corresponding provider blocks in configuration, with the constraint strings</span>
<span class="go">suggested below.</span>

<span class="go">* provider.aws: version = &quot;~&gt; 2.6&quot;</span>

<span class="go">Terraform has been successfully initialized!</span>

<span class="go">You may now begin working with Terraform. Try running &quot;terraform plan&quot; to see</span>
<span class="go">any changes that are required for your infrastructure. All Terraform commands</span>
<span class="go">should now work.</span>

<span class="go">If you ever set or change modules or backend configuration for Terraform,</span>
<span class="go">rerun this command to reinitialize your working directory. If you forget, other</span>
<span class="go">commands will detect it and remind you to do so if necessary.</span>
</pre></div>


<h3 id="_4">適用<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<p>コードの状態をAWS上へ適用しましょう。</p>
<div class="codehilite"><pre><span></span><span class="gp">#</span> terraform apply

<span class="go">An execution plan has been generated and is shown below.</span>
<span class="go">Resource actions are indicated with the following symbols:</span>
<span class="go">  + create</span>

<span class="go">Terraform will perform the following actions:</span>

<span class="go">  + aws_vpc.main</span>
<span class="go">      id:                               &lt;computed&gt;</span>
<span class="go">      arn:                              &lt;computed&gt;</span>
<span class="go">      assign_generated_ipv6_cidr_block: &quot;false&quot;</span>
<span class="go">      cidr_block:                       &quot;10.0.0.0/16&quot;</span>
<span class="go">      default_network_acl_id:           &lt;computed&gt;</span>
<span class="go">      default_route_table_id:           &lt;computed&gt;</span>
<span class="go">      default_security_group_id:        &lt;computed&gt;</span>
<span class="go">      dhcp_options_id:                  &lt;computed&gt;</span>
<span class="go">      enable_classiclink:               &lt;computed&gt;</span>
<span class="go">      enable_classiclink_dns_support:   &lt;computed&gt;</span>
<span class="go">      enable_dns_hostnames:             &lt;computed&gt;</span>
<span class="go">      enable_dns_support:               &quot;true&quot;</span>
<span class="go">      instance_tenancy:                 &quot;default&quot;</span>
<span class="go">      ipv6_association_id:              &lt;computed&gt;</span>
<span class="go">      ipv6_cidr_block:                  &lt;computed&gt;</span>
<span class="go">      main_route_table_id:              &lt;computed&gt;</span>
<span class="go">      owner_id:                         &lt;computed&gt;</span>
<span class="go">      tags.%:                           &quot;1&quot;</span>
<span class="go">      tags.Name:                        &quot;vpc-handson&quot;</span>


<span class="go">Plan: 1 to add, 0 to change, 0 to destroy.</span>

<span class="go">Do you want to perform these actions?</span>
<span class="go">  Terraform will perform the actions described above.</span>
<span class="go">  Only &#39;yes&#39; will be accepted to approve.</span>

<span class="go">  Enter a value:</span>
</pre></div>


<blockquote>
<p>Plan: 1 to add, 0 to change, 0 to destroy.</p>
</blockquote>
<p>新しく1つのリソースが追加されることが確認できました。<br />
ログを見て問題なければ <code>yes</code> で実行を継続しましょう</p>
<div class="codehilite"><pre><span></span><span class="go">  Enter a value: yes</span>

<span class="go">aws_vpc.main: Creating...</span>
<span class="go">  arn:                              &quot;&quot; =&gt; &quot;&lt;computed&gt;&quot;</span>
<span class="go">  assign_generated_ipv6_cidr_block: &quot;&quot; =&gt; &quot;false&quot;</span>
<span class="go">  cidr_block:                       &quot;&quot; =&gt; &quot;10.0.0.0/16&quot;</span>
<span class="go">  default_network_acl_id:           &quot;&quot; =&gt; &quot;&lt;computed&gt;&quot;</span>
<span class="go">  default_route_table_id:           &quot;&quot; =&gt; &quot;&lt;computed&gt;&quot;</span>
<span class="go">  default_security_group_id:        &quot;&quot; =&gt; &quot;&lt;computed&gt;&quot;</span>
<span class="go">  dhcp_options_id:                  &quot;&quot; =&gt; &quot;&lt;computed&gt;&quot;</span>
<span class="go">  enable_classiclink:               &quot;&quot; =&gt; &quot;&lt;computed&gt;&quot;</span>
<span class="go">  enable_classiclink_dns_support:   &quot;&quot; =&gt; &quot;&lt;computed&gt;&quot;</span>
<span class="go">  enable_dns_hostnames:             &quot;&quot; =&gt; &quot;&lt;computed&gt;&quot;</span>
<span class="go">  enable_dns_support:               &quot;&quot; =&gt; &quot;true&quot;</span>
<span class="go">  instance_tenancy:                 &quot;&quot; =&gt; &quot;default&quot;</span>
<span class="go">  ipv6_association_id:              &quot;&quot; =&gt; &quot;&lt;computed&gt;&quot;</span>
<span class="go">  ipv6_cidr_block:                  &quot;&quot; =&gt; &quot;&lt;computed&gt;&quot;</span>
<span class="go">  main_route_table_id:              &quot;&quot; =&gt; &quot;&lt;computed&gt;&quot;</span>
<span class="go">  owner_id:                         &quot;&quot; =&gt; &quot;&lt;computed&gt;&quot;</span>
<span class="go">  tags.%:                           &quot;&quot; =&gt; &quot;1&quot;</span>
<span class="go">  tags.Name:                        &quot;&quot; =&gt; &quot;vpc-handson&quot;</span>
<span class="go">aws_vpc.main: Creation complete after 7s (ID: vpc-028d784cfaa5ca479)</span>

<span class="go">Apply complete! Resources: 1 added, 0 changed, 0 destroyed.</span>
</pre></div>


<p>コンソールを確認して実際にVPCが起動できていることを確認してみましょう</p>
<p><a href="https://ap-northeast-1.console.aws.amazon.com/vpc/home?region=ap-northeast-1#vpcs:sort=desc:VpcId">https://ap-northeast-1.console.aws.amazon.com/vpc/home?region=ap-northeast-1#vpcs:sort=desc:VpcId</a></p>
<p><img alt="describe-vpcs" src="../imgs/describe-vpcs.png" /></p>
<h3 id="_5">リソースの変更を行う<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<p>VPCの名前を "vpc-handson" から "vpc-handson-hoge" に変更してみましょう。<br />
<code>main.tf</code> を以下の通り編集し、VPCの命名を変更します。</p>
<div class="codehilite"><pre><span></span>provider &quot;aws&quot; {
  region = &quot;ap-northeast-1&quot;
}

resource &quot;aws_vpc&quot; &quot;main&quot; {
  cidr_block = &quot;10.0.0.0/16&quot;

  tags = {
<span class="gd">-    Name = &quot;vpc-handson&quot;</span>
<span class="gi">+    Name = &quot;vpc-handson-hoge&quot;</span>
  }
}
</pre></div>


<p>Terraformではコードを適用する前に、どのような変更がかかるのか確認(所謂dry-run)を行うことができます。<br />
実際にどのような変更がかかるのか確認してみましょう。</p>
<div class="codehilite"><pre><span></span><span class="gp">#</span> terraform plan
<span class="go">The refreshed state will be used to calculate this plan, but will not be</span>
<span class="go">persisted to local or remote state storage.</span>

<span class="go">aws_vpc.main: Refreshing state... (ID: vpc-001c076e2cd2e79af)</span>

<span class="go">------------------------------------------------------------------------</span>

<span class="go">An execution plan has been generated and is shown below.</span>
<span class="go">Resource actions are indicated with the following symbols:</span>
<span class="go">  ~ update in-place</span>

<span class="go">Terraform will perform the following actions:</span>

<span class="go">  ~ aws_vpc.main</span>
<span class="go">      tags.Name: &quot;vpc-handson&quot; =&gt; &quot;vpc-handson-hoge&quot;</span>


<span class="go">Plan: 0 to add, 1 to change, 0 to destroy.</span>

<span class="go">------------------------------------------------------------------------</span>

<span class="go">Note: You didn&#39;t specify an &quot;-out&quot; parameter to save this plan, so Terraform</span>
<span class="go">can&#39;t guarantee that exactly these actions will be performed if</span>
<span class="go">&quot;terraform apply&quot; is subsequently run.</span>
</pre></div>


<p>変更の差分が検出でき、その差分を出力した後にコマンドが終了しました。<br />
Terraformを実行する際はオペミスを防ぐためにも <code>terraform apply</code> で実行する前に、 <code>terraform plan</code> でどのような変更がかかるのか確認してから実行するのが定石です。</p>
<p>どのような変更が行われるか検出できたので、実際に変更の適用を行いましょう。</p>
<div class="codehilite"><pre><span></span># terraform apply
  :
</pre></div>


<p>適用が完了したらVPCのコンソールから変更が適用できたか確認してみましょう。</p>
<h3 id="terraform_1">Terraformが管理しているリソース<a class="headerlink" href="#terraform_1" title="Permanent link">&para;</a></h3>
<p>Terraformが管理しているリソースは <code>terraform show</code> コマンドで閲覧することが出来ます。</p>
<p>まずはコマンドを打って確認してみましょう。</p>
<div class="codehilite"><pre><span></span># terraform show
aws_vpc.main:
  id = vpc-07be0a5e024877c48
  arn = arn:aws:ec2:ap-northeast-1:856925507022:vpc/vpc-07be0a5e024877c48
  assign_generated_ipv6_cidr_block = false
  cidr_block = 10.0.0.0/16
  default_network_acl_id = acl-0a00c5fa26f28e853
  default_route_table_id = rtb-0681966791d3ad652
  default_security_group_id = sg-0a5a4b4a19b9d4240
  dhcp_options_id = dopt-23aa3947
  enable_classiclink = false
  enable_classiclink_dns_support = false
  enable_dns_hostnames = false
  enable_dns_support = true
  instance_tenancy = default
  ipv6_association_id =
  ipv6_cidr_block =
  main_route_table_id = rtb-0681966791d3ad652
  owner_id = 856925507022
  tags.% = 1
  tags.Name = vpc-handson-hoge
</pre></div>


<p>Terraformが管理しているリソースは <code>terraform.tfstate</code> というJSONファイルに格納されます。<br />
Terraformコードの適用を行う際はこのファイルを参照し、差分の確認を行っています。</p>
<div class="codehilite"><pre><span></span><span class="gp">#</span> ls
<span class="go">main.tf                  terraform.tfstate        terraform.tfstate.backup</span>
<span class="gp">#</span> cat terraform.tfstate
<span class="go">{</span>
<span class="go">    &quot;version&quot;: 3,</span>
<span class="go">    &quot;terraform_version&quot;: &quot;0.11.13&quot;,</span>
<span class="go">    &quot;serial&quot;: 5,</span>
<span class="go">    &quot;lineage&quot;: &quot;40f395d7-8d59-b14c-f92f-e836258630af&quot;,</span>
<span class="go">    &quot;modules&quot;: [</span>
<span class="go">        {</span>
<span class="go">            &quot;path&quot;: [</span>
<span class="go">                &quot;root&quot;</span>
<span class="go">            ],</span>
</pre></div>


<p>Terraformは <strong>インフラをコードで宣言する</strong> ためのツールです。<br />
そのため、コードで定義された状態になるように動作します。</p>
<p>現在のapplyが完了した状態で <code>terraform plan</code> コマンドを打っても差分が検出されないことを確認しましょう</p>
<div class="codehilite"><pre><span></span><span class="gp">#</span> terraform plan
</pre></div>


<div class="admonition note">
<p class="admonition-title">terraform.tfstateをクラウドで管理する</p>
<p>前提として <code>terraform.tfstate</code> をローカル上で管理するのは危険です。<br />
Terraformはこのファイルを参照してコードの状態を適用するので、このファイルが存在しないと差分が検知できずに新しくリソースが作成されてしまいます。<br />
もし「ローカルマシンが壊れた場合」「複数人で開発したい場合」など、プロダクション開発で使用する場合はバックアップを行う必要があります。<br />
そのバックアップの機能としてTerraformは "backend" という <code>terraform.tfstate</code> をS3などのオブジェクトストレージに保管する機能が存在するので、本番でTerraformを使用する場合は検討しましょう。</p>
</div>
<h2 id="_6">削除する<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h2>
<p>Terraformで管理されているリソースを削除しましょう。<br />
ワンコマンドで管理しているリソースを削除できます。  </p>
<p>実際に削除してみましょう。</p>
<div class="codehilite"><pre><span></span><span class="gp">#</span> terraform destroy
<span class="go">aws_vpc.main: Refreshing state... (ID: vpc-001c076e2cd2e79af)</span>

<span class="go">An execution plan has been generated and is shown below.</span>
<span class="go">Resource actions are indicated with the following symbols:</span>
<span class="go">  - destroy</span>

<span class="go">Terraform will perform the following actions:</span>

<span class="go">  - aws_vpc.main</span>


<span class="go">Plan: 0 to add, 0 to change, 1 to destroy.</span>

<span class="go">Do you really want to destroy all resources?</span>
<span class="go">  Terraform will destroy all your managed infrastructure, as shown above.</span>
<span class="go">  There is no undo. Only &#39;yes&#39; will be accepted to confirm.</span>

<span class="go">  Enter a value: </span>
</pre></div>


<p>削除を実行するか確認がでるので、問題なければ <code>yes</code> と入力します</p>
<div class="codehilite"><pre><span></span><span class="go">  Enter a value: yes</span>

<span class="go">aws_vpc.main: Destroying... (ID: vpc-001c076e2cd2e79af)</span>
<span class="go">aws_vpc.main: Destruction complete after 1s</span>

<span class="go">Destroy complete! Resources: 1 destroyed.</span>
</pre></div>


<p>WebコンソールでTerraformで作成したVPCが削除されていることを確認しましょう。</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../preparation/" title="環境を準備する" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  前
                </span>
                環境を準備する
              </span>
            </div>
          </a>
        
        
          <a href="../../handson/about/" title="概要" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  次
                </span>
                概要
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.267712eb.js"></script>
      
        
        
          
          <script src="../../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
              
            
          
          
        
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
        <script src="../../assets/custom.js"></script>
      
    
  </body>
</html>