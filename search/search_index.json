{"config":{"lang":["en"],"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"About \u00b6 Terraform\u306b\u3064\u3044\u3066\u30cf\u30f3\u30ba\u30aa\u30f3\u5f62\u5f0f\u3067\u5b66\u3076\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3067\u3059\u3002 \u306a\u308b\u3079\u304f\u672c\u756a\u74b0\u5883\u306b\u8fd1\u3044\u74b0\u5883\u3092Terraform\u3067\u69cb\u7bc9\u3057\u3001\u300c\u5b9f\u52d9\u3067\u3059\u3070\u3084\u304fTerraform\u3092\u8a18\u8ff0/\u5c0e\u5165\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u300d\u3053\u3068\u304c\u76ee\u7684\u3067\u3059\u3002 Version \u00b6 Docker 18.09.3 docker-compose 1.23.2 Terraform 0.11.13 \u5fc5\u8981\u306a\u74b0\u5883 \u00b6 AWS\u30a2\u30ab\u30a6\u30f3\u30c8 \u30af\u30e9\u30a6\u30c9\u306a\u3089\u30a2\u30de\u30be\u30f3 \u30a6\u30a7\u30d6 \u30b5\u30fc\u30d3\u30b9 \u3010AWS \u516c\u5f0f\u3011 Docker for Mac/Windows Docker CE \u2014 Docker-docs-ja 17.06.Beta \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 Mac: $ brew cask install docker AWS CLI AWS Command Line Interface \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b - AWS Command Line Interface Mac: $ brew install awscli Windows: > choco install awscli \u30c9\u30e1\u30a4\u30f3 https\u5316\u3092\u884c\u3046\u305f\u3081\u3001Route53\u4e0a\u3067\u30c9\u30e1\u30a4\u30f3\u3092\u7ba1\u7406\u3057\u3066\u3044\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002","title":"Home"},{"location":"#about","text":"Terraform\u306b\u3064\u3044\u3066\u30cf\u30f3\u30ba\u30aa\u30f3\u5f62\u5f0f\u3067\u5b66\u3076\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3067\u3059\u3002 \u306a\u308b\u3079\u304f\u672c\u756a\u74b0\u5883\u306b\u8fd1\u3044\u74b0\u5883\u3092Terraform\u3067\u69cb\u7bc9\u3057\u3001\u300c\u5b9f\u52d9\u3067\u3059\u3070\u3084\u304fTerraform\u3092\u8a18\u8ff0/\u5c0e\u5165\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u300d\u3053\u3068\u304c\u76ee\u7684\u3067\u3059\u3002","title":"About"},{"location":"#version","text":"Docker 18.09.3 docker-compose 1.23.2 Terraform 0.11.13","title":"Version"},{"location":"#_1","text":"AWS\u30a2\u30ab\u30a6\u30f3\u30c8 \u30af\u30e9\u30a6\u30c9\u306a\u3089\u30a2\u30de\u30be\u30f3 \u30a6\u30a7\u30d6 \u30b5\u30fc\u30d3\u30b9 \u3010AWS \u516c\u5f0f\u3011 Docker for Mac/Windows Docker CE \u2014 Docker-docs-ja 17.06.Beta \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 Mac: $ brew cask install docker AWS CLI AWS Command Line Interface \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b - AWS Command Line Interface Mac: $ brew install awscli Windows: > choco install awscli \u30c9\u30e1\u30a4\u30f3 https\u5316\u3092\u884c\u3046\u305f\u3081\u3001Route53\u4e0a\u3067\u30c9\u30e1\u30a4\u30f3\u3092\u7ba1\u7406\u3057\u3066\u3044\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002","title":"\u5fc5\u8981\u306a\u74b0\u5883"},{"location":"next-step/","text":"\u6b21\u306e\u30b9\u30c6\u30c3\u30d7\u3068\u3057\u3066\u306fTerrraform\u306e\u5b66\u7fd2\u3082\u3042\u308a\u307e\u3059\u304c\u3001\u3053\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3067\u306f\u3068\u308a\u3042\u3048\u4f7f\u3044\u304d\u308c\u306a\u304b\u3063\u305f\u4ee5\u4e0b\u306e\u70b9\u3092\u8a66\u3057\u3066\u307f\u308b\u3068\u9762\u767d\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002 \u8907\u6570\u74b0\u5883\uff08DEV/STG/PRD\uff09\u306b\u5bfe\u5fdc\u3055\u305b\u3066\u307f\u308b \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3084 APP_KEY \u306e\u8a2d\u5b9a\u60c5\u5831\u3092\u30b3\u30fc\u30c9\u304b\u3089\u5207\u308a\u96e2\u3059 CI/CD \u5197\u9577\u5316 \u76e3\u8996","title":"Next Step"},{"location":"first/about/","text":"Infrastructure as Code \u00b6 Terraform\u306fInfrastructure as Code\u306e\u30a2\u30d7\u30ed\u30fc\u30c1\u3092\u884c\u3046\u305f\u3081\u306e\u30c4\u30fc\u30eb\u3067\u3059\u3002 Infrastructure as Code \u306f\u305d\u306e\u540d\u524d\u306e\u901a\u308a\u3001\u300c\u30a4\u30f3\u30d5\u30e9\u306e\u30b3\u30fc\u30c9\u5316\u300d\u306e\u305f\u3081\u306e\u30a2\u30d7\u30ed\u30fc\u30c1\u3067\u3059\u3002 \u69cb\u6210\u3092 \u5ba3\u8a00\u7684 \u306b\u8a18\u8ff0\u3059\u308b\u3053\u3068\u306b\u3088\u3063\u3066 \u30b3\u30fc\u30c9\u30d9\u30fc\u30b9\u3067\u30a4\u30f3\u30d5\u30e9\u306e\u7ba1\u7406 \u3092\u884c\u3046\u3068\u304c\u3067\u304d\u3001\u5c5e\u4eba\u5316\u3092\u9632\u3050\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002 \u307e\u305f\u3001\u30b3\u30fc\u30c9\u30d9\u30fc\u30b9\u3067\u7ba1\u7406\u3059\u308b\u3053\u3068\u306b\u3088\u308a \u30a4\u30f3\u30d5\u30e9\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u7ba1\u7406 \u304c\u53ef\u80fd\u304b\u3064\u3001\u305d\u306e\u30b3\u30fc\u30c9\u3092\u8aad\u3080\u3053\u3068\u3067\u73fe\u5728\u306e\u69cb\u6210\u3092\u4e00\u89a7\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002 AWS\u3068Terraform \u00b6 Terraform\u306fInfrastructure as Code\u306e\u305f\u3081\u306e\u30c4\u30fc\u30eb\u3067\u3059\u3002 \u4f8b\u3048\u3070\u4e0a\u306e\u56f3\u306e\u3088\u3046\u306aVPC\u30fbALB\u30fbECS\u30fbetc...\u306e\u3088\u3046\u306a\u5fa9\u6570\u306e\u30b5\u30fc\u30d3\u30b9\u3068\u3001\u305d\u306e\u4f9d\u5b58\u95a2\u4fc2\u3092\u30b3\u30fc\u30c9\u3067\u8a18\u8ff0\u3057\u3001AWS\u4e0a\u3078\u5c55\u958b\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002 IaC\u30c4\u30fc\u30eb\u306e\u9078\u629e\u80a2 \u00b6 \u4ed6\u306b\u3082Infrastructure as Code\u3092\u5b9f\u73fe\u3059\u308b\u305f\u3081\u306e\u30c4\u30fc\u30eb\u3068\u3057\u3066Ansible, Chef, CloudFormation\u306a\u3069\u69d8\u3005\u306a\u30c4\u30fc\u30eb\u304c\u5b58\u5728\u3057\u307e\u3059\u3002 \u305d\u308c\u305e\u308c\u306e\u30c4\u30fc\u30eb\u306f\u5b9f\u73fe\u3057\u305f\u3044\u3053\u3068\u3084\u5f97\u610f\u306a\u30e6\u30fc\u30b9\u30b1\u30fc\u30b9\u304c\u7570\u306a\u308b\u306e\u3067\u3001\u305d\u308c\u3089\u3092\u628a\u63e1\u3057\u3066\u4f7f\u3044\u5206\u3051\u308b\u3068\u826f\u3044\u3067\u3057\u3087\u3046\u3002 Terraform \u00b6 \u3053\u306e\u30cf\u30f3\u30ba\u30aa\u30f3\u3067\u53d6\u308a\u6271\u3046\u30c4\u30fc\u30eb\u3067\u3059\u3002 Hashicorp\u793e\uff08Vagrant\u3084Vault\u306a\u3069\u304c\u4ee3\u8868\u7684\u3002\uff09\u304c\u958b\u767a\u3057\u305fOSS\u306eInfrastructure as Code\u30c4\u30fc\u30eb\u3067\u3059\u3002 Ruby\u30e9\u30a4\u30af\u306aHCL\u3068\u3044\u3046DSL\u3067\u30b3\u30fc\u30c9\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002 \u307e\u305f\u3001Terraform\u306fAWS\u5c02\u7528\u306e\u30c4\u30fc\u30eb\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002 AWS\u4ee5\u5916\u306e\u30af\u30e9\u30a6\u30c9\u3067\u3042\u308bGCP\u3084Azure\u3067\u3082\u4f7f\u7528\u3067\u304d\u3001\u4ed6\u306b\u3082Datadog\u3084Heroku\u306a\u3069\u306e\u7ba1\u7406\u3092\u884c\u3046\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002 Providers - Terraform by HashiCorp CloudFormation \u00b6 AWS\u306b\u3088\u308bAWS\u306e\u305f\u3081\u306eAWS\u306eInfrastructure as Code\u30c4\u30fc\u30eb\u3002 AWS\u304c\u958b\u767a\u3057\u3066\u3044\u308b\u3053\u3068\u3082\u3042\u308a\u3001AWS\u306b\u7279\u5316\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u7279\u5fb4\u3067\u3059\u3002 JSON\u3082\u3057\u304f\u306fyaml\u3067\u30b3\u30fc\u30c9\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002 CloudFormation\u306fAWS\u306e1\u3064\u306e\u30b5\u30fc\u30d3\u30b9\u306a\u306e\u3067\u3001\u30b9\u30c6\u30fc\u30bf\u30b9\u306e\u7ba1\u7406\u30fb\u4e26\u5217\u5b9f\u884c\u30fb\u30b3\u30f3\u30d5\u30ea\u30af\u30c8\u306e\u9632\u6b62\u306a\u3069\u3001\u7169\u308f\u3057\u3044\u9762\u3092AWS\u5074\u3067\u884c\u3063\u3066\u304f\u308c\u307e\u3059\u3002 \u307e\u305f\u3001AWS\u304c\u51fa\u3059\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306fCloudFormation\u3067\u8a18\u8f09\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u591a\u3044\u305f\u3081\u3001AWS\u3092\u4f7f\u3046\u5834\u5408\u306f\u66f8\u3051\u306a\u304f\u3066\u3082\u8aad\u3081\u308b\u3053\u3068\u304c\u671b\u307e\u3057\u3044\u3068\u7b46\u8005\u306f\u8003\u3048\u3066\u3044\u307e\u3059\u3002 Ansible \u00b6 Terraform\u3068CloudFormation\u306f\u300cAWS\u306e\u69cb\u6210\u7ba1\u7406\u300d\u3092\u8cac\u52d9\u3068\u3057\u3066\u3044\u307e\u3059\u304c\u3001Ansible\u305d\u306e2\u3064\u3068\u306f\u6bdb\u8272\u304c\u9055\u3044\u300cOS\u3088\u308a\u4e0a\u306e\u69cb\u6210\u7ba1\u7406\u300d\u3092\u4e3b\u306b\u8cac\u52d9\u3068\u3057\u3066\u3044\u307e\u3059\u3002 \u4f8b\u3048\u3070\u3001\u300c\u3069\u306e\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u3084\u30b3\u30fc\u30c9\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3001\u3069\u306e\u30de\u30b7\u30f3\u3078\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u3059\u308b\u300d\u3068\u3044\u3063\u305f\u3053\u3068\u884c\u3044\u307e\u3059\u3002 \u305d\u306e\u305f\u3081\u30af\u30e9\u30a6\u30c9\u3068Docker\u3092\u4f7f\u3046\u3068\u4f7f\u7528\u3059\u308b\u6a5f\u4f1a\u304c\u5c11\u306a\u3044\u3067\u3059\u3002 Infrastructure as Code\u3068\u4e00\u6982\u306b\u8a00\u3063\u3066\u3082\u69d8\u3005\u306a\u8cac\u52d9\u304c\u3042\u308b\u3068\u3044\u3046\u3053\u3068\u3092\u4f1d\u3048\u305f\u304b\u3063\u305f\u305f\u3081\u3001Ansible\u306e\u7d39\u4ecb\u3092\u3057\u307e\u3057\u305f\u3002 \u3067\u3001\u4f55\u3092\u4f7f\u3048\u3070\u826f\u3044\u308f\u3051\uff1f \u30a4\u30f3\u30d5\u30e9\u306e\u69cb\u6210\u7ba1\u7406\u306fAWS\u306e\u5834\u5408\u3067\u3042\u308c\u3070Terraform\u3068CloudFormation\u3001\u3069\u3061\u3089\u3092\u4f7f\u7528\u3057\u3066\u3082\u554f\u984c\u306a\u3044\u3067\u3057\u3087\u3046\u3002 AWS\u4ee5\u5916\u306bGCP\u30fbAzure\u30fbDatadog\u30fbPagerDuty\u306a\u3069\u306e\u69d8\u3005\u306a\u30d7\u30ed\u30d0\u30a4\u30c0\u30fc\u3092\u30b3\u30fc\u30c9\u5316\u3057\u305f\u3044\u3068\u3044\u3046\u8981\u6c42\u304c\u3042\u308b/\u4e88\u60f3\u3067\u304d\u308b\u306e\u3067\u3042\u308c\u3070AWS\u5c02\u7528\u306eCloudFormation\u3067\u306f\u306a\u304fTerraform\u304c\u9078\u629e\u3055\u308c\u307e\u3059\u3002 \u307e\u305f\u3001Ansible\u306e\u3088\u3046\u306aOS\u3088\u308a\u4e0a\u306e\u69cb\u6210\u7ba1\u7406\u306e\u30e2\u30c1\u30d9\u30fc\u30b7\u30e7\u30f3\u304c\u3042\u308b\u5834\u5408\u306f\u3001\u305d\u3082\u305d\u3082Docker\u3068\u30b3\u30f3\u30c6\u30ca\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3\u30c4\u30fc\u30eb\u3092\u4f7f\u7528\u3057\u3001Ansible(\u3084Chef)\u306e\u3088\u3046\u306aInfrastructure as Code\u3092\u4f7f\u7528\u3059\u308b\u4f59\u5730\u3092\u4e0e\u3048\u306a\u3044\u3053\u3068\u304c\u671b\u307e\u3057\u3044\u3068\u7b46\u8005\u306f\u8003\u3048\u307e\u3059\u3002\u3082\u3061\u308d\u3093\u3001\u30d9\u30a2\u30e1\u30bf\u30eb\u3084VM\u3067\u306a\u3044\u3068\u5b9f\u73fe\u3067\u304d\u306a\u3044\u30b1\u30fc\u30b9\u3082\u5b58\u5728\u3059\u308b\u306e\u3067\u305d\u306e\u5834\u5408\u306fAnsible\u306e\u3088\u3046\u306a\u30c4\u30fc\u30eb\u3092\u4f7f\u7528\u3057\u307e\u3057\u3087\u3046\u3002 \u7d50\u8ad6\u3001\u300c\u30af\u30e9\u30a6\u30c9\u306fTerraform\u3001\u30a2\u30d7\u30ea\u306fDocker\u300d\u3092\u4f7f\u7528\u3059\u308b\u3053\u3068\u3092\u30aa\u30b9\u30b9\u30e1\u3057\u307e\u3059\u3002","title":"Terraform\u3068\u306f"},{"location":"first/about/#infrastructure-as-code","text":"Terraform\u306fInfrastructure as Code\u306e\u30a2\u30d7\u30ed\u30fc\u30c1\u3092\u884c\u3046\u305f\u3081\u306e\u30c4\u30fc\u30eb\u3067\u3059\u3002 Infrastructure as Code \u306f\u305d\u306e\u540d\u524d\u306e\u901a\u308a\u3001\u300c\u30a4\u30f3\u30d5\u30e9\u306e\u30b3\u30fc\u30c9\u5316\u300d\u306e\u305f\u3081\u306e\u30a2\u30d7\u30ed\u30fc\u30c1\u3067\u3059\u3002 \u69cb\u6210\u3092 \u5ba3\u8a00\u7684 \u306b\u8a18\u8ff0\u3059\u308b\u3053\u3068\u306b\u3088\u3063\u3066 \u30b3\u30fc\u30c9\u30d9\u30fc\u30b9\u3067\u30a4\u30f3\u30d5\u30e9\u306e\u7ba1\u7406 \u3092\u884c\u3046\u3068\u304c\u3067\u304d\u3001\u5c5e\u4eba\u5316\u3092\u9632\u3050\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002 \u307e\u305f\u3001\u30b3\u30fc\u30c9\u30d9\u30fc\u30b9\u3067\u7ba1\u7406\u3059\u308b\u3053\u3068\u306b\u3088\u308a \u30a4\u30f3\u30d5\u30e9\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u7ba1\u7406 \u304c\u53ef\u80fd\u304b\u3064\u3001\u305d\u306e\u30b3\u30fc\u30c9\u3092\u8aad\u3080\u3053\u3068\u3067\u73fe\u5728\u306e\u69cb\u6210\u3092\u4e00\u89a7\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002","title":"Infrastructure as Code"},{"location":"first/about/#awsterraform","text":"Terraform\u306fInfrastructure as Code\u306e\u305f\u3081\u306e\u30c4\u30fc\u30eb\u3067\u3059\u3002 \u4f8b\u3048\u3070\u4e0a\u306e\u56f3\u306e\u3088\u3046\u306aVPC\u30fbALB\u30fbECS\u30fbetc...\u306e\u3088\u3046\u306a\u5fa9\u6570\u306e\u30b5\u30fc\u30d3\u30b9\u3068\u3001\u305d\u306e\u4f9d\u5b58\u95a2\u4fc2\u3092\u30b3\u30fc\u30c9\u3067\u8a18\u8ff0\u3057\u3001AWS\u4e0a\u3078\u5c55\u958b\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002","title":"AWS\u3068Terraform"},{"location":"first/about/#iac","text":"\u4ed6\u306b\u3082Infrastructure as Code\u3092\u5b9f\u73fe\u3059\u308b\u305f\u3081\u306e\u30c4\u30fc\u30eb\u3068\u3057\u3066Ansible, Chef, CloudFormation\u306a\u3069\u69d8\u3005\u306a\u30c4\u30fc\u30eb\u304c\u5b58\u5728\u3057\u307e\u3059\u3002 \u305d\u308c\u305e\u308c\u306e\u30c4\u30fc\u30eb\u306f\u5b9f\u73fe\u3057\u305f\u3044\u3053\u3068\u3084\u5f97\u610f\u306a\u30e6\u30fc\u30b9\u30b1\u30fc\u30b9\u304c\u7570\u306a\u308b\u306e\u3067\u3001\u305d\u308c\u3089\u3092\u628a\u63e1\u3057\u3066\u4f7f\u3044\u5206\u3051\u308b\u3068\u826f\u3044\u3067\u3057\u3087\u3046\u3002","title":"IaC\u30c4\u30fc\u30eb\u306e\u9078\u629e\u80a2"},{"location":"first/about/#terraform","text":"\u3053\u306e\u30cf\u30f3\u30ba\u30aa\u30f3\u3067\u53d6\u308a\u6271\u3046\u30c4\u30fc\u30eb\u3067\u3059\u3002 Hashicorp\u793e\uff08Vagrant\u3084Vault\u306a\u3069\u304c\u4ee3\u8868\u7684\u3002\uff09\u304c\u958b\u767a\u3057\u305fOSS\u306eInfrastructure as Code\u30c4\u30fc\u30eb\u3067\u3059\u3002 Ruby\u30e9\u30a4\u30af\u306aHCL\u3068\u3044\u3046DSL\u3067\u30b3\u30fc\u30c9\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002 \u307e\u305f\u3001Terraform\u306fAWS\u5c02\u7528\u306e\u30c4\u30fc\u30eb\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002 AWS\u4ee5\u5916\u306e\u30af\u30e9\u30a6\u30c9\u3067\u3042\u308bGCP\u3084Azure\u3067\u3082\u4f7f\u7528\u3067\u304d\u3001\u4ed6\u306b\u3082Datadog\u3084Heroku\u306a\u3069\u306e\u7ba1\u7406\u3092\u884c\u3046\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002 Providers - Terraform by HashiCorp","title":"Terraform"},{"location":"first/about/#cloudformation","text":"AWS\u306b\u3088\u308bAWS\u306e\u305f\u3081\u306eAWS\u306eInfrastructure as Code\u30c4\u30fc\u30eb\u3002 AWS\u304c\u958b\u767a\u3057\u3066\u3044\u308b\u3053\u3068\u3082\u3042\u308a\u3001AWS\u306b\u7279\u5316\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u7279\u5fb4\u3067\u3059\u3002 JSON\u3082\u3057\u304f\u306fyaml\u3067\u30b3\u30fc\u30c9\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002 CloudFormation\u306fAWS\u306e1\u3064\u306e\u30b5\u30fc\u30d3\u30b9\u306a\u306e\u3067\u3001\u30b9\u30c6\u30fc\u30bf\u30b9\u306e\u7ba1\u7406\u30fb\u4e26\u5217\u5b9f\u884c\u30fb\u30b3\u30f3\u30d5\u30ea\u30af\u30c8\u306e\u9632\u6b62\u306a\u3069\u3001\u7169\u308f\u3057\u3044\u9762\u3092AWS\u5074\u3067\u884c\u3063\u3066\u304f\u308c\u307e\u3059\u3002 \u307e\u305f\u3001AWS\u304c\u51fa\u3059\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306fCloudFormation\u3067\u8a18\u8f09\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u591a\u3044\u305f\u3081\u3001AWS\u3092\u4f7f\u3046\u5834\u5408\u306f\u66f8\u3051\u306a\u304f\u3066\u3082\u8aad\u3081\u308b\u3053\u3068\u304c\u671b\u307e\u3057\u3044\u3068\u7b46\u8005\u306f\u8003\u3048\u3066\u3044\u307e\u3059\u3002","title":"CloudFormation"},{"location":"first/about/#ansible","text":"Terraform\u3068CloudFormation\u306f\u300cAWS\u306e\u69cb\u6210\u7ba1\u7406\u300d\u3092\u8cac\u52d9\u3068\u3057\u3066\u3044\u307e\u3059\u304c\u3001Ansible\u305d\u306e2\u3064\u3068\u306f\u6bdb\u8272\u304c\u9055\u3044\u300cOS\u3088\u308a\u4e0a\u306e\u69cb\u6210\u7ba1\u7406\u300d\u3092\u4e3b\u306b\u8cac\u52d9\u3068\u3057\u3066\u3044\u307e\u3059\u3002 \u4f8b\u3048\u3070\u3001\u300c\u3069\u306e\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u3084\u30b3\u30fc\u30c9\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3001\u3069\u306e\u30de\u30b7\u30f3\u3078\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u3059\u308b\u300d\u3068\u3044\u3063\u305f\u3053\u3068\u884c\u3044\u307e\u3059\u3002 \u305d\u306e\u305f\u3081\u30af\u30e9\u30a6\u30c9\u3068Docker\u3092\u4f7f\u3046\u3068\u4f7f\u7528\u3059\u308b\u6a5f\u4f1a\u304c\u5c11\u306a\u3044\u3067\u3059\u3002 Infrastructure as Code\u3068\u4e00\u6982\u306b\u8a00\u3063\u3066\u3082\u69d8\u3005\u306a\u8cac\u52d9\u304c\u3042\u308b\u3068\u3044\u3046\u3053\u3068\u3092\u4f1d\u3048\u305f\u304b\u3063\u305f\u305f\u3081\u3001Ansible\u306e\u7d39\u4ecb\u3092\u3057\u307e\u3057\u305f\u3002 \u3067\u3001\u4f55\u3092\u4f7f\u3048\u3070\u826f\u3044\u308f\u3051\uff1f \u30a4\u30f3\u30d5\u30e9\u306e\u69cb\u6210\u7ba1\u7406\u306fAWS\u306e\u5834\u5408\u3067\u3042\u308c\u3070Terraform\u3068CloudFormation\u3001\u3069\u3061\u3089\u3092\u4f7f\u7528\u3057\u3066\u3082\u554f\u984c\u306a\u3044\u3067\u3057\u3087\u3046\u3002 AWS\u4ee5\u5916\u306bGCP\u30fbAzure\u30fbDatadog\u30fbPagerDuty\u306a\u3069\u306e\u69d8\u3005\u306a\u30d7\u30ed\u30d0\u30a4\u30c0\u30fc\u3092\u30b3\u30fc\u30c9\u5316\u3057\u305f\u3044\u3068\u3044\u3046\u8981\u6c42\u304c\u3042\u308b/\u4e88\u60f3\u3067\u304d\u308b\u306e\u3067\u3042\u308c\u3070AWS\u5c02\u7528\u306eCloudFormation\u3067\u306f\u306a\u304fTerraform\u304c\u9078\u629e\u3055\u308c\u307e\u3059\u3002 \u307e\u305f\u3001Ansible\u306e\u3088\u3046\u306aOS\u3088\u308a\u4e0a\u306e\u69cb\u6210\u7ba1\u7406\u306e\u30e2\u30c1\u30d9\u30fc\u30b7\u30e7\u30f3\u304c\u3042\u308b\u5834\u5408\u306f\u3001\u305d\u3082\u305d\u3082Docker\u3068\u30b3\u30f3\u30c6\u30ca\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3\u30c4\u30fc\u30eb\u3092\u4f7f\u7528\u3057\u3001Ansible(\u3084Chef)\u306e\u3088\u3046\u306aInfrastructure as Code\u3092\u4f7f\u7528\u3059\u308b\u4f59\u5730\u3092\u4e0e\u3048\u306a\u3044\u3053\u3068\u304c\u671b\u307e\u3057\u3044\u3068\u7b46\u8005\u306f\u8003\u3048\u307e\u3059\u3002\u3082\u3061\u308d\u3093\u3001\u30d9\u30a2\u30e1\u30bf\u30eb\u3084VM\u3067\u306a\u3044\u3068\u5b9f\u73fe\u3067\u304d\u306a\u3044\u30b1\u30fc\u30b9\u3082\u5b58\u5728\u3059\u308b\u306e\u3067\u305d\u306e\u5834\u5408\u306fAnsible\u306e\u3088\u3046\u306a\u30c4\u30fc\u30eb\u3092\u4f7f\u7528\u3057\u307e\u3057\u3087\u3046\u3002 \u7d50\u8ad6\u3001\u300c\u30af\u30e9\u30a6\u30c9\u306fTerraform\u3001\u30a2\u30d7\u30ea\u306fDocker\u300d\u3092\u4f7f\u7528\u3059\u308b\u3053\u3068\u3092\u30aa\u30b9\u30b9\u30e1\u3057\u307e\u3059\u3002","title":"Ansible"},{"location":"first/handson/","text":"\u307e\u305a\u306fTerraform\u3092\u4f7f\u3063\u3066\u307f\u307e\u3057\u3087\u3046\u3002 \u3053\u306e\u7ae0\u3067\u306fVPC\u306e\u8d77\u52d5\u3059\u308b\u3053\u3068\u3092\u76ee\u6a19\u306b\u3001\u3088\u304f\u4f7f\u7528\u3055\u308c\u308b\u30b7\u30f3\u30bf\u30c3\u30af\u30b9\u3092\u5b66\u3093\u3067\u3044\u304d\u307e\u3059\u3002 \u6e96\u5099 \u00b6 \u65b0\u3057\u3044Terminal\u3092\u7acb\u3061\u4e0a\u3052\u3001\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u3053\u306e\u7ae0\u7528\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u3001\u4f5c\u6210\u3057\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u79fb\u52d5\u3057\u3066\u304f\u3060\u3055\u3044\u3002 $ cd ~/Desktop/terraform-handson $ mkdir vpc-handson $ cd vpc-handson Terraform\u3092\u7acb\u3061\u4e0a\u3052\u3066\u3044\u308bTerminal\u306b\u3082\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002 # ls vpc-handson HCL\u3092\u66f8\u304f \u00b6 VPC\u3092\u7acb\u3061\u4e0a\u3052\u308b\u305f\u3081\u306e\u30b3\u30fc\u30c9\u3092\u66f8\u304d\u307e\u3059\u3002 \u4ee5\u4e0b\u306e\u30b3\u30fc\u30c9\u3092 main.tf \u306e\u547d\u540d\u3067 vpc-handson/ \u914d\u4e0b\u306b\u4f5c\u6210\u3057\u3066\u304f\u3060\u3055\u3044\u3002 provider \"aws\" { region = \"ap-northeast-1\" } resource \"aws_vpc\" \"main\" { cidr_block = \"10.0.0.0/16\" tags = { Name = \"vpc-handson\" } } \u4eca\u56de\u306f provider \u3068 resource \u306e2\u3064\u3092\u5b9a\u7fa9\u3057\u307e\u3057\u305f\u3002 provider \u00b6 provider\u306f\u305d\u306e\u540d\u306e\u901a\u308a\u30d7\u30ed\u30d0\u30a4\u30c0\u306e\u5b9a\u7fa9\u3092\u884c\u3044\u307e\u3059\u3002 \u4eca\u56de\u306fAWS\u3092\u4f7f\u7528\u3057\u305f\u3044\u305f\u3081 aws \u3068\u5ba3\u8a00\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u4ed6\u306b\u3082 gcp \u3084 azure \u306a\u3069\u69d8\u3005\u306a\u30d7\u30ed\u30d0\u30a4\u30c0\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u307e\u3059\u3002 \u307e\u305f\u3001provider\u30d6\u30ed\u30c3\u30af\u5185\u3067 region = \"ap-northeast-1\" \u3068\u5b9a\u7fa9\u3057\u3066\u3044\u307e\u3059\u3002 \u3053\u3053\u3067\u6307\u5b9a\u3057\u305f\u30ea\u30fc\u30b8\u30e7\u30f3\u306bVPC\u3084EC2\u306a\u3069\u306e\u5404\u7a2e\u30ea\u30bd\u30fc\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002 \u4eca\u56de\u306f\"ap-northeast-1\"(\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3)\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002 resource \u00b6 resource\u306fVPC\u3084EC2\u306e\u3088\u3046\u306a\u8d77\u52d5\u3057\u305f\u3044\u30ea\u30bd\u30fc\u30b9\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002 \u4eca\u56de\u306f\u30b3\u30fc\u30c9\u3078VPC\u3092\u5b9a\u7fa9\u3057\u307e\u3057\u305f\u3002\u3053\u308c\u3092\u5b9f\u884c\u3059\u308b\u3053\u3068\u3067 \u300cvpc-handson\u3068\u3044\u3046\u540d\u524d\u3067CIDR\u304c10.0.0.0/16\u306eVPC\u300d \u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002 \u8a18\u8ff0\u3057\u305f\u30b3\u30fc\u30c9\u304c\u3069\u306e\u3088\u3046\u306a\u610f\u5473\u3092\u6301\u3064\u304b\u30011\u3064\u305a\u3064\u898b\u3066\u3044\u304d\u307e\u3057\u3087\u3046\u3002 1\u884c\u76ee\u304b\u3089\u898b\u3066\u3044\u304d\u307e\u3057\u3087\u3046\u3002 resource\u306e\u5b9a\u7fa9\u3068\u547d\u540d \u00b6 resource \"aws_vpc\" \"main\" { \u3053\u3053\u3067\u306f \u300c\"aws_vpc\"\u3068\u3044\u3046\u30ea\u30bd\u30fc\u30b9\u3092\"main\"\u3068\u3044\u3046\u540d\u524d\u300d \u3067\u4f5c\u6210\u3057\u3066\u3044\u307e\u3059\u3002 resource \"aws_vpc\" \u307e\u3067\u306fAWS\u306eVPC\u3092\u4f5c\u6210\u3059\u308b\u3068\u3044\u3046\u610f\u5473\u3067\u3001 \"main\" \u306fTerraform\u3067\u5b9a\u7fa9\u3059\u308b\u4ed6\u306e\u30ea\u30bd\u30fc\u30b9\u304b\u3089\u53c2\u7167\u3059\u308b\u969b\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002 \u4f8b\u3068\u3057\u3066\u300cVPC\u3092\u4f5c\u6210\u3057\u3001\u4f5c\u6210\u3057\u305fVPC\u5185\u306bSubnet\u3092\u4f5c\u6210\u3059\u308b\u300d\u30b3\u30fc\u30c9\u3092\u8f09\u305b\u307e\u3059\u3002 # AWS\u30d7\u30ed\u30d0\u30a4\u30c0\u306e\u5b9a\u7fa9 provider \"aws\" { region = \"ap-northeast-1\" } # VPC\u3092\u4f5c\u6210\u3059\u308b resource \"aws_vpc\" \"main\" { # \"main\" \u3068\u3044\u3046\u547d\u540d\u3092\u884c\u3046 cidr_block = \"10.0.0.0/16\" tags = { Name = \"vpc-handson\" } } # Subnet\u3092\u4f5c\u6210\u3059\u308b resource \"aws_subnet\" \"main\" { # \u5225\u306e\u30ea\u30bd\u30fc\u30b9\u3067\u3042\u308c\u3070\u547d\u540d\u304c\u88ab\u3063\u3066\u3044\u3066\u3082\u554f\u984c\u306a\u3044\u3067\u3059 vpc_id = \"${aws_vpc.main.id}\" # aws_vpc.main\u3067main\u3068\u547d\u540d\u3055\u308c\u305fVPC\u3092\u53c2\u7167\u3057\u3001\u305d\u306eVPC\u306eID\u3092\u53d6\u5f97\u3059\u308b cidr_block = \"10.0.1.0/24\" } \u30ea\u30bd\u30fc\u30b9\u306e\u30d7\u30ed\u30d1\u30c6\u30a3 \u00b6 \u8a71\u3092\u623b\u3057\u3066\u3001\u30d6\u30ed\u30c3\u30af\u5185\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u307e\u3059\u3002 \u4eca\u56de\u4f5c\u6210\u3059\u308bVPC\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3001\u300c\"vpc-handson\"\u3068\u3044\u3046\u540d\u524d\u3092\u4ed8\u3051\u3001CIDR\u309210.0.0.0/16\u306b\u8a2d\u5b9a\u3059\u308b\u300d\u3088\u3046\u306b\u8a18\u8ff0\u3055\u308c\u3066\u3044\u307e\u3059\u3002 cidr_block = \"10.0.0.0/16\" tags = { Name = \"vpc-handson\" } \u3053\u308c\u306fVPC\u3084EC2\u306a\u3069\u306e\u30ea\u30bd\u30fc\u30b9\u6bce\u306b\u30d7\u30ed\u30d1\u30c6\u30a3\u304c\u7570\u306a\u308a\u307e\u3059\u3002 \u5b9f\u969b\u306bTerraform\u306e\u30b3\u30fc\u30c9\u3092\u8a18\u8ff0\u3059\u308b\u969b\u306fTerraform\u306e\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\u3092\u898b\u306a\u304c\u3089\u8a18\u8ff0\u3057\u3066\u3044\u304d\u307e\u3059\u3002 AWS: aws_vpc - Terraform by HashiCorp Terraform\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\u306e\u5148\u3078 Terraform\u306fGolang\u3067\u3067\u304d\u3066\u304a\u308a\u3001AWS\u30d7\u30ed\u30d0\u30a4\u30c0\u306fAWS SDK \u306eAPI\u3092\u53e9\u3044\u3066\u3044\u307e\u3059\u3002 \u5b9f\u969b\u306b\u3069\u306e\u3088\u3046\u306a\u5024\u304c\u3069\u306e\u3088\u3046\u306a\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u304b\u3001\u3088\u308a\u8a73\u7d30\u3092\u77e5\u308a\u305f\u3044\u5834\u5408\u306fAWS\u306eAPI\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\u3092\u898b\u3066\u307f\u308b\u306e\u3082\u3042\u308a\u3067\u3057\u3087\u3046\u3002 CreateVpc - Amazon Elastic Compute Cloud Terraform\u306e\u5b9f\u884c \u00b6 \u521d\u671f\u5316 \u00b6 Terraform\u3067\u65b0\u3057\u304f\u8a2d\u5b9a\u3092\u8a18\u8ff0\u3057\u305f\u5834\u5408\u3001\u521d\u671f\u5316\u3092\u884c\u3046\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 \u7d20\u306eTerraform\u306f\u30d7\u30ed\u30d0\u30a4\u30c0\u30fc\u304c\u5185\u90e8\u306b\u7d44\u307f\u8fbc\u307e\u308c\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u4eca\u56de\u3067\u3042\u308c\u3070AWS\u30d7\u30ed\u30d0\u30a4\u30c0\u30fc\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u304c\u884c\u308f\u308c\u307e\u3059\u3002 \u521d\u671f\u5316\u3092\u884c\u3063\u3066\u307f\u307e\u3057\u3087\u3046\u3002 # terraform init Initializing provider plugins... - Checking for available provider plugins on https://releases.hashicorp.com... - Downloading plugin for provider \"aws\" (2.6.0)... The following providers do not have any version constraints in configuration, so the latest version was installed. To prevent automatic upgrades to new major versions that may contain breaking changes, it is recommended to add version = \"...\" constraints to the corresponding provider blocks in configuration, with the constraint strings suggested below. * provider.aws: version = \"~> 2.6\" Terraform has been successfully initialized! You may now begin working with Terraform. Try running \"terraform plan\" to see any changes that are required for your infrastructure. All Terraform commands should now work. If you ever set or change modules or backend configuration for Terraform, rerun this command to reinitialize your working directory. If you forget, other commands will detect it and remind you to do so if necessary. \u9069\u7528 \u00b6 \u30b3\u30fc\u30c9\u306e\u72b6\u614b\u3092AWS\u4e0a\u3078\u9069\u7528\u3057\u307e\u3057\u3087\u3046\u3002 # terraform apply An execution plan has been generated and is shown below. Resource actions are indicated with the following symbols: + create Terraform will perform the following actions: + aws_vpc.main id: <computed> arn: <computed> assign_generated_ipv6_cidr_block: \"false\" cidr_block: \"10.0.0.0/16\" default_network_acl_id: <computed> default_route_table_id: <computed> default_security_group_id: <computed> dhcp_options_id: <computed> enable_classiclink: <computed> enable_classiclink_dns_support: <computed> enable_dns_hostnames: <computed> enable_dns_support: \"true\" instance_tenancy: \"default\" ipv6_association_id: <computed> ipv6_cidr_block: <computed> main_route_table_id: <computed> owner_id: <computed> tags.%: \"1\" tags.Name: \"vpc-handson\" Plan: 1 to add, 0 to change, 0 to destroy. Do you want to perform these actions? Terraform will perform the actions described above. Only 'yes' will be accepted to approve. Enter a value: Plan: 1 to add, 0 to change, 0 to destroy. \u65b0\u3057\u304f1\u3064\u306e\u30ea\u30bd\u30fc\u30b9\u304c\u8ffd\u52a0\u3055\u308c\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3057\u305f\u3002 \u30ed\u30b0\u3092\u898b\u3066\u554f\u984c\u306a\u3051\u308c\u3070 yes \u3067\u5b9f\u884c\u3092\u7d99\u7d9a\u3057\u307e\u3057\u3087\u3046 Enter a value: yes aws_vpc.main: Creating... arn: \"\" => \"<computed>\" assign_generated_ipv6_cidr_block: \"\" => \"false\" cidr_block: \"\" => \"10.0.0.0/16\" default_network_acl_id: \"\" => \"<computed>\" default_route_table_id: \"\" => \"<computed>\" default_security_group_id: \"\" => \"<computed>\" dhcp_options_id: \"\" => \"<computed>\" enable_classiclink: \"\" => \"<computed>\" enable_classiclink_dns_support: \"\" => \"<computed>\" enable_dns_hostnames: \"\" => \"<computed>\" enable_dns_support: \"\" => \"true\" instance_tenancy: \"\" => \"default\" ipv6_association_id: \"\" => \"<computed>\" ipv6_cidr_block: \"\" => \"<computed>\" main_route_table_id: \"\" => \"<computed>\" owner_id: \"\" => \"<computed>\" tags.%: \"\" => \"1\" tags.Name: \"\" => \"vpc-handson\" aws_vpc.main: Creation complete after 7s (ID: vpc-028d784cfaa5ca479) Apply complete! Resources: 1 added, 0 changed, 0 destroyed. \u30b3\u30f3\u30bd\u30fc\u30eb\u3092\u78ba\u8a8d\u3057\u3066\u5b9f\u969b\u306bVPC\u304c\u8d77\u52d5\u3067\u304d\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046 https://ap-northeast-1.console.aws.amazon.com/vpc/home?region=ap-northeast-1#vpcs:sort=desc:VpcId \u30ea\u30bd\u30fc\u30b9\u306e\u5909\u66f4\u3092\u884c\u3046 \u00b6 VPC\u306e\u540d\u524d\u3092 \"vpc-handson\" \u304b\u3089 \"vpc-handson-hoge\" \u306b\u5909\u66f4\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002 main.tf \u3092\u4ee5\u4e0b\u306e\u901a\u308a\u7de8\u96c6\u3057\u3001VPC\u306e\u547d\u540d\u3092\u5909\u66f4\u3057\u307e\u3059\u3002 provider \"aws\" { region = \"ap-northeast-1\" } resource \"aws_vpc\" \"main\" { cidr_block = \"10.0.0.0/16\" tags = { - Name = \"vpc-handson\" + Name = \"vpc-handson-hoge\" } } Terraform\u3067\u306f\u30b3\u30fc\u30c9\u3092\u9069\u7528\u3059\u308b\u524d\u306b\u3001\u3069\u306e\u3088\u3046\u306a\u5909\u66f4\u304c\u304b\u304b\u308b\u306e\u304b\u78ba\u8a8d(\u6240\u8b02dry-run)\u3092\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002 \u5b9f\u969b\u306b\u3069\u306e\u3088\u3046\u306a\u5909\u66f4\u304c\u304b\u304b\u308b\u306e\u304b\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002 # terraform plan The refreshed state will be used to calculate this plan, but will not be persisted to local or remote state storage. aws_vpc.main: Refreshing state... (ID: vpc-001c076e2cd2e79af) ------------------------------------------------------------------------ An execution plan has been generated and is shown below. Resource actions are indicated with the following symbols: ~ update in-place Terraform will perform the following actions: ~ aws_vpc.main tags.Name: \"vpc-handson\" => \"vpc-handson-hoge\" Plan: 0 to add, 1 to change, 0 to destroy. ------------------------------------------------------------------------ Note: You didn't specify an \"-out\" parameter to save this plan, so Terraform can't guarantee that exactly these actions will be performed if \"terraform apply\" is subsequently run. \u5909\u66f4\u306e\u5dee\u5206\u304c\u691c\u51fa\u3067\u304d\u3001\u305d\u306e\u5dee\u5206\u3092\u51fa\u529b\u3057\u305f\u5f8c\u306b\u30b3\u30de\u30f3\u30c9\u304c\u7d42\u4e86\u3057\u307e\u3057\u305f\u3002 Terraform\u3092\u5b9f\u884c\u3059\u308b\u969b\u306f\u30aa\u30da\u30df\u30b9\u3092\u9632\u3050\u305f\u3081\u306b\u3082 terraform apply \u3067\u5b9f\u884c\u3059\u308b\u524d\u306b\u3001 terraform plan \u3067\u3069\u306e\u3088\u3046\u306a\u5909\u66f4\u304c\u304b\u304b\u308b\u306e\u304b\u78ba\u8a8d\u3057\u3066\u304b\u3089\u5b9f\u884c\u3059\u308b\u306e\u304c\u5b9a\u77f3\u3067\u3059\u3002 \u3069\u306e\u3088\u3046\u306a\u5909\u66f4\u304c\u884c\u308f\u308c\u308b\u304b\u691c\u51fa\u3067\u304d\u305f\u306e\u3067\u3001\u5b9f\u969b\u306b\u5909\u66f4\u306e\u9069\u7528\u3092\u884c\u3044\u307e\u3057\u3087\u3046\u3002 # terraform apply : \u9069\u7528\u304c\u5b8c\u4e86\u3057\u305f\u3089VPC\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089\u5909\u66f4\u304c\u9069\u7528\u3067\u304d\u305f\u304b\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002 Terraform\u304c\u7ba1\u7406\u3057\u3066\u3044\u308b\u30ea\u30bd\u30fc\u30b9 \u00b6 Terraform\u304c\u7ba1\u7406\u3057\u3066\u3044\u308b\u30ea\u30bd\u30fc\u30b9\u306f terraform show \u30b3\u30de\u30f3\u30c9\u3067\u95b2\u89a7\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002 \u307e\u305a\u306f\u30b3\u30de\u30f3\u30c9\u3092\u6253\u3063\u3066\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002 # terraform show aws_vpc.main: id = vpc-07be0a5e024877c48 arn = arn:aws:ec2:ap-northeast-1:856925507022:vpc/vpc-07be0a5e024877c48 assign_generated_ipv6_cidr_block = false cidr_block = 10.0.0.0/16 default_network_acl_id = acl-0a00c5fa26f28e853 default_route_table_id = rtb-0681966791d3ad652 default_security_group_id = sg-0a5a4b4a19b9d4240 dhcp_options_id = dopt-23aa3947 enable_classiclink = false enable_classiclink_dns_support = false enable_dns_hostnames = false enable_dns_support = true instance_tenancy = default ipv6_association_id = ipv6_cidr_block = main_route_table_id = rtb-0681966791d3ad652 owner_id = 856925507022 tags.% = 1 tags.Name = vpc-handson-hoge Terraform\u304c\u7ba1\u7406\u3057\u3066\u3044\u308b\u30ea\u30bd\u30fc\u30b9\u306f terraform.tfstate \u3068\u3044\u3046JSON\u30d5\u30a1\u30a4\u30eb\u306b\u683c\u7d0d\u3055\u308c\u307e\u3059\u3002 Terraform\u30b3\u30fc\u30c9\u306e\u9069\u7528\u3092\u884c\u3046\u969b\u306f\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u53c2\u7167\u3057\u3001\u5dee\u5206\u306e\u78ba\u8a8d\u3092\u884c\u3063\u3066\u3044\u307e\u3059\u3002 # ls main.tf terraform.tfstate terraform.tfstate.backup # cat terraform.tfstate { \"version\": 3, \"terraform_version\": \"0.11.13\", \"serial\": 5, \"lineage\": \"40f395d7-8d59-b14c-f92f-e836258630af\", \"modules\": [ { \"path\": [ \"root\" ], Terraform\u306f \u30a4\u30f3\u30d5\u30e9\u3092\u30b3\u30fc\u30c9\u3067\u5ba3\u8a00\u3059\u308b \u305f\u3081\u306e\u30c4\u30fc\u30eb\u3067\u3059\u3002 \u305d\u306e\u305f\u3081\u3001\u30b3\u30fc\u30c9\u3067\u5b9a\u7fa9\u3055\u308c\u305f\u72b6\u614b\u306b\u306a\u308b\u3088\u3046\u306b\u52d5\u4f5c\u3057\u307e\u3059\u3002 \u73fe\u5728\u306eapply\u304c\u5b8c\u4e86\u3057\u305f\u72b6\u614b\u3067 terraform plan \u30b3\u30de\u30f3\u30c9\u3092\u6253\u3063\u3066\u3082\u5dee\u5206\u304c\u691c\u51fa\u3055\u308c\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046 # terraform plan terraform.tfstate\u3092\u30af\u30e9\u30a6\u30c9\u3067\u7ba1\u7406\u3059\u308b \u524d\u63d0\u3068\u3057\u3066 terraform.tfstate \u3092\u30ed\u30fc\u30ab\u30eb\u4e0a\u3067\u7ba1\u7406\u3059\u308b\u306e\u306f\u5371\u967a\u3067\u3059\u3002 Terraform\u306f\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u53c2\u7167\u3057\u3066\u30b3\u30fc\u30c9\u306e\u72b6\u614b\u3092\u9069\u7528\u3059\u308b\u306e\u3067\u3001\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u5b58\u5728\u3057\u306a\u3044\u3068\u5dee\u5206\u304c\u691c\u77e5\u3067\u304d\u305a\u306b\u65b0\u3057\u304f\u30ea\u30bd\u30fc\u30b9\u304c\u4f5c\u6210\u3055\u308c\u3066\u3057\u307e\u3044\u307e\u3059\u3002 \u3082\u3057\u300c\u30ed\u30fc\u30ab\u30eb\u30de\u30b7\u30f3\u304c\u58ca\u308c\u305f\u5834\u5408\u300d\u300c\u8907\u6570\u4eba\u3067\u958b\u767a\u3057\u305f\u3044\u5834\u5408\u300d\u306a\u3069\u3001\u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u958b\u767a\u3067\u4f7f\u7528\u3059\u308b\u5834\u5408\u306f\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3092\u884c\u3046\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 \u305d\u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u306e\u6a5f\u80fd\u3068\u3057\u3066Terraform\u306f \"backend\" \u3068\u3044\u3046 terraform.tfstate \u3092S3\u306a\u3069\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u30b9\u30c8\u30ec\u30fc\u30b8\u306b\u4fdd\u7ba1\u3059\u308b\u6a5f\u80fd\u304c\u5b58\u5728\u3059\u308b\u306e\u3067\u3001\u672c\u756a\u3067Terraform\u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\u306f\u691c\u8a0e\u3057\u307e\u3057\u3087\u3046\u3002 \u524a\u9664\u3059\u308b \u00b6 Terraform\u3067\u7ba1\u7406\u3055\u308c\u3066\u3044\u308b\u30ea\u30bd\u30fc\u30b9\u3092\u524a\u9664\u3057\u307e\u3057\u3087\u3046\u3002 \u30ef\u30f3\u30b3\u30de\u30f3\u30c9\u3067\u7ba1\u7406\u3057\u3066\u3044\u308b\u30ea\u30bd\u30fc\u30b9\u3092\u524a\u9664\u3067\u304d\u307e\u3059\u3002 \u5b9f\u969b\u306b\u524a\u9664\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002 # terraform destroy aws_vpc.main: Refreshing state... (ID: vpc-001c076e2cd2e79af) An execution plan has been generated and is shown below. Resource actions are indicated with the following symbols: - destroy Terraform will perform the following actions: - aws_vpc.main Plan: 0 to add, 0 to change, 1 to destroy. Do you really want to destroy all resources? Terraform will destroy all your managed infrastructure, as shown above. There is no undo. Only 'yes' will be accepted to confirm. Enter a value: \u524a\u9664\u3092\u5b9f\u884c\u3059\u308b\u304b\u78ba\u8a8d\u304c\u3067\u308b\u306e\u3067\u3001\u554f\u984c\u306a\u3051\u308c\u3070 yes \u3068\u5165\u529b\u3057\u307e\u3059 Enter a value: yes aws_vpc.main: Destroying... (ID: vpc-001c076e2cd2e79af) aws_vpc.main: Destruction complete after 1s Destroy complete! Resources: 1 destroyed. Web\u30b3\u30f3\u30bd\u30fc\u30eb\u3067Terraform\u3067\u4f5c\u6210\u3057\u305fVPC\u304c\u524a\u9664\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046\u3002","title":"\u3068\u308a\u3042\u3048\u305a\u89e6\u3063\u3066\u307f\u308b"},{"location":"first/handson/#_1","text":"\u65b0\u3057\u3044Terminal\u3092\u7acb\u3061\u4e0a\u3052\u3001\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u3053\u306e\u7ae0\u7528\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u3001\u4f5c\u6210\u3057\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u79fb\u52d5\u3057\u3066\u304f\u3060\u3055\u3044\u3002 $ cd ~/Desktop/terraform-handson $ mkdir vpc-handson $ cd vpc-handson Terraform\u3092\u7acb\u3061\u4e0a\u3052\u3066\u3044\u308bTerminal\u306b\u3082\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002 # ls vpc-handson","title":"\u6e96\u5099"},{"location":"first/handson/#hcl","text":"VPC\u3092\u7acb\u3061\u4e0a\u3052\u308b\u305f\u3081\u306e\u30b3\u30fc\u30c9\u3092\u66f8\u304d\u307e\u3059\u3002 \u4ee5\u4e0b\u306e\u30b3\u30fc\u30c9\u3092 main.tf \u306e\u547d\u540d\u3067 vpc-handson/ \u914d\u4e0b\u306b\u4f5c\u6210\u3057\u3066\u304f\u3060\u3055\u3044\u3002 provider \"aws\" { region = \"ap-northeast-1\" } resource \"aws_vpc\" \"main\" { cidr_block = \"10.0.0.0/16\" tags = { Name = \"vpc-handson\" } } \u4eca\u56de\u306f provider \u3068 resource \u306e2\u3064\u3092\u5b9a\u7fa9\u3057\u307e\u3057\u305f\u3002","title":"HCL\u3092\u66f8\u304f"},{"location":"first/handson/#provider","text":"provider\u306f\u305d\u306e\u540d\u306e\u901a\u308a\u30d7\u30ed\u30d0\u30a4\u30c0\u306e\u5b9a\u7fa9\u3092\u884c\u3044\u307e\u3059\u3002 \u4eca\u56de\u306fAWS\u3092\u4f7f\u7528\u3057\u305f\u3044\u305f\u3081 aws \u3068\u5ba3\u8a00\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u4ed6\u306b\u3082 gcp \u3084 azure \u306a\u3069\u69d8\u3005\u306a\u30d7\u30ed\u30d0\u30a4\u30c0\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u307e\u3059\u3002 \u307e\u305f\u3001provider\u30d6\u30ed\u30c3\u30af\u5185\u3067 region = \"ap-northeast-1\" \u3068\u5b9a\u7fa9\u3057\u3066\u3044\u307e\u3059\u3002 \u3053\u3053\u3067\u6307\u5b9a\u3057\u305f\u30ea\u30fc\u30b8\u30e7\u30f3\u306bVPC\u3084EC2\u306a\u3069\u306e\u5404\u7a2e\u30ea\u30bd\u30fc\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002 \u4eca\u56de\u306f\"ap-northeast-1\"(\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3)\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002","title":"provider"},{"location":"first/handson/#resource","text":"resource\u306fVPC\u3084EC2\u306e\u3088\u3046\u306a\u8d77\u52d5\u3057\u305f\u3044\u30ea\u30bd\u30fc\u30b9\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002 \u4eca\u56de\u306f\u30b3\u30fc\u30c9\u3078VPC\u3092\u5b9a\u7fa9\u3057\u307e\u3057\u305f\u3002\u3053\u308c\u3092\u5b9f\u884c\u3059\u308b\u3053\u3068\u3067 \u300cvpc-handson\u3068\u3044\u3046\u540d\u524d\u3067CIDR\u304c10.0.0.0/16\u306eVPC\u300d \u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002 \u8a18\u8ff0\u3057\u305f\u30b3\u30fc\u30c9\u304c\u3069\u306e\u3088\u3046\u306a\u610f\u5473\u3092\u6301\u3064\u304b\u30011\u3064\u305a\u3064\u898b\u3066\u3044\u304d\u307e\u3057\u3087\u3046\u3002 1\u884c\u76ee\u304b\u3089\u898b\u3066\u3044\u304d\u307e\u3057\u3087\u3046\u3002","title":"resource"},{"location":"first/handson/#resource_1","text":"resource \"aws_vpc\" \"main\" { \u3053\u3053\u3067\u306f \u300c\"aws_vpc\"\u3068\u3044\u3046\u30ea\u30bd\u30fc\u30b9\u3092\"main\"\u3068\u3044\u3046\u540d\u524d\u300d \u3067\u4f5c\u6210\u3057\u3066\u3044\u307e\u3059\u3002 resource \"aws_vpc\" \u307e\u3067\u306fAWS\u306eVPC\u3092\u4f5c\u6210\u3059\u308b\u3068\u3044\u3046\u610f\u5473\u3067\u3001 \"main\" \u306fTerraform\u3067\u5b9a\u7fa9\u3059\u308b\u4ed6\u306e\u30ea\u30bd\u30fc\u30b9\u304b\u3089\u53c2\u7167\u3059\u308b\u969b\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002 \u4f8b\u3068\u3057\u3066\u300cVPC\u3092\u4f5c\u6210\u3057\u3001\u4f5c\u6210\u3057\u305fVPC\u5185\u306bSubnet\u3092\u4f5c\u6210\u3059\u308b\u300d\u30b3\u30fc\u30c9\u3092\u8f09\u305b\u307e\u3059\u3002 # AWS\u30d7\u30ed\u30d0\u30a4\u30c0\u306e\u5b9a\u7fa9 provider \"aws\" { region = \"ap-northeast-1\" } # VPC\u3092\u4f5c\u6210\u3059\u308b resource \"aws_vpc\" \"main\" { # \"main\" \u3068\u3044\u3046\u547d\u540d\u3092\u884c\u3046 cidr_block = \"10.0.0.0/16\" tags = { Name = \"vpc-handson\" } } # Subnet\u3092\u4f5c\u6210\u3059\u308b resource \"aws_subnet\" \"main\" { # \u5225\u306e\u30ea\u30bd\u30fc\u30b9\u3067\u3042\u308c\u3070\u547d\u540d\u304c\u88ab\u3063\u3066\u3044\u3066\u3082\u554f\u984c\u306a\u3044\u3067\u3059 vpc_id = \"${aws_vpc.main.id}\" # aws_vpc.main\u3067main\u3068\u547d\u540d\u3055\u308c\u305fVPC\u3092\u53c2\u7167\u3057\u3001\u305d\u306eVPC\u306eID\u3092\u53d6\u5f97\u3059\u308b cidr_block = \"10.0.1.0/24\" }","title":"resource\u306e\u5b9a\u7fa9\u3068\u547d\u540d"},{"location":"first/handson/#_2","text":"\u8a71\u3092\u623b\u3057\u3066\u3001\u30d6\u30ed\u30c3\u30af\u5185\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u307e\u3059\u3002 \u4eca\u56de\u4f5c\u6210\u3059\u308bVPC\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3001\u300c\"vpc-handson\"\u3068\u3044\u3046\u540d\u524d\u3092\u4ed8\u3051\u3001CIDR\u309210.0.0.0/16\u306b\u8a2d\u5b9a\u3059\u308b\u300d\u3088\u3046\u306b\u8a18\u8ff0\u3055\u308c\u3066\u3044\u307e\u3059\u3002 cidr_block = \"10.0.0.0/16\" tags = { Name = \"vpc-handson\" } \u3053\u308c\u306fVPC\u3084EC2\u306a\u3069\u306e\u30ea\u30bd\u30fc\u30b9\u6bce\u306b\u30d7\u30ed\u30d1\u30c6\u30a3\u304c\u7570\u306a\u308a\u307e\u3059\u3002 \u5b9f\u969b\u306bTerraform\u306e\u30b3\u30fc\u30c9\u3092\u8a18\u8ff0\u3059\u308b\u969b\u306fTerraform\u306e\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\u3092\u898b\u306a\u304c\u3089\u8a18\u8ff0\u3057\u3066\u3044\u304d\u307e\u3059\u3002 AWS: aws_vpc - Terraform by HashiCorp Terraform\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\u306e\u5148\u3078 Terraform\u306fGolang\u3067\u3067\u304d\u3066\u304a\u308a\u3001AWS\u30d7\u30ed\u30d0\u30a4\u30c0\u306fAWS SDK \u306eAPI\u3092\u53e9\u3044\u3066\u3044\u307e\u3059\u3002 \u5b9f\u969b\u306b\u3069\u306e\u3088\u3046\u306a\u5024\u304c\u3069\u306e\u3088\u3046\u306a\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u304b\u3001\u3088\u308a\u8a73\u7d30\u3092\u77e5\u308a\u305f\u3044\u5834\u5408\u306fAWS\u306eAPI\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\u3092\u898b\u3066\u307f\u308b\u306e\u3082\u3042\u308a\u3067\u3057\u3087\u3046\u3002 CreateVpc - Amazon Elastic Compute Cloud","title":"\u30ea\u30bd\u30fc\u30b9\u306e\u30d7\u30ed\u30d1\u30c6\u30a3"},{"location":"first/handson/#terraform","text":"","title":"Terraform\u306e\u5b9f\u884c"},{"location":"first/handson/#_3","text":"Terraform\u3067\u65b0\u3057\u304f\u8a2d\u5b9a\u3092\u8a18\u8ff0\u3057\u305f\u5834\u5408\u3001\u521d\u671f\u5316\u3092\u884c\u3046\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 \u7d20\u306eTerraform\u306f\u30d7\u30ed\u30d0\u30a4\u30c0\u30fc\u304c\u5185\u90e8\u306b\u7d44\u307f\u8fbc\u307e\u308c\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u4eca\u56de\u3067\u3042\u308c\u3070AWS\u30d7\u30ed\u30d0\u30a4\u30c0\u30fc\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u304c\u884c\u308f\u308c\u307e\u3059\u3002 \u521d\u671f\u5316\u3092\u884c\u3063\u3066\u307f\u307e\u3057\u3087\u3046\u3002 # terraform init Initializing provider plugins... - Checking for available provider plugins on https://releases.hashicorp.com... - Downloading plugin for provider \"aws\" (2.6.0)... The following providers do not have any version constraints in configuration, so the latest version was installed. To prevent automatic upgrades to new major versions that may contain breaking changes, it is recommended to add version = \"...\" constraints to the corresponding provider blocks in configuration, with the constraint strings suggested below. * provider.aws: version = \"~> 2.6\" Terraform has been successfully initialized! You may now begin working with Terraform. Try running \"terraform plan\" to see any changes that are required for your infrastructure. All Terraform commands should now work. If you ever set or change modules or backend configuration for Terraform, rerun this command to reinitialize your working directory. If you forget, other commands will detect it and remind you to do so if necessary.","title":"\u521d\u671f\u5316"},{"location":"first/handson/#_4","text":"\u30b3\u30fc\u30c9\u306e\u72b6\u614b\u3092AWS\u4e0a\u3078\u9069\u7528\u3057\u307e\u3057\u3087\u3046\u3002 # terraform apply An execution plan has been generated and is shown below. Resource actions are indicated with the following symbols: + create Terraform will perform the following actions: + aws_vpc.main id: <computed> arn: <computed> assign_generated_ipv6_cidr_block: \"false\" cidr_block: \"10.0.0.0/16\" default_network_acl_id: <computed> default_route_table_id: <computed> default_security_group_id: <computed> dhcp_options_id: <computed> enable_classiclink: <computed> enable_classiclink_dns_support: <computed> enable_dns_hostnames: <computed> enable_dns_support: \"true\" instance_tenancy: \"default\" ipv6_association_id: <computed> ipv6_cidr_block: <computed> main_route_table_id: <computed> owner_id: <computed> tags.%: \"1\" tags.Name: \"vpc-handson\" Plan: 1 to add, 0 to change, 0 to destroy. Do you want to perform these actions? Terraform will perform the actions described above. Only 'yes' will be accepted to approve. Enter a value: Plan: 1 to add, 0 to change, 0 to destroy. \u65b0\u3057\u304f1\u3064\u306e\u30ea\u30bd\u30fc\u30b9\u304c\u8ffd\u52a0\u3055\u308c\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3057\u305f\u3002 \u30ed\u30b0\u3092\u898b\u3066\u554f\u984c\u306a\u3051\u308c\u3070 yes \u3067\u5b9f\u884c\u3092\u7d99\u7d9a\u3057\u307e\u3057\u3087\u3046 Enter a value: yes aws_vpc.main: Creating... arn: \"\" => \"<computed>\" assign_generated_ipv6_cidr_block: \"\" => \"false\" cidr_block: \"\" => \"10.0.0.0/16\" default_network_acl_id: \"\" => \"<computed>\" default_route_table_id: \"\" => \"<computed>\" default_security_group_id: \"\" => \"<computed>\" dhcp_options_id: \"\" => \"<computed>\" enable_classiclink: \"\" => \"<computed>\" enable_classiclink_dns_support: \"\" => \"<computed>\" enable_dns_hostnames: \"\" => \"<computed>\" enable_dns_support: \"\" => \"true\" instance_tenancy: \"\" => \"default\" ipv6_association_id: \"\" => \"<computed>\" ipv6_cidr_block: \"\" => \"<computed>\" main_route_table_id: \"\" => \"<computed>\" owner_id: \"\" => \"<computed>\" tags.%: \"\" => \"1\" tags.Name: \"\" => \"vpc-handson\" aws_vpc.main: Creation complete after 7s (ID: vpc-028d784cfaa5ca479) Apply complete! Resources: 1 added, 0 changed, 0 destroyed. \u30b3\u30f3\u30bd\u30fc\u30eb\u3092\u78ba\u8a8d\u3057\u3066\u5b9f\u969b\u306bVPC\u304c\u8d77\u52d5\u3067\u304d\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046 https://ap-northeast-1.console.aws.amazon.com/vpc/home?region=ap-northeast-1#vpcs:sort=desc:VpcId","title":"\u9069\u7528"},{"location":"first/handson/#_5","text":"VPC\u306e\u540d\u524d\u3092 \"vpc-handson\" \u304b\u3089 \"vpc-handson-hoge\" \u306b\u5909\u66f4\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002 main.tf \u3092\u4ee5\u4e0b\u306e\u901a\u308a\u7de8\u96c6\u3057\u3001VPC\u306e\u547d\u540d\u3092\u5909\u66f4\u3057\u307e\u3059\u3002 provider \"aws\" { region = \"ap-northeast-1\" } resource \"aws_vpc\" \"main\" { cidr_block = \"10.0.0.0/16\" tags = { - Name = \"vpc-handson\" + Name = \"vpc-handson-hoge\" } } Terraform\u3067\u306f\u30b3\u30fc\u30c9\u3092\u9069\u7528\u3059\u308b\u524d\u306b\u3001\u3069\u306e\u3088\u3046\u306a\u5909\u66f4\u304c\u304b\u304b\u308b\u306e\u304b\u78ba\u8a8d(\u6240\u8b02dry-run)\u3092\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002 \u5b9f\u969b\u306b\u3069\u306e\u3088\u3046\u306a\u5909\u66f4\u304c\u304b\u304b\u308b\u306e\u304b\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002 # terraform plan The refreshed state will be used to calculate this plan, but will not be persisted to local or remote state storage. aws_vpc.main: Refreshing state... (ID: vpc-001c076e2cd2e79af) ------------------------------------------------------------------------ An execution plan has been generated and is shown below. Resource actions are indicated with the following symbols: ~ update in-place Terraform will perform the following actions: ~ aws_vpc.main tags.Name: \"vpc-handson\" => \"vpc-handson-hoge\" Plan: 0 to add, 1 to change, 0 to destroy. ------------------------------------------------------------------------ Note: You didn't specify an \"-out\" parameter to save this plan, so Terraform can't guarantee that exactly these actions will be performed if \"terraform apply\" is subsequently run. \u5909\u66f4\u306e\u5dee\u5206\u304c\u691c\u51fa\u3067\u304d\u3001\u305d\u306e\u5dee\u5206\u3092\u51fa\u529b\u3057\u305f\u5f8c\u306b\u30b3\u30de\u30f3\u30c9\u304c\u7d42\u4e86\u3057\u307e\u3057\u305f\u3002 Terraform\u3092\u5b9f\u884c\u3059\u308b\u969b\u306f\u30aa\u30da\u30df\u30b9\u3092\u9632\u3050\u305f\u3081\u306b\u3082 terraform apply \u3067\u5b9f\u884c\u3059\u308b\u524d\u306b\u3001 terraform plan \u3067\u3069\u306e\u3088\u3046\u306a\u5909\u66f4\u304c\u304b\u304b\u308b\u306e\u304b\u78ba\u8a8d\u3057\u3066\u304b\u3089\u5b9f\u884c\u3059\u308b\u306e\u304c\u5b9a\u77f3\u3067\u3059\u3002 \u3069\u306e\u3088\u3046\u306a\u5909\u66f4\u304c\u884c\u308f\u308c\u308b\u304b\u691c\u51fa\u3067\u304d\u305f\u306e\u3067\u3001\u5b9f\u969b\u306b\u5909\u66f4\u306e\u9069\u7528\u3092\u884c\u3044\u307e\u3057\u3087\u3046\u3002 # terraform apply : \u9069\u7528\u304c\u5b8c\u4e86\u3057\u305f\u3089VPC\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089\u5909\u66f4\u304c\u9069\u7528\u3067\u304d\u305f\u304b\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002","title":"\u30ea\u30bd\u30fc\u30b9\u306e\u5909\u66f4\u3092\u884c\u3046"},{"location":"first/handson/#terraform_1","text":"Terraform\u304c\u7ba1\u7406\u3057\u3066\u3044\u308b\u30ea\u30bd\u30fc\u30b9\u306f terraform show \u30b3\u30de\u30f3\u30c9\u3067\u95b2\u89a7\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002 \u307e\u305a\u306f\u30b3\u30de\u30f3\u30c9\u3092\u6253\u3063\u3066\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002 # terraform show aws_vpc.main: id = vpc-07be0a5e024877c48 arn = arn:aws:ec2:ap-northeast-1:856925507022:vpc/vpc-07be0a5e024877c48 assign_generated_ipv6_cidr_block = false cidr_block = 10.0.0.0/16 default_network_acl_id = acl-0a00c5fa26f28e853 default_route_table_id = rtb-0681966791d3ad652 default_security_group_id = sg-0a5a4b4a19b9d4240 dhcp_options_id = dopt-23aa3947 enable_classiclink = false enable_classiclink_dns_support = false enable_dns_hostnames = false enable_dns_support = true instance_tenancy = default ipv6_association_id = ipv6_cidr_block = main_route_table_id = rtb-0681966791d3ad652 owner_id = 856925507022 tags.% = 1 tags.Name = vpc-handson-hoge Terraform\u304c\u7ba1\u7406\u3057\u3066\u3044\u308b\u30ea\u30bd\u30fc\u30b9\u306f terraform.tfstate \u3068\u3044\u3046JSON\u30d5\u30a1\u30a4\u30eb\u306b\u683c\u7d0d\u3055\u308c\u307e\u3059\u3002 Terraform\u30b3\u30fc\u30c9\u306e\u9069\u7528\u3092\u884c\u3046\u969b\u306f\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u53c2\u7167\u3057\u3001\u5dee\u5206\u306e\u78ba\u8a8d\u3092\u884c\u3063\u3066\u3044\u307e\u3059\u3002 # ls main.tf terraform.tfstate terraform.tfstate.backup # cat terraform.tfstate { \"version\": 3, \"terraform_version\": \"0.11.13\", \"serial\": 5, \"lineage\": \"40f395d7-8d59-b14c-f92f-e836258630af\", \"modules\": [ { \"path\": [ \"root\" ], Terraform\u306f \u30a4\u30f3\u30d5\u30e9\u3092\u30b3\u30fc\u30c9\u3067\u5ba3\u8a00\u3059\u308b \u305f\u3081\u306e\u30c4\u30fc\u30eb\u3067\u3059\u3002 \u305d\u306e\u305f\u3081\u3001\u30b3\u30fc\u30c9\u3067\u5b9a\u7fa9\u3055\u308c\u305f\u72b6\u614b\u306b\u306a\u308b\u3088\u3046\u306b\u52d5\u4f5c\u3057\u307e\u3059\u3002 \u73fe\u5728\u306eapply\u304c\u5b8c\u4e86\u3057\u305f\u72b6\u614b\u3067 terraform plan \u30b3\u30de\u30f3\u30c9\u3092\u6253\u3063\u3066\u3082\u5dee\u5206\u304c\u691c\u51fa\u3055\u308c\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046 # terraform plan terraform.tfstate\u3092\u30af\u30e9\u30a6\u30c9\u3067\u7ba1\u7406\u3059\u308b \u524d\u63d0\u3068\u3057\u3066 terraform.tfstate \u3092\u30ed\u30fc\u30ab\u30eb\u4e0a\u3067\u7ba1\u7406\u3059\u308b\u306e\u306f\u5371\u967a\u3067\u3059\u3002 Terraform\u306f\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u53c2\u7167\u3057\u3066\u30b3\u30fc\u30c9\u306e\u72b6\u614b\u3092\u9069\u7528\u3059\u308b\u306e\u3067\u3001\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u5b58\u5728\u3057\u306a\u3044\u3068\u5dee\u5206\u304c\u691c\u77e5\u3067\u304d\u305a\u306b\u65b0\u3057\u304f\u30ea\u30bd\u30fc\u30b9\u304c\u4f5c\u6210\u3055\u308c\u3066\u3057\u307e\u3044\u307e\u3059\u3002 \u3082\u3057\u300c\u30ed\u30fc\u30ab\u30eb\u30de\u30b7\u30f3\u304c\u58ca\u308c\u305f\u5834\u5408\u300d\u300c\u8907\u6570\u4eba\u3067\u958b\u767a\u3057\u305f\u3044\u5834\u5408\u300d\u306a\u3069\u3001\u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u958b\u767a\u3067\u4f7f\u7528\u3059\u308b\u5834\u5408\u306f\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3092\u884c\u3046\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 \u305d\u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u306e\u6a5f\u80fd\u3068\u3057\u3066Terraform\u306f \"backend\" \u3068\u3044\u3046 terraform.tfstate \u3092S3\u306a\u3069\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u30b9\u30c8\u30ec\u30fc\u30b8\u306b\u4fdd\u7ba1\u3059\u308b\u6a5f\u80fd\u304c\u5b58\u5728\u3059\u308b\u306e\u3067\u3001\u672c\u756a\u3067Terraform\u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\u306f\u691c\u8a0e\u3057\u307e\u3057\u3087\u3046\u3002","title":"Terraform\u304c\u7ba1\u7406\u3057\u3066\u3044\u308b\u30ea\u30bd\u30fc\u30b9"},{"location":"first/handson/#_6","text":"Terraform\u3067\u7ba1\u7406\u3055\u308c\u3066\u3044\u308b\u30ea\u30bd\u30fc\u30b9\u3092\u524a\u9664\u3057\u307e\u3057\u3087\u3046\u3002 \u30ef\u30f3\u30b3\u30de\u30f3\u30c9\u3067\u7ba1\u7406\u3057\u3066\u3044\u308b\u30ea\u30bd\u30fc\u30b9\u3092\u524a\u9664\u3067\u304d\u307e\u3059\u3002 \u5b9f\u969b\u306b\u524a\u9664\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002 # terraform destroy aws_vpc.main: Refreshing state... (ID: vpc-001c076e2cd2e79af) An execution plan has been generated and is shown below. Resource actions are indicated with the following symbols: - destroy Terraform will perform the following actions: - aws_vpc.main Plan: 0 to add, 0 to change, 1 to destroy. Do you really want to destroy all resources? Terraform will destroy all your managed infrastructure, as shown above. There is no undo. Only 'yes' will be accepted to confirm. Enter a value: \u524a\u9664\u3092\u5b9f\u884c\u3059\u308b\u304b\u78ba\u8a8d\u304c\u3067\u308b\u306e\u3067\u3001\u554f\u984c\u306a\u3051\u308c\u3070 yes \u3068\u5165\u529b\u3057\u307e\u3059 Enter a value: yes aws_vpc.main: Destroying... (ID: vpc-001c076e2cd2e79af) aws_vpc.main: Destruction complete after 1s Destroy complete! Resources: 1 destroyed. Web\u30b3\u30f3\u30bd\u30fc\u30eb\u3067Terraform\u3067\u4f5c\u6210\u3057\u305fVPC\u304c\u524a\u9664\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046\u3002","title":"\u524a\u9664\u3059\u308b"},{"location":"first/preparation/","text":"Terraform\u306fCLI\u4e0a\u304b\u3089 terraform \u3068\u3044\u3046\u30b3\u30de\u30f3\u30c9\u3092\u6253\u3064\u3053\u3068\u3067\u5b9f\u884c\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002 \u3053\u306e\u7ae0\u3067\u306f terraform \u30b3\u30de\u30f3\u30c9\u3092Docker\u4e0a\u3067\u52d5\u304b\u3059\u305f\u3081\u306e\u6e96\u5099\u3092\u3057\u307e\u3059\u3002 \u306a\u305cDocker\u3067\u30cf\u30f3\u30ba\u30aa\u30f3\u3092\u884c\u3046\u306e\u304b Docker\u306f\u30d1\u30c3\u30b1\u30fc\u30b8\u30f3\u30b0\u3092\u884c\u3046\u305f\u3081\u306e\u6280\u8853\u3067\u3059\u3002 \u30b5\u30fc\u30d0\u30fc\u3092\u8d77\u52d5\u3059\u308b\u3060\u3051\u3067\u306f\u306a\u304f\u3001\u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u56fa\u5b9a\u3084\u4e0d\u8981\u306a\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u306e\u7121\u3044\u30af\u30ea\u30fc\u30f3\u306a\u74b0\u5883\u3092\u7528\u610f\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002 \u30b3\u30f3\u30c6\u30ca\u5185\u3060\u3051\u3067\u5b8c\u7d50\u3059\u308b\u305f\u3081\u30db\u30b9\u30c8\u30de\u30b7\u30f3\u306e\u74b0\u5883\u3092\u6c5a\u3055\u305a\u306b\u4f7f\u7528\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002 \u307e\u305f\u3001\u30db\u30b9\u30c8\u30de\u30b7\u30f3\u4e0a\u3067terraform\u3092\u4f7f\u7528\u3057\u305f\u3044\u5834\u5408\u306f\u76f4\u63a5terraform\u30b3\u30de\u30f3\u30c9\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u305b\u305a\u3001\u30d0\u30fc\u30b8\u30e7\u30f3\u7ba1\u7406\u304c\u53ef\u80fd\u306a\u30c4\u30fc\u30eb(e.g. tfenv )\u3092\u4f7f\u7528\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3053\u3068\u3092\u63a8\u5968\u3057\u307e\u3059\u3002 IAM\u30e6\u30fc\u30b6\u30fc\u306e\u4f5c\u6210 \u00b6 \u307e\u305a\u306fAWS\u306eWeb\u30b3\u30f3\u30bd\u30fc\u30eb\u3078\u30a2\u30af\u30bb\u30b9\u3057\u3066Terraform\u5b9f\u884c\u7528\u306eIAM\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\u3057\u3001\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002 AWS Web\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089IAM\u30b5\u30fc\u30d3\u30b9\u3078\u30a2\u30af\u30bb\u30b9 IAM\u30b5\u30fc\u30d3\u30b9\u306e\u30c8\u30c3\u30d7\u30da\u30fc\u30b8\u304b\u3089\u30e6\u30fc\u30b6\u30fc\u4e00\u89a7\u3078\u30a2\u30af\u30bb\u30b9\u3002 \u300c\u30e6\u30fc\u30b6\u30fc\u3092\u8ffd\u52a0\u300d\u3092\u9078\u629e\u3057\u3001IAM\u30e6\u30fc\u30b6\u30fc\u306e\u4f5c\u6210\u958b\u59cb\u3002 \u30e6\u30fc\u30b6\u30fc\u540d\u3092\u300cTerraform\u300d\u306b\u8a2d\u5b9a\u3057\u3001\u300c\u30d7\u30ed\u30b0\u30e9\u30e0\u306b\u3088\u308b\u30a2\u30af\u30bb\u30b9\u300d\u3092\u6709\u52b9\u5316\u3002 \u300c\u6b21\u306e\u30b9\u30c6\u30c3\u30d7:\u30a2\u30af\u30bb\u30b9\u6a29\u9650\u300d\u3092\u62bc\u4e0b\u3002 \u300c\u65e2\u5b58\u306e\u30dd\u30ea\u30b7\u30fc\u3092\u76f4\u63a5\u30a2\u30bf\u30c3\u30c1\u300d\u3092\u9078\u629e\u3057\u3001\u300cAdministratorAccess\u300d\u30dd\u30ea\u30b7\u30fc(\u7ba1\u7406\u8005\u6a29\u9650)\u3092\u9078\u629e\u3002 \u300c\u6b21\u306e\u30b9\u30c6\u30c3\u30d7:\u30bf\u30b0\u300d\u3092\u62bc\u4e0b\u3002 \u30bf\u30b0\u306f\u5165\u529b\u305b\u305a\u3001\u305d\u306e\u307e\u307e\u300c\u6b21\u306e\u30b9\u30c6\u30c3\u30d7:\u78ba\u8a8d\u300d\u3092\u62bc\u4e0b\u3002 \u300c\u30e6\u30fc\u30b6\u30fc\u306e\u4f5c\u6210\u300d\u3092\u62bc\u4e0b\u3057\u3001IAM\u30e6\u30fc\u30b6\u30fc\u306e\u4f5c\u6210\u304c\u5b8c\u4e86\u3002 \u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u3092\u53d6\u5f97\u3067\u304d\u308b\u306e\u3067\u3001\u4ed6\u4eba\u306b\u3082\u308c\u306a\u3044\u3088\u3046\u306b\u63a7\u3048\u308b\u3002 \u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30ad\u30fc\u3092git\u3078\u4e0a\u3052\u306a\u3044\u305f\u3081\u306e\u4fdd\u967a git commit\u6642\u306bcommit\u306e\u5185\u5bb9\u3092\u30b9\u30ad\u30e3\u30f3\u3057\u3001AWS\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u304c\u542b\u307e\u308c\u3066\u3044\u305f\u3089\u305d\u306ecommit\u3092\u30ea\u30b8\u30a7\u30af\u30c8\u3057\u3066\u304f\u308c\u308b\u30c4\u30fc\u30eb\"git-secret\"\u304c\u5b58\u5728\u3057\u307e\u3059\u3002 \u4fdd\u967a\u306e\u305f\u3081\u306b\u3082AWS\u3092\u6271\u3046\u30ea\u30dd\u30b8\u30c8\u30ea\u3067\u306f\u6709\u52b9\u5316\u3057\u3066\u304a\u304f\u3068\u826f\u3044\u3067\u3057\u3087\u3046\u3002 awslabs/git-secrets: Prevents you from committing secrets and credentials into git repositories terraform\u3092Docker\u3067\u8d77\u52d5 \u00b6 \u307e\u305a\u306f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u4f5c\u6210\u3092\u3057\u3066\u30c1\u30a7\u30c3\u30af\u30a2\u30a6\u30c8\u3057\u307e\u3059\u3002 Desktop\u3078\"terraform-handson\"\u3068\u3044\u3046\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u307e\u3059\u304c\u3001\u6c17\u306b\u306a\u308b\u65b9\u306f\u9069\u5b9c\u4fee\u6b63\u3057\u3066\u304f\u3060\u3055\u3044\u3002 $ mkdir ~/Desktop/terraform-handson $ cd ~/Desktop/terraform-handson \u6b21\u306b\u3001Terraform\u3092Docker\u3067\u8d77\u52d5\u3057\u307e\u3059\u3002 \u305d\u306e\u969b\u306b\u5148\u7a0b\u53d6\u5f97\u3057\u305fIAM\u30e6\u30fc\u30b6\u30fc\u306e\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u3068\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30ad\u30fc\u3092\u6e21\u3059\u3053\u3068\u3067Terraform\u304cAWS\u306eAPI\u3078\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002 \u307e\u305f\u3001\u30db\u30b9\u30c8\u306e\u30ab\u30ec\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u30b3\u30f3\u30c6\u30ca\u4e0a\u3078\u30de\u30a6\u30f3\u30c8( -v $(pwd):/terraform )\u3057\u3066\u30d5\u30a1\u30a4\u30eb\u306e\u5171\u6709\u3092\u884c\u3044\u307e\u3059\u3002 \u4eca\u5f8c\u306e\u8a18\u8ff0\u3059\u308bTerraform\u306e\u30b3\u30fc\u30c9\u306f\u3053\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u914d\u7f6e\u3057\u3066\u30b3\u30f3\u30c6\u30ca\u3068\u5171\u6709\u3057\u307e\u3059\u3002 $ docker run \\ -e AWS_ACCESS_KEY_ID = <AWS ACCESS KEY> \\ -e AWS_SECRET_ACCESS_KEY = <AWS SECRET ACCESS KEY> \\ -v $( pwd ) :/terraform \\ -w /terraform \\ -it \\ --entrypoint = ash \\ hashicorp/terraform:0.11.13 \u3053\u308c\u3067Terraform\u306e\u5b9f\u884c\u74b0\u5883\u304c\u624b\u306b\u5165\u308a\u307e\u3057\u305f \u6700\u5f8c\u306b\u3001Docker\u5185\u3067Terraform\u3092\u64cd\u4f5c\u3059\u308b\u305f\u3081\u306e\u30b3\u30de\u30f3\u30c9 terraform \u304c\u52d5\u304f\u304b\u8a66\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002 # terraform version Terraform v0.11.13","title":"\u74b0\u5883\u3092\u6e96\u5099\u3059\u308b"},{"location":"first/preparation/#iam","text":"\u307e\u305a\u306fAWS\u306eWeb\u30b3\u30f3\u30bd\u30fc\u30eb\u3078\u30a2\u30af\u30bb\u30b9\u3057\u3066Terraform\u5b9f\u884c\u7528\u306eIAM\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\u3057\u3001\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002 AWS Web\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089IAM\u30b5\u30fc\u30d3\u30b9\u3078\u30a2\u30af\u30bb\u30b9 IAM\u30b5\u30fc\u30d3\u30b9\u306e\u30c8\u30c3\u30d7\u30da\u30fc\u30b8\u304b\u3089\u30e6\u30fc\u30b6\u30fc\u4e00\u89a7\u3078\u30a2\u30af\u30bb\u30b9\u3002 \u300c\u30e6\u30fc\u30b6\u30fc\u3092\u8ffd\u52a0\u300d\u3092\u9078\u629e\u3057\u3001IAM\u30e6\u30fc\u30b6\u30fc\u306e\u4f5c\u6210\u958b\u59cb\u3002 \u30e6\u30fc\u30b6\u30fc\u540d\u3092\u300cTerraform\u300d\u306b\u8a2d\u5b9a\u3057\u3001\u300c\u30d7\u30ed\u30b0\u30e9\u30e0\u306b\u3088\u308b\u30a2\u30af\u30bb\u30b9\u300d\u3092\u6709\u52b9\u5316\u3002 \u300c\u6b21\u306e\u30b9\u30c6\u30c3\u30d7:\u30a2\u30af\u30bb\u30b9\u6a29\u9650\u300d\u3092\u62bc\u4e0b\u3002 \u300c\u65e2\u5b58\u306e\u30dd\u30ea\u30b7\u30fc\u3092\u76f4\u63a5\u30a2\u30bf\u30c3\u30c1\u300d\u3092\u9078\u629e\u3057\u3001\u300cAdministratorAccess\u300d\u30dd\u30ea\u30b7\u30fc(\u7ba1\u7406\u8005\u6a29\u9650)\u3092\u9078\u629e\u3002 \u300c\u6b21\u306e\u30b9\u30c6\u30c3\u30d7:\u30bf\u30b0\u300d\u3092\u62bc\u4e0b\u3002 \u30bf\u30b0\u306f\u5165\u529b\u305b\u305a\u3001\u305d\u306e\u307e\u307e\u300c\u6b21\u306e\u30b9\u30c6\u30c3\u30d7:\u78ba\u8a8d\u300d\u3092\u62bc\u4e0b\u3002 \u300c\u30e6\u30fc\u30b6\u30fc\u306e\u4f5c\u6210\u300d\u3092\u62bc\u4e0b\u3057\u3001IAM\u30e6\u30fc\u30b6\u30fc\u306e\u4f5c\u6210\u304c\u5b8c\u4e86\u3002 \u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u3092\u53d6\u5f97\u3067\u304d\u308b\u306e\u3067\u3001\u4ed6\u4eba\u306b\u3082\u308c\u306a\u3044\u3088\u3046\u306b\u63a7\u3048\u308b\u3002 \u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30ad\u30fc\u3092git\u3078\u4e0a\u3052\u306a\u3044\u305f\u3081\u306e\u4fdd\u967a git commit\u6642\u306bcommit\u306e\u5185\u5bb9\u3092\u30b9\u30ad\u30e3\u30f3\u3057\u3001AWS\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u304c\u542b\u307e\u308c\u3066\u3044\u305f\u3089\u305d\u306ecommit\u3092\u30ea\u30b8\u30a7\u30af\u30c8\u3057\u3066\u304f\u308c\u308b\u30c4\u30fc\u30eb\"git-secret\"\u304c\u5b58\u5728\u3057\u307e\u3059\u3002 \u4fdd\u967a\u306e\u305f\u3081\u306b\u3082AWS\u3092\u6271\u3046\u30ea\u30dd\u30b8\u30c8\u30ea\u3067\u306f\u6709\u52b9\u5316\u3057\u3066\u304a\u304f\u3068\u826f\u3044\u3067\u3057\u3087\u3046\u3002 awslabs/git-secrets: Prevents you from committing secrets and credentials into git repositories","title":"IAM\u30e6\u30fc\u30b6\u30fc\u306e\u4f5c\u6210"},{"location":"first/preparation/#terraformdocker","text":"\u307e\u305a\u306f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u4f5c\u6210\u3092\u3057\u3066\u30c1\u30a7\u30c3\u30af\u30a2\u30a6\u30c8\u3057\u307e\u3059\u3002 Desktop\u3078\"terraform-handson\"\u3068\u3044\u3046\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u307e\u3059\u304c\u3001\u6c17\u306b\u306a\u308b\u65b9\u306f\u9069\u5b9c\u4fee\u6b63\u3057\u3066\u304f\u3060\u3055\u3044\u3002 $ mkdir ~/Desktop/terraform-handson $ cd ~/Desktop/terraform-handson \u6b21\u306b\u3001Terraform\u3092Docker\u3067\u8d77\u52d5\u3057\u307e\u3059\u3002 \u305d\u306e\u969b\u306b\u5148\u7a0b\u53d6\u5f97\u3057\u305fIAM\u30e6\u30fc\u30b6\u30fc\u306e\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u3068\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30ad\u30fc\u3092\u6e21\u3059\u3053\u3068\u3067Terraform\u304cAWS\u306eAPI\u3078\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002 \u307e\u305f\u3001\u30db\u30b9\u30c8\u306e\u30ab\u30ec\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u30b3\u30f3\u30c6\u30ca\u4e0a\u3078\u30de\u30a6\u30f3\u30c8( -v $(pwd):/terraform )\u3057\u3066\u30d5\u30a1\u30a4\u30eb\u306e\u5171\u6709\u3092\u884c\u3044\u307e\u3059\u3002 \u4eca\u5f8c\u306e\u8a18\u8ff0\u3059\u308bTerraform\u306e\u30b3\u30fc\u30c9\u306f\u3053\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u914d\u7f6e\u3057\u3066\u30b3\u30f3\u30c6\u30ca\u3068\u5171\u6709\u3057\u307e\u3059\u3002 $ docker run \\ -e AWS_ACCESS_KEY_ID = <AWS ACCESS KEY> \\ -e AWS_SECRET_ACCESS_KEY = <AWS SECRET ACCESS KEY> \\ -v $( pwd ) :/terraform \\ -w /terraform \\ -it \\ --entrypoint = ash \\ hashicorp/terraform:0.11.13 \u3053\u308c\u3067Terraform\u306e\u5b9f\u884c\u74b0\u5883\u304c\u624b\u306b\u5165\u308a\u307e\u3057\u305f \u6700\u5f8c\u306b\u3001Docker\u5185\u3067Terraform\u3092\u64cd\u4f5c\u3059\u308b\u305f\u3081\u306e\u30b3\u30de\u30f3\u30c9 terraform \u304c\u52d5\u304f\u304b\u8a66\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002 # terraform version Terraform v0.11.13","title":"terraform\u3092Docker\u3067\u8d77\u52d5"},{"location":"handson/about/","text":"\u76ee\u6a19 \u00b6 \u4e0a\u8a18\u306e\u753b\u50cf\u304c\u4eca\u56de\u306e\u30cf\u30f3\u30ba\u30aa\u30f3\u3067\u69cb\u7bc9\u3092\u884c\u3046\u69cb\u6210\u56f3\u306b\u306a\u308a\u307e\u3059\u3002 \u76ee\u6a19\u3068\u3057\u3066\u3044\u308b\u306e\u306f\u300cnginx\u306e\u8d77\u52d5\u3068\u305d\u306ehttps\u5316\u300d\u3067\u3059\u3002 \u307e\u305f\u3001\u3053\u306e\u30cf\u30f3\u30ba\u30aa\u30f3\u3067\u4f7f\u7528\u3059\u308b\u30b3\u30fc\u30c9\u306f\u4ee5\u4e0b\u3067\u3059\u3002 https://github.com/y-ohgi/introduction-terraform/tree/master/handson/handson \u4f7f\u7528\u3059\u308b\u30b5\u30fc\u30d3\u30b9\u3068\u7528\u9014 \u00b6 \u30cf\u30f3\u30ba\u30aa\u30f3\u3067\u69cb\u7bc9\u3059\u308b\u30ea\u30bd\u30fc\u30b9\u306b\u3064\u3044\u3066\u6982\u8981\u3092\u8aac\u660e\u3057\u307e\u3059\u3002 Route 53 \u00b6 Hosted Zone \u30c9\u30e1\u30a4\u30f3\u306e\u30ec\u30b3\u30fc\u30c9\u306e\u7ba1\u7406 ACM \u00b6 Certificate AWS\u3067TLS\u8a3c\u660e\u66f8\u306e\u767a\u884c/\u7ba1\u7406\u3092\u884c\u3046\u3002 VPC \u00b6 VPC AWS\u4e0a\u3078\u4eee\u60f3\u7684\u306a\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u4f5c\u6210\u3059\u308b Subnet VPC\u4e0a\u3078\u5c0f\u898f\u6a21\u306a\u4eee\u60f3\u7684\u306a\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u4f5c\u6210\u3059\u308b \u4eca\u56de\u306fPublic Subnet\u3068Private Subnet\u306e2\u7a2e\u985e\u30923\u500b\u305a\u3064(AZ\u5206)\u4f5c\u6210\u3059\u308b\u3002 Internet Gateway VPC\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3060\u3068IN/OUT\u3068\u3082\u306b\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u3078\u306e\u758e\u901a\u306f\u884c\u3048\u306a\u3044\u305f\u3081\u3001\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u3078\u306e\u51fa\u5165\u308a\u53e3\u3092\u4f5c\u308b\u30ea\u30bd\u30fc\u30b9 Route Table \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u7d4c\u8def\u60c5\u5831\u3092\u8a2d\u5b9a\u3059\u308b\u305f\u3081\u306e\u30b5\u30fc\u30d3\u30b9 Subnet\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3060\u3068\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u3078\u758e\u901a\u3067\u304d\u306a\u3044\u305f\u3081\u3001Route Table \u3067Subnet\u3068Internet Gateway\u3092\u7d10\u3065\u3051\u3066\u758e\u901a\u3092\u53ef\u80fd\u306b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b NAT Gateway Private Subnet\u3092\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u3078\u758e\u901a Private Subnet \u3068 Public Subnet \u306e\u9055\u3044 \u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u3068\u306e\u76f8\u4e92\u7684\u306a\u7d4c\u8def\u3092\u8a2d\u5b9a\u3055\u308c\u305fSubnet\u3092Public Subnet\u3068\u547c\u3073\u3001\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u3078\u306e\u7d4c\u8def\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u306a\u3044Subnet\u3092Private Subnet\u3068\u547c\u3073\u307e\u3059\u3002 \u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u3078\u306e\u7d4c\u8def\u306e\u8a2d\u5b9a\u306e\u4ed5\u65b9\u306fSubnet\u3092RouteTable\u3067Internet Gateway \u3068\u7d10\u4ed8\u3051\u308b\u3053\u3068\u3067\u5b9f\u73fe\u3057\u307e\u3059\u3002 \u4f7f\u3044\u5206\u3051\u306f\u5358\u7d14\u3067\u3001\u5916\u90e8\u306b\u516c\u958b\u3059\u308b\u3082\u306e(\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5\u3084\u8e0f\u307f\u53f0)\u306fPublic Subnet\u3067\u3001\u516c\u958b\u3057\u306a\u3044\u3082\u306e(Web/App\u30b5\u30fc\u30d0\u3084DB)\u306fPrivate Subnet\u3078\u914d\u7f6e\u3057\u307e\u3059\u3002 EC2 \u00b6 Application Load Balancer L7\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5 \u53d7\u3051\u53d6\u3063\u305f\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u3092\u7d10\u4ed8\u3051\u3089\u308c\u3066\u3044\u308bTarget Group \u3067\u7ba1\u7406\u3055\u308c\u3066\u3044\u308b\u30b5\u30fc\u30d0\u30fc\u3078\u6e21\u3059 Target Group \u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5\u914d\u4e0b\u306e\u30b5\u30fc\u30d0\u30fc\u306e\u7ba1\u7406 ECS \u00b6 Task Definition \u30b3\u30f3\u30c6\u30ca\u306e\u5b9a\u7fa9 Service Task Definition\u3067\u5b9a\u7fa9\u3055\u308c\u305f\u30b3\u30f3\u30c6\u30ca\u3092\u52d5\u304b\u3059 \u52d5\u304b\u3057\u305f\u30b3\u30f3\u30c6\u30ca\u3092\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5\u3078\u7d10\u4ed8\u3051\u308b","title":"\u6982\u8981"},{"location":"handson/about/#_1","text":"\u4e0a\u8a18\u306e\u753b\u50cf\u304c\u4eca\u56de\u306e\u30cf\u30f3\u30ba\u30aa\u30f3\u3067\u69cb\u7bc9\u3092\u884c\u3046\u69cb\u6210\u56f3\u306b\u306a\u308a\u307e\u3059\u3002 \u76ee\u6a19\u3068\u3057\u3066\u3044\u308b\u306e\u306f\u300cnginx\u306e\u8d77\u52d5\u3068\u305d\u306ehttps\u5316\u300d\u3067\u3059\u3002 \u307e\u305f\u3001\u3053\u306e\u30cf\u30f3\u30ba\u30aa\u30f3\u3067\u4f7f\u7528\u3059\u308b\u30b3\u30fc\u30c9\u306f\u4ee5\u4e0b\u3067\u3059\u3002 https://github.com/y-ohgi/introduction-terraform/tree/master/handson/handson","title":"\u76ee\u6a19"},{"location":"handson/about/#_2","text":"\u30cf\u30f3\u30ba\u30aa\u30f3\u3067\u69cb\u7bc9\u3059\u308b\u30ea\u30bd\u30fc\u30b9\u306b\u3064\u3044\u3066\u6982\u8981\u3092\u8aac\u660e\u3057\u307e\u3059\u3002","title":"\u4f7f\u7528\u3059\u308b\u30b5\u30fc\u30d3\u30b9\u3068\u7528\u9014"},{"location":"handson/about/#route-53","text":"Hosted Zone \u30c9\u30e1\u30a4\u30f3\u306e\u30ec\u30b3\u30fc\u30c9\u306e\u7ba1\u7406","title":"Route 53"},{"location":"handson/about/#acm","text":"Certificate AWS\u3067TLS\u8a3c\u660e\u66f8\u306e\u767a\u884c/\u7ba1\u7406\u3092\u884c\u3046\u3002","title":"ACM"},{"location":"handson/about/#vpc","text":"VPC AWS\u4e0a\u3078\u4eee\u60f3\u7684\u306a\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u4f5c\u6210\u3059\u308b Subnet VPC\u4e0a\u3078\u5c0f\u898f\u6a21\u306a\u4eee\u60f3\u7684\u306a\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u4f5c\u6210\u3059\u308b \u4eca\u56de\u306fPublic Subnet\u3068Private Subnet\u306e2\u7a2e\u985e\u30923\u500b\u305a\u3064(AZ\u5206)\u4f5c\u6210\u3059\u308b\u3002 Internet Gateway VPC\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3060\u3068IN/OUT\u3068\u3082\u306b\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u3078\u306e\u758e\u901a\u306f\u884c\u3048\u306a\u3044\u305f\u3081\u3001\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u3078\u306e\u51fa\u5165\u308a\u53e3\u3092\u4f5c\u308b\u30ea\u30bd\u30fc\u30b9 Route Table \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u7d4c\u8def\u60c5\u5831\u3092\u8a2d\u5b9a\u3059\u308b\u305f\u3081\u306e\u30b5\u30fc\u30d3\u30b9 Subnet\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3060\u3068\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u3078\u758e\u901a\u3067\u304d\u306a\u3044\u305f\u3081\u3001Route Table \u3067Subnet\u3068Internet Gateway\u3092\u7d10\u3065\u3051\u3066\u758e\u901a\u3092\u53ef\u80fd\u306b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b NAT Gateway Private Subnet\u3092\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u3078\u758e\u901a Private Subnet \u3068 Public Subnet \u306e\u9055\u3044 \u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u3068\u306e\u76f8\u4e92\u7684\u306a\u7d4c\u8def\u3092\u8a2d\u5b9a\u3055\u308c\u305fSubnet\u3092Public Subnet\u3068\u547c\u3073\u3001\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u3078\u306e\u7d4c\u8def\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u306a\u3044Subnet\u3092Private Subnet\u3068\u547c\u3073\u307e\u3059\u3002 \u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u3078\u306e\u7d4c\u8def\u306e\u8a2d\u5b9a\u306e\u4ed5\u65b9\u306fSubnet\u3092RouteTable\u3067Internet Gateway \u3068\u7d10\u4ed8\u3051\u308b\u3053\u3068\u3067\u5b9f\u73fe\u3057\u307e\u3059\u3002 \u4f7f\u3044\u5206\u3051\u306f\u5358\u7d14\u3067\u3001\u5916\u90e8\u306b\u516c\u958b\u3059\u308b\u3082\u306e(\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5\u3084\u8e0f\u307f\u53f0)\u306fPublic Subnet\u3067\u3001\u516c\u958b\u3057\u306a\u3044\u3082\u306e(Web/App\u30b5\u30fc\u30d0\u3084DB)\u306fPrivate Subnet\u3078\u914d\u7f6e\u3057\u307e\u3059\u3002","title":"VPC"},{"location":"handson/about/#ec2","text":"Application Load Balancer L7\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5 \u53d7\u3051\u53d6\u3063\u305f\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u3092\u7d10\u4ed8\u3051\u3089\u308c\u3066\u3044\u308bTarget Group \u3067\u7ba1\u7406\u3055\u308c\u3066\u3044\u308b\u30b5\u30fc\u30d0\u30fc\u3078\u6e21\u3059 Target Group \u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5\u914d\u4e0b\u306e\u30b5\u30fc\u30d0\u30fc\u306e\u7ba1\u7406","title":"EC2"},{"location":"handson/about/#ecs","text":"Task Definition \u30b3\u30f3\u30c6\u30ca\u306e\u5b9a\u7fa9 Service Task Definition\u3067\u5b9a\u7fa9\u3055\u308c\u305f\u30b3\u30f3\u30c6\u30ca\u3092\u52d5\u304b\u3059 \u52d5\u304b\u3057\u305f\u30b3\u30f3\u30c6\u30ca\u3092\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5\u3078\u7d10\u4ed8\u3051\u308b","title":"ECS"},{"location":"handson/alb/","text":"\u3053\u306e\u7ae0\u306e\u76ee\u6a19 \u00b6 ALB \u00b6 \u4e0a\u8a18\u306e\u56f3\u304c\u76ee\u6a19\u3068\u306a\u308b\u69cb\u6210\u3067\u3059\u3002\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306f\u7c21\u7565\u5316\u3057\u3066\u3044\u307e\u3059\u3002 http\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u53d7\u3051\u4ed8\u3051\u308b\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5(ALB)\u3068\u3001\u305d\u306eALB\u3078\u306ehttp\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u8a31\u53ef\u3059\u308b\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002 # SecurityGroup # https://www.terraform.io/docs/providers/aws/r/security_group.html resource \"aws_security_group\" \"alb\" { name = \"handson-alb\" description = \"handson alb\" vpc_id = \"${aws_vpc.main.id}\" # \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u5185\u306e\u30ea\u30bd\u30fc\u30b9\u304b\u3089\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3092\u8a31\u53ef\u3059\u308b egress { from_port = 0 to_port = 0 protocol = \"-1\" cidr_blocks = [ \"0.0.0.0/0\" ] } tags = { Name = \"handson-alb\" } } # SecurityGroup Rule # https://www.terraform.io/docs/providers/aws/r/security_group.html resource \"aws_security_group_rule\" \"alb_http\" { security_group_id = \"${aws_security_group.alb.id}\" # \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u5185\u306e\u30ea\u30bd\u30fc\u30b9\u3078\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u304b\u3089\u306e\u30a2\u30af\u30bb\u30b9\u3092\u8a31\u53ef\u3059\u308b type = \"ingress\" from_port = 80 to_port = 80 protocol = \"tcp\" cidr_blocks = [ \"0.0.0.0/0\" ] } # ALB # https://www.terraform.io/docs/providers/aws/d/lb.html resource \"aws_lb\" \"main\" { load_balancer_type = \"application\" name = \"handson\" security_groups = [ \"${aws_security_group.alb.id}\" ] subnets = [ \"${aws_subnet.public_1a.id}\" , \"${aws_subnet.public_1c.id}\" , \"${aws_subnet.public_1d.id}\" ] } \u30b3\u30fc\u30c9\u306e\u9069\u7528\u3092\u884c\u3046\u3068\u30ea\u30bd\u30fc\u30b9\u304c2\u3064\u8ffd\u52a0\u3055\u308c\u308c\u3070\u6210\u529f\u3067\u3059\u3002 # terraform plan : Plan: 3 to add, 0 to change, 0 to destroy. : # terraform apply : \u30b3\u30f3\u30bd\u30fc\u30eb\u4e0a\u3067\u78ba\u8a8d\u3059\u308b\u3068ALB\u304c\u8d77\u52d5\u3057\u3066\u3044\u3066\u3001DNS\u3092\u78ba\u8a8d\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002 https://ap-northeast-1.console.aws.amazon.com/ec2/v2/home?region=ap-northeast-1#LoadBalancers:sort=loadBalancerName \u305f\u3060\u3057\u3001\u3053\u306e\u6642\u70b9\u3067\u306f\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5\u306e\u8a2d\u5b9a(\u30ea\u30b9\u30ca\u30fc\u306e\u8ffd\u52a0)\u3092\u884c\u3063\u3066\u3044\u306a\u3044\u305f\u3081ALB\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u307e\u305b\u3093\u3002 \"\u30ea\u30b9\u30ca\u30fc\" \u3092\u78ba\u8a8d\u3059\u308b\u3068\u8a2d\u5b9a\u304c1\u3064\u3082\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002 \u30ea\u30b9\u30ca\u30fc\u306e\u8a2d\u5b9a \u00b6 ALB\u306b\u767b\u9332\u3055\u308c\u3066\u3044\u308bDNS\u3078http\u3067\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068 \"ok\" \u306e\u56fa\u5b9a\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u8fd4\u3059\u3088\u3046\u306b\u3057\u307e\u3057\u3087\u3046\u3002 \"ok\" \u3092\u8fd4\u3059\u305f\u3081\u306b\u306fALB\u306e\u30ea\u30b9\u30ca\u30fc\u306e\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 Terraform\u3067\u305d\u306e\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3057\u307e\u3057\u3087\u3046\u3002 # Listener # https://www.terraform.io/docs/providers/aws/r/lb_listener.html resource \"aws_lb_listener\" \"main\" { # HTTP\u3067\u306e\u30a2\u30af\u30bb\u30b9\u3092\u53d7\u3051\u4ed8\u3051\u308b port = \"80\" protocol = \"HTTP\" # ALB\u306earn\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002 #XXX: arn\u306fAmazon Resource Names \u306e\u7565\u3067\u3001\u305d\u306e\u540d\u306e\u901a\u308a\u30ea\u30bd\u30fc\u30b9\u3092\u7279\u5b9a\u3059\u308b\u305f\u3081\u306e\u4e00\u610f\u306a\u540d\u524d(id)\u3067\u3059\u3002 load_balancer_arn = \"${aws_lb.main.arn}\" # \"ok\" \u3068\u3044\u3046\u56fa\u5b9a\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u8a2d\u5b9a\u3059\u308b default_action { type = \"fixed-response\" fixed_response { content_type = \"text/plain\" status_code = \"200\" message_body = \"ok\" } } } \u30b3\u30fc\u30c9\u306e\u9069\u7528\u3092\u884c\u3046\u3068\u30ea\u30bd\u30fc\u30b9\u304c1\u3064\u8ffd\u52a0\u3055\u308c\u308c\u3070\u6210\u529f\u3067\u3059\u3002 # terraform plan : Plan: 1 to add, 0 to change, 0 to destroy. : # terraform apply : ALB\u304chttp\u3092\u53d7\u3051\u4ed8\u3051\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002 ALB\u306eDNS\u3078\u30a2\u30af\u30bb\u30b9\u3057\u3001 \"ok\" \u304c\u8fd4\u3063\u3066\u304f\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046\u3002","title":"ALB"},{"location":"handson/alb/#_1","text":"","title":"\u3053\u306e\u7ae0\u306e\u76ee\u6a19"},{"location":"handson/alb/#alb","text":"\u4e0a\u8a18\u306e\u56f3\u304c\u76ee\u6a19\u3068\u306a\u308b\u69cb\u6210\u3067\u3059\u3002\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306f\u7c21\u7565\u5316\u3057\u3066\u3044\u307e\u3059\u3002 http\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u53d7\u3051\u4ed8\u3051\u308b\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5(ALB)\u3068\u3001\u305d\u306eALB\u3078\u306ehttp\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u8a31\u53ef\u3059\u308b\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002 # SecurityGroup # https://www.terraform.io/docs/providers/aws/r/security_group.html resource \"aws_security_group\" \"alb\" { name = \"handson-alb\" description = \"handson alb\" vpc_id = \"${aws_vpc.main.id}\" # \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u5185\u306e\u30ea\u30bd\u30fc\u30b9\u304b\u3089\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3092\u8a31\u53ef\u3059\u308b egress { from_port = 0 to_port = 0 protocol = \"-1\" cidr_blocks = [ \"0.0.0.0/0\" ] } tags = { Name = \"handson-alb\" } } # SecurityGroup Rule # https://www.terraform.io/docs/providers/aws/r/security_group.html resource \"aws_security_group_rule\" \"alb_http\" { security_group_id = \"${aws_security_group.alb.id}\" # \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u5185\u306e\u30ea\u30bd\u30fc\u30b9\u3078\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u304b\u3089\u306e\u30a2\u30af\u30bb\u30b9\u3092\u8a31\u53ef\u3059\u308b type = \"ingress\" from_port = 80 to_port = 80 protocol = \"tcp\" cidr_blocks = [ \"0.0.0.0/0\" ] } # ALB # https://www.terraform.io/docs/providers/aws/d/lb.html resource \"aws_lb\" \"main\" { load_balancer_type = \"application\" name = \"handson\" security_groups = [ \"${aws_security_group.alb.id}\" ] subnets = [ \"${aws_subnet.public_1a.id}\" , \"${aws_subnet.public_1c.id}\" , \"${aws_subnet.public_1d.id}\" ] } \u30b3\u30fc\u30c9\u306e\u9069\u7528\u3092\u884c\u3046\u3068\u30ea\u30bd\u30fc\u30b9\u304c2\u3064\u8ffd\u52a0\u3055\u308c\u308c\u3070\u6210\u529f\u3067\u3059\u3002 # terraform plan : Plan: 3 to add, 0 to change, 0 to destroy. : # terraform apply : \u30b3\u30f3\u30bd\u30fc\u30eb\u4e0a\u3067\u78ba\u8a8d\u3059\u308b\u3068ALB\u304c\u8d77\u52d5\u3057\u3066\u3044\u3066\u3001DNS\u3092\u78ba\u8a8d\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002 https://ap-northeast-1.console.aws.amazon.com/ec2/v2/home?region=ap-northeast-1#LoadBalancers:sort=loadBalancerName \u305f\u3060\u3057\u3001\u3053\u306e\u6642\u70b9\u3067\u306f\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5\u306e\u8a2d\u5b9a(\u30ea\u30b9\u30ca\u30fc\u306e\u8ffd\u52a0)\u3092\u884c\u3063\u3066\u3044\u306a\u3044\u305f\u3081ALB\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u307e\u305b\u3093\u3002 \"\u30ea\u30b9\u30ca\u30fc\" \u3092\u78ba\u8a8d\u3059\u308b\u3068\u8a2d\u5b9a\u304c1\u3064\u3082\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002","title":"ALB"},{"location":"handson/alb/#_2","text":"ALB\u306b\u767b\u9332\u3055\u308c\u3066\u3044\u308bDNS\u3078http\u3067\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068 \"ok\" \u306e\u56fa\u5b9a\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u8fd4\u3059\u3088\u3046\u306b\u3057\u307e\u3057\u3087\u3046\u3002 \"ok\" \u3092\u8fd4\u3059\u305f\u3081\u306b\u306fALB\u306e\u30ea\u30b9\u30ca\u30fc\u306e\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 Terraform\u3067\u305d\u306e\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3057\u307e\u3057\u3087\u3046\u3002 # Listener # https://www.terraform.io/docs/providers/aws/r/lb_listener.html resource \"aws_lb_listener\" \"main\" { # HTTP\u3067\u306e\u30a2\u30af\u30bb\u30b9\u3092\u53d7\u3051\u4ed8\u3051\u308b port = \"80\" protocol = \"HTTP\" # ALB\u306earn\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002 #XXX: arn\u306fAmazon Resource Names \u306e\u7565\u3067\u3001\u305d\u306e\u540d\u306e\u901a\u308a\u30ea\u30bd\u30fc\u30b9\u3092\u7279\u5b9a\u3059\u308b\u305f\u3081\u306e\u4e00\u610f\u306a\u540d\u524d(id)\u3067\u3059\u3002 load_balancer_arn = \"${aws_lb.main.arn}\" # \"ok\" \u3068\u3044\u3046\u56fa\u5b9a\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u8a2d\u5b9a\u3059\u308b default_action { type = \"fixed-response\" fixed_response { content_type = \"text/plain\" status_code = \"200\" message_body = \"ok\" } } } \u30b3\u30fc\u30c9\u306e\u9069\u7528\u3092\u884c\u3046\u3068\u30ea\u30bd\u30fc\u30b9\u304c1\u3064\u8ffd\u52a0\u3055\u308c\u308c\u3070\u6210\u529f\u3067\u3059\u3002 # terraform plan : Plan: 1 to add, 0 to change, 0 to destroy. : # terraform apply : ALB\u304chttp\u3092\u53d7\u3051\u4ed8\u3051\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002 ALB\u306eDNS\u3078\u30a2\u30af\u30bb\u30b9\u3057\u3001 \"ok\" \u304c\u8fd4\u3063\u3066\u304f\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046\u3002","title":"\u30ea\u30b9\u30ca\u30fc\u306e\u8a2d\u5b9a"},{"location":"handson/ecs/","text":"ECS\u3068\u306f \u00b6 \"Elastic Container Service\" \u306fAWS\u304c\u958b\u767a\u3057\u305fDocker\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3\u30c4\u30fc\u30eb\u3067\u3059\u3002 \u958b\u767a\u8005\u306f\u30b3\u30f3\u30c6\u30ca\u3092\u52d5\u304b\u3059\u3053\u3068\u306b\u96c6\u4e2d\u3067\u304d\u308b\u3088\u3046\u958b\u767a\u3055\u308c\u3066\u3044\u3066\u30af\u30e9\u30b9\u30bf\u30fc\u306e\u7ba1\u7406\u306fAWS\u304c\u884c\u3063\u3066\u304f\u308c\u307e\u3059\u3002 \u305d\u306e\u305f\u3081\u3001\u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u3067\u6d3b\u7528\u3059\u308b\u307e\u3067\u306e\u5b66\u7fd2\u30b3\u30b9\u30c8\u304c\u4f4e\u304f\u3001\u4ed6\u306eAWS\u30b5\u30fc\u30d3\u30b9\u3068\u306e\u9023\u643a\u3082\u3057\u3084\u3059\u3044\u3053\u3068\u304c\u7279\u5fb4\u3067\u3059\u3002 \u69cb\u6210 \u00b6 ECS\u306f \"\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u30d7\u30ec\u30fc\u30f3\" \u3068 \"\u30c7\u30fc\u30bf\u30d7\u30ec\u30fc\u30f3\" \u306e2\u3064\u306b\u5225\u308c\u307e\u3059\u3002 \u30c7\u30fc\u30bf\u30d7\u30ec\u30fc\u30f3\u306f1\u53f0\u4ee5\u4e0a\u306eEC2\u3092\u30ea\u30bd\u30fc\u30b9\u30d7\u30fc\u30eb\u3068\u3057\u3066\u6271\u3046\u3082\u306e\u3067\u3001\u30c7\u30fc\u30bf\u30d7\u30ec\u30fc\u30f3\u4e0a\u306b\u30b3\u30f3\u30c6\u30ca\u306f\u914d\u7f6e\u3055\u308c\u307e\u3059\u3002 \u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u30d7\u30ec\u30fc\u30f3\u306f\u30c7\u30fc\u30bf\u30d7\u30ec\u30fc\u30f3\u4e0a\u3078\u30b3\u30f3\u30c6\u30ca\u306e\u914d\u7f6e\u3068\u305d\u306e\u7ba1\u7406\u3092\u884c\u3044\u307e\u3059\u3002 \u57fa\u672c\u7684\u306b\u958b\u767a\u8005\u306fEC2\u3092\u7acb\u3066\u3066\u3001ECS\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u4e0a\u3067\u300c\u3069\u3093\u306a\u30b3\u30f3\u30c6\u30ca\u304c\u5fc5\u8981\u304b\u300d\u5b9a\u7fa9\u3059\u308b\u3060\u3051\u3067\u3042\u3068\u306f\u3088\u3057\u306a\u306b\u30b3\u30f3\u30c6\u30ca\u304c\u52d5\u304d\u307e\u3059\u3002 Fargate \u30c7\u30fc\u30bf\u30d7\u30ec\u30fc\u30f3\u3092\u69cb\u6210\u3059\u308bEC2\u90e1\u306f\u958b\u767a\u8005\u304c\u7ba1\u7406\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 OS/\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8/\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30d1\u30c3\u30c1\u3084\u4f7f\u308f\u306a\u304f\u306a\u3063\u305f\u30d5\u30a1\u30a4\u30eb\u306e\u30ed\u30fc\u30c6\u30fc\u30c8\u3001\u30ea\u30bd\u30fc\u30b9\u304c\u8db3\u308a\u306a\u304f\u306a\u3063\u305f\u969b\u306b\u30b9\u30b1\u30fc\u30eb\u3055\u305b\u308b\u306a\u3069\u3092\u884c\u3046\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 Fargate\u306f \"\u30c7\u30fc\u30bf\u30d7\u30ec\u30fc\u30f3\u306e\u7b2c\u4e8c\u306e\u9078\u629e\u80a2\" \u3067\u3059\u3002 \u30b3\u30f3\u30c6\u30ca\u3092\u52d5\u304b\u3059\u30ea\u30bd\u30fc\u30b9\u30d7\u30fc\u30eb\u3068\u3057\u3066\u3001\u958b\u767a\u8005\u304c\u7ba1\u7406\u3059\u308bEC2\u90e1\u3067\u306f\u306a\u304fAWS\u304c\u30de\u30cd\u30fc\u30b8\u3059\u308b\u30ea\u30bd\u30fc\u30b9\u30d7\u30fc\u30eb\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002 \u3053\u308c\u306b\u3088\u308aEC2\u306e\u7ba1\u7406\u304b\u3089\u624b\u96e2\u308c\u304c\u3067\u304d\u5b66\u7fd2\u30b3\u30b9\u30c8/\u904b\u7528\u30b3\u30b9\u30c8\u304c\u4f4e\u304f\u306a\u308a\u307e\u3059\u3002\u53cd\u9762\u3001EC2\u3092\u3046\u307e\u304f\u4f7f\u3063\u305f\u6642\u3088\u308a\u5229\u7528\u6599\u306f\u9ad8\u304f\u306a\u308a\u307e\u3059\u3002 \u57fa\u672c\u7684\u306bAWS\u306b\u4e0d\u6163\u308c\u306a\u5834\u5408\u306f\u30c7\u30fc\u30bf\u30d7\u30ec\u30fc\u30f3\u306bEC2\u3067\u306f\u306a\u304fFargate\u3092\u9078\u629e\u3057\u305f\u307b\u3046\u304c\u826f\u3044\u3067\u3057\u3087\u3046\u3002 \u30b3\u30f3\u30c6\u30ca\u306e\u7ba1\u7406 \u00b6 ECS\u3067\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u53d7\u3051\u4ed8\u3051\u308b\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3059\u308b\u5834\u5408\u3001\u57fa\u672c\u7684\u306b\u4e0a\u8a18\u306e\u3088\u3046\u306a\u69cb\u6210\u306b\u306a\u308a\u307e\u3059\u3002 ECS\u3092\u4f7f\u7528\u3059\u308b\u969b\u306b\u91cd\u8981\u306a\u306e\u306f \"\u30bf\u30b9\u30af\u5b9a\u7fa9\", \"\u30b5\u30fc\u30d3\u30b9\", \"\u30bf\u30b9\u30af\"\u306e3\u3064\u3067\u3059\u3002 \u30bf\u30b9\u30af\u5b9a\u7fa9 \u3069\u3093\u306a\u30b3\u30f3\u30c6\u30ca\u3092\u3069\u3093\u306a\u8a2d\u5b9a\u3067\u52d5\u304b\u3059\u304b\u3092\u5b9a\u7fa9\u3059\u308b \u30b5\u30fc\u30d3\u30b9 \u3069\u306e\u30bf\u30b9\u30af\u5b9a\u7fa9\u3067\u30b3\u30f3\u30c6\u30ca\u3092\u7acb\u3061\u4e0a\u3052\u3001\u305d\u306e\u30b3\u30f3\u30c6\u30ca\u3068\u3069\u306e\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5(\u30bf\u30fc\u30b2\u30c3\u30c8\u30b0\u30eb\u30fc\u30d7, \u30ea\u30b9\u30ca\u30fc)\u3068\u7d10\u4ed8\u3051\u308b\u304b \u30bf\u30b9\u30af \u30bf\u30b9\u30af\u5b9a\u7fa9\u3092\u3082\u3068\u306b\u8d77\u52d5\u3057\u305f\u30b3\u30f3\u30c6\u30ca\u3092\u30bf\u30b9\u30af\u3068\u547c\u3073\u307e\u3059 \u958b\u767a\u8005\u304cECS\u3092\u4f7f\u7528\u3059\u308b\u969b\u306f\u300c\u30bf\u30b9\u30af\u5b9a\u7fa9\u3092\u4f5c\u6210\u3057\u3001\u305d\u306e\u30bf\u30b9\u30af\u5b9a\u7fa9\u3092\u3082\u3068\u306b\u30b5\u30fc\u30d3\u30b9\u3092\u8d77\u52d5\u300d\u3059\u308b\u6d41\u308c\u306b\u306a\u308a\u307e\u3059\u3002 \u30bf\u30b9\u30af\u5b9a\u7fa9\u306e\u4f5c\u6210 \u00b6 nginx\u3092\u7acb\u3061\u4e0a\u3052\u308b\u305f\u3081\u306e\u8a2d\u5b9a\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002 # Task Definition # https://www.terraform.io/docs/providers/aws/r/ecs_task_definition.html resource \"aws_ecs_task_definition\" \"main\" { family = \"handson\" # \u30c7\u30fc\u30bf\u30d7\u30ec\u30fc\u30f3\u306e\u9078\u629e requires_compatibilities = [ \"FARGATE\" ] # ECS\u30bf\u30b9\u30af\u304c\u4f7f\u7528\u53ef\u80fd\u306a\u30ea\u30bd\u30fc\u30b9\u306e\u4e0a\u9650 # \u30bf\u30b9\u30af\u5185\u306e\u30b3\u30f3\u30c6\u30ca\u306f\u3053\u306e\u4e0a\u9650\u5185\u306b\u4f7f\u7528\u3059\u308b\u30ea\u30bd\u30fc\u30b9\u3092\u53ce\u3081\u308b\u5fc5\u8981\u304c\u3042\u308a\u3001\u30e1\u30e2\u30ea\u304c\u4e0a\u9650\u306b\u9054\u3057\u305f\u5834\u5408OOM Killer \u306b\u30bf\u30b9\u30af\u304c\u30ad\u30eb\u3055\u308c\u308b cpu = \"256\" memory = \"512\" # ECS\u30bf\u30b9\u30af\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30c9\u30e9\u30a4\u30d0 # Fargate\u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\u306f\"awsvpc\"\u6c7a\u3081\u6253\u3061 network_mode = \"awsvpc\" # \u8d77\u52d5\u3059\u308b\u30b3\u30f3\u30c6\u30ca\u306e\u5b9a\u7fa9 # \u300cnginx\u3092\u8d77\u52d5\u3057\u300180\u30dd\u30fc\u30c8\u3092\u958b\u653e\u3059\u308b\u300d\u8a2d\u5b9a\u3092\u8a18\u8ff0\u3002 container_definitions = << EOL [ { \"name\": \"nginx\", \"image\": \"nginx:1.14\", \"portMappings\": [ { \"containerPort\": 80, \"hostPort\": 80 } ] } ] EOL } \u30b3\u30fc\u30c9\u306e\u9069\u7528\u3092\u884c\u3046\u3068\u30ea\u30bd\u30fc\u30b9\u304c1\u3064\u8ffd\u52a0\u3055\u308c\u308c\u3070\u6210\u529f\u3067\u3059\u3002 # terraform plan : Plan: 1 to add, 0 to change, 0 to destroy. : # terraform apply : https://ap-northeast-1.console.aws.amazon.com/ecs/home?region=ap-northeast-1#/taskDefinitions \u30af\u30e9\u30b9\u30bf\u30fc\u306e\u4f5c\u6210 \u00b6 ECS\u30af\u30e9\u30b9\u30bf\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002 # ECS Cluster # https://www.terraform.io/docs/providers/aws/r/ecs_cluster.html resource \"aws_ecs_cluster\" \"main\" { name = \"handson\" } \u30b3\u30fc\u30c9\u306e\u9069\u7528\u3092\u884c\u3046\u3068\u30ea\u30bd\u30fc\u30b9\u304c1\u3064\u8ffd\u52a0\u3055\u308c\u308c\u3070\u6210\u529f\u3067\u3059\u3002 # terraform plan : Plan: 1 to add, 0 to change, 0 to destroy. : # terraform apply : \u30b5\u30fc\u30d3\u30b9 \u00b6 \u30b5\u30fc\u30d3\u30b9\u306f\u30bf\u30b9\u30af\u5b9a\u7fa9\u3092\u3082\u3068\u306b\u30bf\u30b9\u30af(\u30b3\u30f3\u30c6\u30ca)\u3092\u7acb\u3061\u4e0a\u3052\u3001\u305d\u306e\u30bf\u30b9\u30af\u3068\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5\u3092\u7d10\u4ed8\u3051\u308b\u305f\u3081\u306e\u4ed5\u7d44\u307f\u3067\u3059\u3002 \u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5\u306e\u8a2d\u5b9a\u3092\u8ffd\u52a0 \u00b6 \u307e\u305a\u306f\u30b5\u30fc\u30d3\u30b9\u3068\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5\u3092\u7d10\u4ed8\u3051\u308b\u305f\u3081\u306e\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3057\u307e\u3057\u3087\u3046\u3002 \u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5\u3068\u30b3\u30f3\u30c6\u30ca\u306e\u7d10\u4ed8\u3051\u306f\"\u30bf\u30fc\u30b2\u30c3\u30c8\u30b0\u30eb\u30fc\u30d7\"\u3068\"\u30ea\u30b9\u30ca\u30fc\"\u306e2\u3064\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002 \u30bf\u30fc\u30b2\u30c3\u30c8\u30b0\u30eb\u30fc\u30d7 \u30d8\u30eb\u30b9\u30c1\u30a7\u30c3\u30af\u3092\u884c\u3046 \u30ea\u30b9\u30ca\u30fc \u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5\u304c\u30ea\u30af\u30a8\u30b9\u30c8\u53d7\u3051\u305f\u969b\u3001\u3069\u306e\u30bf\u30fc\u30b2\u30c3\u30c8\u30b0\u30eb\u30fc\u30d7\u3078\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u53d7\u3051\u6e21\u3059\u306e\u304b\u306e\u8a2d\u5b9a LB\u306e\u7a2e\u985e AWS\u306b\u306f \"Application LoadBalancer\", \"Network LoadBalancer\", \"Classic LoadBalancer\" \u306e3\u3064\u306e\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u307e\u3059\u3002 \u6b74\u53f2\u7684\u306b\u306f\u3082\u3068\u3082\u3068AWS\u306fClassic LoadBalancer\u306e1\u3064\u3057\u304b\u7528\u610f\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3067\u3057\u305f\u304c\u3001\u65b0\u3057\u3044\u9078\u629e\u80a2\u3068\u3057\u3066Application LoadBalancer \u3068Network LoadBalancer \u306e2\u3064\u304c\u767b\u5834\u3057\u307e\u3057\u305f\u3002\u57fa\u672c\u7684\u306bCLB\u306f\u53e4\u304f\u3001\u65b0\u3057\u3044\u30b5\u30fc\u30d3\u30b9\u3067\u306fALB\u304bNLB\u306e\u3069\u3061\u3089\u304b\u3092\u9078\u629e\u3057\u3066\u4f7f\u7528\u3057\u307e\u3059\u3002 ALB\u3068NLB\u306f\u6271\u3046\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u30ec\u30a4\u30e4\u30fc\u304c\u7570\u306a\u308a\u307e\u3059\u3002OSI\u53c2\u7167\u30e2\u30c7\u30eb\u304c\u60f3\u50cf\u304c\u4ed8\u304d\u3084\u3059\u3044\u3067\u3059\u3002ALB\u306f\u30ec\u30a4\u30e4\u30fc7(http/https)\u30ec\u30d9\u30eb\u3067\u306e\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u306e\u632f\u308a\u5206\u3051\u304c\u53ef\u80fd\u3067\u3001NLB\u306fL4(TCP)\u30ec\u30d9\u30eb\u3067\u306e\u632f\u308a\u5206\u3051\u3092\u884c\u3044\u307e\u3059\u3002 \u30b3\u30fc\u30c9\u3092\u8a18\u8ff0\u3057\u307e\u3057\u3087\u3046\u3002 # ELB Target Group # https://www.terraform.io/docs/providers/aws/r/lb_target_group.html resource \"aws_lb_target_group\" \"main\" { name = \"handson\" # \u30bf\u30fc\u30b2\u30c3\u30c8\u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u6210\u3059\u308bVPC vpc_id = \"${aws_vpc.main.id}\" # ALB\u304b\u3089ECS\u30bf\u30b9\u30af\u306e\u30b3\u30f3\u30c6\u30ca\u3078\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u3092\u632f\u308a\u5206\u3051\u308b\u8a2d\u5b9a port = 80 protocol = \"HTTP\" target_type = \"ip\" # \u30b3\u30f3\u30c6\u30ca\u3078\u306e\u6b7b\u6d3b\u76e3\u8996\u8a2d\u5b9a health_check = { port = 80 path = \"/\" } } # ALB Listener Rule # https://www.terraform.io/docs/providers/aws/r/lb_listener_rule.html resource \"aws_lb_listener_rule\" \"main\" { # \u30eb\u30fc\u30eb\u3092\u8ffd\u52a0\u3059\u308b\u30ea\u30b9\u30ca\u30fc listener_arn = \"${aws_lb_listener.main.arn}\" # \u53d7\u3051\u53d6\u3063\u305f\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u3092\u30bf\u30fc\u30b2\u30c3\u30c8\u30b0\u30eb\u30fc\u30d7\u3078\u53d7\u3051\u6e21\u3059 action { type = \"forward\" target_group_arn = \"${aws_lb_target_group.main.id}\" } # \u30bf\u30fc\u30b2\u30c3\u30c8\u30b0\u30eb\u30fc\u30d7\u3078\u53d7\u3051\u6e21\u3059\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u306e\u6761\u4ef6 condition { field = \"path-pattern\" values = [ \"*\" ] } } \u30b3\u30fc\u30c9\u306e\u9069\u7528\u3092\u884c\u3046\u3068\u30ea\u30bd\u30fc\u30b9\u304c2\u3064\u8ffd\u52a0\u3055\u308c\u308c\u3070\u6210\u529f\u3067\u3059\u3002 # terraform plan : Plan: 2 to add, 0 to change, 0 to destroy. : # terraform apply : \u30b5\u30fc\u30d3\u30b9\u306e\u4f5c\u6210 \u00b6 # SecurityGroup # https://www.terraform.io/docs/providers/aws/r/security_group.html resource \"aws_security_group\" \"ecs\" { name = \"handson-ecs\" description = \"handson ecs\" # \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u3092\u914d\u7f6e\u3059\u308bVPC vpc_id = \"${aws_vpc.main.id}\" # \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u5185\u306e\u30ea\u30bd\u30fc\u30b9\u304b\u3089\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u3078\u306e\u30a2\u30af\u30bb\u30b9\u8a31\u53ef\u8a2d\u5b9a # \u4eca\u56de\u306e\u5834\u5408DockerHub\u3078\u306ePull\u306b\u4f7f\u7528\u3059\u308b\u3002 egress { from_port = 0 to_port = 0 protocol = \"-1\" cidr_blocks = [ \"0.0.0.0/0\" ] } tags = { Name = \"handson-ecs\" } } # SecurityGroup Rule # https://www.terraform.io/docs/providers/aws/r/security_group.html resource \"aws_security_group_rule\" \"ecs\" { security_group_id = \"${aws_security_group.ecs.id}\" # \u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u304b\u3089\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u5185\u306e\u30ea\u30bd\u30fc\u30b9\u3078\u306e\u30a2\u30af\u30bb\u30b9\u8a31\u53ef\u8a2d\u5b9a type = \"ingress\" # TCP\u3067\u306e80\u30dd\u30fc\u30c8\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3092\u8a31\u53ef\u3059\u308b from_port = 80 to_port = 80 protocol = \"tcp\" # \u540c\u4e00VPC\u5185\u304b\u3089\u306e\u30a2\u30af\u30bb\u30b9\u306e\u307f\u8a31\u53ef cidr_blocks = [ \"10.0.0.0/16\" ] } # ECS Service # https://www.terraform.io/docs/providers/aws/r/ecs_service.html resource \"aws_ecs_service\" \"main\" { name = \"handson\" # \u4f9d\u5b58\u95a2\u4fc2\u306e\u8a18\u8ff0\u3002 # \"aws_lb_listener_rule.main\" \u30ea\u30bd\u30fc\u30b9\u306e\u4f5c\u6210\u304c\u5b8c\u4e86\u3059\u308b\u306e\u3092\u5f85\u3063\u3066\u304b\u3089\u5f53\u8a72\u30ea\u30bd\u30fc\u30b9\u306e\u4f5c\u6210\u3092\u958b\u59cb\u3059\u308b\u3002 # \"depends_on\" \u306f \"aws_ecs_service\" \u30ea\u30bd\u30fc\u30b9\u5c02\u7528\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u3067\u306f\u306a\u304f\u3001Terraform\u306e\u30b7\u30f3\u30bf\u30c3\u30af\u30b9\u306e\u305f\u3081\u4ed6\u306e\"resource\"\u3067\u3082\u4f7f\u7528\u53ef\u80fd depends_on = [ \"aws_lb_listener_rule.main\" ] # \u5f53\u8a72ECS\u30b5\u30fc\u30d3\u30b9\u3092\u914d\u7f6e\u3059\u308bECS\u30af\u30e9\u30b9\u30bf\u30fc\u306e\u6307\u5b9a cluster = \"${aws_ecs_cluster.main.name}\" # \u30c7\u30fc\u30bf\u30d7\u30ec\u30fc\u30f3\u3068\u3057\u3066Fargate\u3092\u4f7f\u7528\u3059\u308b launch_type = \"FARGATE\" # ECS\u30bf\u30b9\u30af\u306e\u8d77\u52d5\u6570\u3092\u5b9a\u7fa9 desired_count = \"1\" # \u8d77\u52d5\u3059\u308bECS\u30bf\u30b9\u30af\u306e\u30bf\u30b9\u30af\u5b9a\u7fa9 task_definition = \"${aws_ecs_task_definition.main.arn}\" # ECS\u30bf\u30b9\u30af\u3078\u8a2d\u5b9a\u3059\u308b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u8a2d\u5b9a network_configuration = { # \u30bf\u30b9\u30af\u306e\u8d77\u52d5\u3092\u8a31\u53ef\u3059\u308b\u30b5\u30d6\u30cd\u30c3\u30c8 subnets = [ \"${aws_subnet.private_1a.id}\" , \"${aws_subnet.private_1c.id}\" , \"${aws_subnet.private_1d.id}\" ] # \u30bf\u30b9\u30af\u306b\u7d10\u4ed8\u3051\u308b\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7 security_groups = [ \"${aws_security_group.ecs.id}\" ] } # ECS\u30bf\u30b9\u30af\u306e\u8d77\u52d5\u5f8c\u306b\u7d10\u4ed8\u3051\u308bELB\u30bf\u30fc\u30b2\u30c3\u30c8\u30b0\u30eb\u30fc\u30d7 load_balancer = [ { target_group_arn = \"${aws_lb_target_group.main.arn}\" container_name = \"nginx\" container_port = \"80\" }, ] } \u30b3\u30fc\u30c9\u306e\u9069\u7528\u3092\u884c\u3044\u307e\u3059\u3002 # terraform plan # terraform apply : ALB\u306eWeb\u30b3\u30f3\u30bd\u30fc\u30eb\u306b\u8868\u793a\u3055\u308c\u3066\u3044\u308bDNS\u3078http\u3067\u30a2\u30af\u30bb\u30b9\u3057\u3001nginx\u304c\u8868\u793a\u3055\u308c\u308c\u3070\u6210\u529f\u3067\u3059 https://ap-northeast-1.console.aws.amazon.com/ec2/v2/home?region=ap-northeast-1#LoadBalancers","title":"ECS"},{"location":"handson/ecs/#ecs","text":"\"Elastic Container Service\" \u306fAWS\u304c\u958b\u767a\u3057\u305fDocker\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3\u30c4\u30fc\u30eb\u3067\u3059\u3002 \u958b\u767a\u8005\u306f\u30b3\u30f3\u30c6\u30ca\u3092\u52d5\u304b\u3059\u3053\u3068\u306b\u96c6\u4e2d\u3067\u304d\u308b\u3088\u3046\u958b\u767a\u3055\u308c\u3066\u3044\u3066\u30af\u30e9\u30b9\u30bf\u30fc\u306e\u7ba1\u7406\u306fAWS\u304c\u884c\u3063\u3066\u304f\u308c\u307e\u3059\u3002 \u305d\u306e\u305f\u3081\u3001\u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u3067\u6d3b\u7528\u3059\u308b\u307e\u3067\u306e\u5b66\u7fd2\u30b3\u30b9\u30c8\u304c\u4f4e\u304f\u3001\u4ed6\u306eAWS\u30b5\u30fc\u30d3\u30b9\u3068\u306e\u9023\u643a\u3082\u3057\u3084\u3059\u3044\u3053\u3068\u304c\u7279\u5fb4\u3067\u3059\u3002","title":"ECS\u3068\u306f"},{"location":"handson/ecs/#_1","text":"ECS\u306f \"\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u30d7\u30ec\u30fc\u30f3\" \u3068 \"\u30c7\u30fc\u30bf\u30d7\u30ec\u30fc\u30f3\" \u306e2\u3064\u306b\u5225\u308c\u307e\u3059\u3002 \u30c7\u30fc\u30bf\u30d7\u30ec\u30fc\u30f3\u306f1\u53f0\u4ee5\u4e0a\u306eEC2\u3092\u30ea\u30bd\u30fc\u30b9\u30d7\u30fc\u30eb\u3068\u3057\u3066\u6271\u3046\u3082\u306e\u3067\u3001\u30c7\u30fc\u30bf\u30d7\u30ec\u30fc\u30f3\u4e0a\u306b\u30b3\u30f3\u30c6\u30ca\u306f\u914d\u7f6e\u3055\u308c\u307e\u3059\u3002 \u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u30d7\u30ec\u30fc\u30f3\u306f\u30c7\u30fc\u30bf\u30d7\u30ec\u30fc\u30f3\u4e0a\u3078\u30b3\u30f3\u30c6\u30ca\u306e\u914d\u7f6e\u3068\u305d\u306e\u7ba1\u7406\u3092\u884c\u3044\u307e\u3059\u3002 \u57fa\u672c\u7684\u306b\u958b\u767a\u8005\u306fEC2\u3092\u7acb\u3066\u3066\u3001ECS\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u4e0a\u3067\u300c\u3069\u3093\u306a\u30b3\u30f3\u30c6\u30ca\u304c\u5fc5\u8981\u304b\u300d\u5b9a\u7fa9\u3059\u308b\u3060\u3051\u3067\u3042\u3068\u306f\u3088\u3057\u306a\u306b\u30b3\u30f3\u30c6\u30ca\u304c\u52d5\u304d\u307e\u3059\u3002 Fargate \u30c7\u30fc\u30bf\u30d7\u30ec\u30fc\u30f3\u3092\u69cb\u6210\u3059\u308bEC2\u90e1\u306f\u958b\u767a\u8005\u304c\u7ba1\u7406\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 OS/\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8/\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30d1\u30c3\u30c1\u3084\u4f7f\u308f\u306a\u304f\u306a\u3063\u305f\u30d5\u30a1\u30a4\u30eb\u306e\u30ed\u30fc\u30c6\u30fc\u30c8\u3001\u30ea\u30bd\u30fc\u30b9\u304c\u8db3\u308a\u306a\u304f\u306a\u3063\u305f\u969b\u306b\u30b9\u30b1\u30fc\u30eb\u3055\u305b\u308b\u306a\u3069\u3092\u884c\u3046\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 Fargate\u306f \"\u30c7\u30fc\u30bf\u30d7\u30ec\u30fc\u30f3\u306e\u7b2c\u4e8c\u306e\u9078\u629e\u80a2\" \u3067\u3059\u3002 \u30b3\u30f3\u30c6\u30ca\u3092\u52d5\u304b\u3059\u30ea\u30bd\u30fc\u30b9\u30d7\u30fc\u30eb\u3068\u3057\u3066\u3001\u958b\u767a\u8005\u304c\u7ba1\u7406\u3059\u308bEC2\u90e1\u3067\u306f\u306a\u304fAWS\u304c\u30de\u30cd\u30fc\u30b8\u3059\u308b\u30ea\u30bd\u30fc\u30b9\u30d7\u30fc\u30eb\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002 \u3053\u308c\u306b\u3088\u308aEC2\u306e\u7ba1\u7406\u304b\u3089\u624b\u96e2\u308c\u304c\u3067\u304d\u5b66\u7fd2\u30b3\u30b9\u30c8/\u904b\u7528\u30b3\u30b9\u30c8\u304c\u4f4e\u304f\u306a\u308a\u307e\u3059\u3002\u53cd\u9762\u3001EC2\u3092\u3046\u307e\u304f\u4f7f\u3063\u305f\u6642\u3088\u308a\u5229\u7528\u6599\u306f\u9ad8\u304f\u306a\u308a\u307e\u3059\u3002 \u57fa\u672c\u7684\u306bAWS\u306b\u4e0d\u6163\u308c\u306a\u5834\u5408\u306f\u30c7\u30fc\u30bf\u30d7\u30ec\u30fc\u30f3\u306bEC2\u3067\u306f\u306a\u304fFargate\u3092\u9078\u629e\u3057\u305f\u307b\u3046\u304c\u826f\u3044\u3067\u3057\u3087\u3046\u3002","title":"\u69cb\u6210"},{"location":"handson/ecs/#_2","text":"ECS\u3067\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u53d7\u3051\u4ed8\u3051\u308b\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3059\u308b\u5834\u5408\u3001\u57fa\u672c\u7684\u306b\u4e0a\u8a18\u306e\u3088\u3046\u306a\u69cb\u6210\u306b\u306a\u308a\u307e\u3059\u3002 ECS\u3092\u4f7f\u7528\u3059\u308b\u969b\u306b\u91cd\u8981\u306a\u306e\u306f \"\u30bf\u30b9\u30af\u5b9a\u7fa9\", \"\u30b5\u30fc\u30d3\u30b9\", \"\u30bf\u30b9\u30af\"\u306e3\u3064\u3067\u3059\u3002 \u30bf\u30b9\u30af\u5b9a\u7fa9 \u3069\u3093\u306a\u30b3\u30f3\u30c6\u30ca\u3092\u3069\u3093\u306a\u8a2d\u5b9a\u3067\u52d5\u304b\u3059\u304b\u3092\u5b9a\u7fa9\u3059\u308b \u30b5\u30fc\u30d3\u30b9 \u3069\u306e\u30bf\u30b9\u30af\u5b9a\u7fa9\u3067\u30b3\u30f3\u30c6\u30ca\u3092\u7acb\u3061\u4e0a\u3052\u3001\u305d\u306e\u30b3\u30f3\u30c6\u30ca\u3068\u3069\u306e\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5(\u30bf\u30fc\u30b2\u30c3\u30c8\u30b0\u30eb\u30fc\u30d7, \u30ea\u30b9\u30ca\u30fc)\u3068\u7d10\u4ed8\u3051\u308b\u304b \u30bf\u30b9\u30af \u30bf\u30b9\u30af\u5b9a\u7fa9\u3092\u3082\u3068\u306b\u8d77\u52d5\u3057\u305f\u30b3\u30f3\u30c6\u30ca\u3092\u30bf\u30b9\u30af\u3068\u547c\u3073\u307e\u3059 \u958b\u767a\u8005\u304cECS\u3092\u4f7f\u7528\u3059\u308b\u969b\u306f\u300c\u30bf\u30b9\u30af\u5b9a\u7fa9\u3092\u4f5c\u6210\u3057\u3001\u305d\u306e\u30bf\u30b9\u30af\u5b9a\u7fa9\u3092\u3082\u3068\u306b\u30b5\u30fc\u30d3\u30b9\u3092\u8d77\u52d5\u300d\u3059\u308b\u6d41\u308c\u306b\u306a\u308a\u307e\u3059\u3002","title":"\u30b3\u30f3\u30c6\u30ca\u306e\u7ba1\u7406"},{"location":"handson/ecs/#_3","text":"nginx\u3092\u7acb\u3061\u4e0a\u3052\u308b\u305f\u3081\u306e\u8a2d\u5b9a\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002 # Task Definition # https://www.terraform.io/docs/providers/aws/r/ecs_task_definition.html resource \"aws_ecs_task_definition\" \"main\" { family = \"handson\" # \u30c7\u30fc\u30bf\u30d7\u30ec\u30fc\u30f3\u306e\u9078\u629e requires_compatibilities = [ \"FARGATE\" ] # ECS\u30bf\u30b9\u30af\u304c\u4f7f\u7528\u53ef\u80fd\u306a\u30ea\u30bd\u30fc\u30b9\u306e\u4e0a\u9650 # \u30bf\u30b9\u30af\u5185\u306e\u30b3\u30f3\u30c6\u30ca\u306f\u3053\u306e\u4e0a\u9650\u5185\u306b\u4f7f\u7528\u3059\u308b\u30ea\u30bd\u30fc\u30b9\u3092\u53ce\u3081\u308b\u5fc5\u8981\u304c\u3042\u308a\u3001\u30e1\u30e2\u30ea\u304c\u4e0a\u9650\u306b\u9054\u3057\u305f\u5834\u5408OOM Killer \u306b\u30bf\u30b9\u30af\u304c\u30ad\u30eb\u3055\u308c\u308b cpu = \"256\" memory = \"512\" # ECS\u30bf\u30b9\u30af\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30c9\u30e9\u30a4\u30d0 # Fargate\u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\u306f\"awsvpc\"\u6c7a\u3081\u6253\u3061 network_mode = \"awsvpc\" # \u8d77\u52d5\u3059\u308b\u30b3\u30f3\u30c6\u30ca\u306e\u5b9a\u7fa9 # \u300cnginx\u3092\u8d77\u52d5\u3057\u300180\u30dd\u30fc\u30c8\u3092\u958b\u653e\u3059\u308b\u300d\u8a2d\u5b9a\u3092\u8a18\u8ff0\u3002 container_definitions = << EOL [ { \"name\": \"nginx\", \"image\": \"nginx:1.14\", \"portMappings\": [ { \"containerPort\": 80, \"hostPort\": 80 } ] } ] EOL } \u30b3\u30fc\u30c9\u306e\u9069\u7528\u3092\u884c\u3046\u3068\u30ea\u30bd\u30fc\u30b9\u304c1\u3064\u8ffd\u52a0\u3055\u308c\u308c\u3070\u6210\u529f\u3067\u3059\u3002 # terraform plan : Plan: 1 to add, 0 to change, 0 to destroy. : # terraform apply : https://ap-northeast-1.console.aws.amazon.com/ecs/home?region=ap-northeast-1#/taskDefinitions","title":"\u30bf\u30b9\u30af\u5b9a\u7fa9\u306e\u4f5c\u6210"},{"location":"handson/ecs/#_4","text":"ECS\u30af\u30e9\u30b9\u30bf\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002 # ECS Cluster # https://www.terraform.io/docs/providers/aws/r/ecs_cluster.html resource \"aws_ecs_cluster\" \"main\" { name = \"handson\" } \u30b3\u30fc\u30c9\u306e\u9069\u7528\u3092\u884c\u3046\u3068\u30ea\u30bd\u30fc\u30b9\u304c1\u3064\u8ffd\u52a0\u3055\u308c\u308c\u3070\u6210\u529f\u3067\u3059\u3002 # terraform plan : Plan: 1 to add, 0 to change, 0 to destroy. : # terraform apply :","title":"\u30af\u30e9\u30b9\u30bf\u30fc\u306e\u4f5c\u6210"},{"location":"handson/ecs/#_5","text":"\u30b5\u30fc\u30d3\u30b9\u306f\u30bf\u30b9\u30af\u5b9a\u7fa9\u3092\u3082\u3068\u306b\u30bf\u30b9\u30af(\u30b3\u30f3\u30c6\u30ca)\u3092\u7acb\u3061\u4e0a\u3052\u3001\u305d\u306e\u30bf\u30b9\u30af\u3068\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5\u3092\u7d10\u4ed8\u3051\u308b\u305f\u3081\u306e\u4ed5\u7d44\u307f\u3067\u3059\u3002","title":"\u30b5\u30fc\u30d3\u30b9"},{"location":"handson/ecs/#_6","text":"\u307e\u305a\u306f\u30b5\u30fc\u30d3\u30b9\u3068\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5\u3092\u7d10\u4ed8\u3051\u308b\u305f\u3081\u306e\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3057\u307e\u3057\u3087\u3046\u3002 \u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5\u3068\u30b3\u30f3\u30c6\u30ca\u306e\u7d10\u4ed8\u3051\u306f\"\u30bf\u30fc\u30b2\u30c3\u30c8\u30b0\u30eb\u30fc\u30d7\"\u3068\"\u30ea\u30b9\u30ca\u30fc\"\u306e2\u3064\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002 \u30bf\u30fc\u30b2\u30c3\u30c8\u30b0\u30eb\u30fc\u30d7 \u30d8\u30eb\u30b9\u30c1\u30a7\u30c3\u30af\u3092\u884c\u3046 \u30ea\u30b9\u30ca\u30fc \u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5\u304c\u30ea\u30af\u30a8\u30b9\u30c8\u53d7\u3051\u305f\u969b\u3001\u3069\u306e\u30bf\u30fc\u30b2\u30c3\u30c8\u30b0\u30eb\u30fc\u30d7\u3078\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u53d7\u3051\u6e21\u3059\u306e\u304b\u306e\u8a2d\u5b9a LB\u306e\u7a2e\u985e AWS\u306b\u306f \"Application LoadBalancer\", \"Network LoadBalancer\", \"Classic LoadBalancer\" \u306e3\u3064\u306e\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u307e\u3059\u3002 \u6b74\u53f2\u7684\u306b\u306f\u3082\u3068\u3082\u3068AWS\u306fClassic LoadBalancer\u306e1\u3064\u3057\u304b\u7528\u610f\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3067\u3057\u305f\u304c\u3001\u65b0\u3057\u3044\u9078\u629e\u80a2\u3068\u3057\u3066Application LoadBalancer \u3068Network LoadBalancer \u306e2\u3064\u304c\u767b\u5834\u3057\u307e\u3057\u305f\u3002\u57fa\u672c\u7684\u306bCLB\u306f\u53e4\u304f\u3001\u65b0\u3057\u3044\u30b5\u30fc\u30d3\u30b9\u3067\u306fALB\u304bNLB\u306e\u3069\u3061\u3089\u304b\u3092\u9078\u629e\u3057\u3066\u4f7f\u7528\u3057\u307e\u3059\u3002 ALB\u3068NLB\u306f\u6271\u3046\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u30ec\u30a4\u30e4\u30fc\u304c\u7570\u306a\u308a\u307e\u3059\u3002OSI\u53c2\u7167\u30e2\u30c7\u30eb\u304c\u60f3\u50cf\u304c\u4ed8\u304d\u3084\u3059\u3044\u3067\u3059\u3002ALB\u306f\u30ec\u30a4\u30e4\u30fc7(http/https)\u30ec\u30d9\u30eb\u3067\u306e\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u306e\u632f\u308a\u5206\u3051\u304c\u53ef\u80fd\u3067\u3001NLB\u306fL4(TCP)\u30ec\u30d9\u30eb\u3067\u306e\u632f\u308a\u5206\u3051\u3092\u884c\u3044\u307e\u3059\u3002 \u30b3\u30fc\u30c9\u3092\u8a18\u8ff0\u3057\u307e\u3057\u3087\u3046\u3002 # ELB Target Group # https://www.terraform.io/docs/providers/aws/r/lb_target_group.html resource \"aws_lb_target_group\" \"main\" { name = \"handson\" # \u30bf\u30fc\u30b2\u30c3\u30c8\u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u6210\u3059\u308bVPC vpc_id = \"${aws_vpc.main.id}\" # ALB\u304b\u3089ECS\u30bf\u30b9\u30af\u306e\u30b3\u30f3\u30c6\u30ca\u3078\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u3092\u632f\u308a\u5206\u3051\u308b\u8a2d\u5b9a port = 80 protocol = \"HTTP\" target_type = \"ip\" # \u30b3\u30f3\u30c6\u30ca\u3078\u306e\u6b7b\u6d3b\u76e3\u8996\u8a2d\u5b9a health_check = { port = 80 path = \"/\" } } # ALB Listener Rule # https://www.terraform.io/docs/providers/aws/r/lb_listener_rule.html resource \"aws_lb_listener_rule\" \"main\" { # \u30eb\u30fc\u30eb\u3092\u8ffd\u52a0\u3059\u308b\u30ea\u30b9\u30ca\u30fc listener_arn = \"${aws_lb_listener.main.arn}\" # \u53d7\u3051\u53d6\u3063\u305f\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u3092\u30bf\u30fc\u30b2\u30c3\u30c8\u30b0\u30eb\u30fc\u30d7\u3078\u53d7\u3051\u6e21\u3059 action { type = \"forward\" target_group_arn = \"${aws_lb_target_group.main.id}\" } # \u30bf\u30fc\u30b2\u30c3\u30c8\u30b0\u30eb\u30fc\u30d7\u3078\u53d7\u3051\u6e21\u3059\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u306e\u6761\u4ef6 condition { field = \"path-pattern\" values = [ \"*\" ] } } \u30b3\u30fc\u30c9\u306e\u9069\u7528\u3092\u884c\u3046\u3068\u30ea\u30bd\u30fc\u30b9\u304c2\u3064\u8ffd\u52a0\u3055\u308c\u308c\u3070\u6210\u529f\u3067\u3059\u3002 # terraform plan : Plan: 2 to add, 0 to change, 0 to destroy. : # terraform apply :","title":"\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5\u306e\u8a2d\u5b9a\u3092\u8ffd\u52a0"},{"location":"handson/ecs/#_7","text":"# SecurityGroup # https://www.terraform.io/docs/providers/aws/r/security_group.html resource \"aws_security_group\" \"ecs\" { name = \"handson-ecs\" description = \"handson ecs\" # \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u3092\u914d\u7f6e\u3059\u308bVPC vpc_id = \"${aws_vpc.main.id}\" # \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u5185\u306e\u30ea\u30bd\u30fc\u30b9\u304b\u3089\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u3078\u306e\u30a2\u30af\u30bb\u30b9\u8a31\u53ef\u8a2d\u5b9a # \u4eca\u56de\u306e\u5834\u5408DockerHub\u3078\u306ePull\u306b\u4f7f\u7528\u3059\u308b\u3002 egress { from_port = 0 to_port = 0 protocol = \"-1\" cidr_blocks = [ \"0.0.0.0/0\" ] } tags = { Name = \"handson-ecs\" } } # SecurityGroup Rule # https://www.terraform.io/docs/providers/aws/r/security_group.html resource \"aws_security_group_rule\" \"ecs\" { security_group_id = \"${aws_security_group.ecs.id}\" # \u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u304b\u3089\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u5185\u306e\u30ea\u30bd\u30fc\u30b9\u3078\u306e\u30a2\u30af\u30bb\u30b9\u8a31\u53ef\u8a2d\u5b9a type = \"ingress\" # TCP\u3067\u306e80\u30dd\u30fc\u30c8\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3092\u8a31\u53ef\u3059\u308b from_port = 80 to_port = 80 protocol = \"tcp\" # \u540c\u4e00VPC\u5185\u304b\u3089\u306e\u30a2\u30af\u30bb\u30b9\u306e\u307f\u8a31\u53ef cidr_blocks = [ \"10.0.0.0/16\" ] } # ECS Service # https://www.terraform.io/docs/providers/aws/r/ecs_service.html resource \"aws_ecs_service\" \"main\" { name = \"handson\" # \u4f9d\u5b58\u95a2\u4fc2\u306e\u8a18\u8ff0\u3002 # \"aws_lb_listener_rule.main\" \u30ea\u30bd\u30fc\u30b9\u306e\u4f5c\u6210\u304c\u5b8c\u4e86\u3059\u308b\u306e\u3092\u5f85\u3063\u3066\u304b\u3089\u5f53\u8a72\u30ea\u30bd\u30fc\u30b9\u306e\u4f5c\u6210\u3092\u958b\u59cb\u3059\u308b\u3002 # \"depends_on\" \u306f \"aws_ecs_service\" \u30ea\u30bd\u30fc\u30b9\u5c02\u7528\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u3067\u306f\u306a\u304f\u3001Terraform\u306e\u30b7\u30f3\u30bf\u30c3\u30af\u30b9\u306e\u305f\u3081\u4ed6\u306e\"resource\"\u3067\u3082\u4f7f\u7528\u53ef\u80fd depends_on = [ \"aws_lb_listener_rule.main\" ] # \u5f53\u8a72ECS\u30b5\u30fc\u30d3\u30b9\u3092\u914d\u7f6e\u3059\u308bECS\u30af\u30e9\u30b9\u30bf\u30fc\u306e\u6307\u5b9a cluster = \"${aws_ecs_cluster.main.name}\" # \u30c7\u30fc\u30bf\u30d7\u30ec\u30fc\u30f3\u3068\u3057\u3066Fargate\u3092\u4f7f\u7528\u3059\u308b launch_type = \"FARGATE\" # ECS\u30bf\u30b9\u30af\u306e\u8d77\u52d5\u6570\u3092\u5b9a\u7fa9 desired_count = \"1\" # \u8d77\u52d5\u3059\u308bECS\u30bf\u30b9\u30af\u306e\u30bf\u30b9\u30af\u5b9a\u7fa9 task_definition = \"${aws_ecs_task_definition.main.arn}\" # ECS\u30bf\u30b9\u30af\u3078\u8a2d\u5b9a\u3059\u308b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u8a2d\u5b9a network_configuration = { # \u30bf\u30b9\u30af\u306e\u8d77\u52d5\u3092\u8a31\u53ef\u3059\u308b\u30b5\u30d6\u30cd\u30c3\u30c8 subnets = [ \"${aws_subnet.private_1a.id}\" , \"${aws_subnet.private_1c.id}\" , \"${aws_subnet.private_1d.id}\" ] # \u30bf\u30b9\u30af\u306b\u7d10\u4ed8\u3051\u308b\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7 security_groups = [ \"${aws_security_group.ecs.id}\" ] } # ECS\u30bf\u30b9\u30af\u306e\u8d77\u52d5\u5f8c\u306b\u7d10\u4ed8\u3051\u308bELB\u30bf\u30fc\u30b2\u30c3\u30c8\u30b0\u30eb\u30fc\u30d7 load_balancer = [ { target_group_arn = \"${aws_lb_target_group.main.arn}\" container_name = \"nginx\" container_port = \"80\" }, ] } \u30b3\u30fc\u30c9\u306e\u9069\u7528\u3092\u884c\u3044\u307e\u3059\u3002 # terraform plan # terraform apply : ALB\u306eWeb\u30b3\u30f3\u30bd\u30fc\u30eb\u306b\u8868\u793a\u3055\u308c\u3066\u3044\u308bDNS\u3078http\u3067\u30a2\u30af\u30bb\u30b9\u3057\u3001nginx\u304c\u8868\u793a\u3055\u308c\u308c\u3070\u6210\u529f\u3067\u3059 https://ap-northeast-1.console.aws.amazon.com/ec2/v2/home?region=ap-northeast-1#LoadBalancers","title":"\u30b5\u30fc\u30d3\u30b9\u306e\u4f5c\u6210"},{"location":"handson/https/","text":"\u3053\u306e\u7ae0\u306e\u76ee\u6a19 \u00b6 \u3053\u306e\u7ae0\u3067\u306fALB\u3068\u30c9\u30e1\u30a4\u30f3\u306e\u7d10\u4ed8\u3051\u3068https\u306e\u5bfe\u5fdc\u3092\u884c\u3044\u307e\u3059\u3002 \u305d\u306e\u305f\u3081\u3001\u30c9\u30e1\u30a4\u30f3\u304c\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002 \u4f5c\u6210\u3059\u308b\u30ea\u30bd\u30fc\u30b9\u306f\u4ee5\u4e0b\u306e6\u3064\u3067\u3059\u3002 AWS Certificate Manager TLS\u8a3c\u660e\u66f8\u306e\u767a\u884c Route 53 CNAME\u30ec\u30b3\u30fc\u30c9 TLS\u8a3c\u660e\u66f8\u767a\u884c\u6642\u306b\u30c9\u30e1\u30a4\u30f3\u306e\u6240\u6709\u3092\u8a3c\u660e\u3059\u308b\u305f\u3081\u306b\u4f5c\u6210 AWS Certificate Manager Validation TLS\u8a3c\u660e\u66f8\u767a\u884c\u6642\u306b\u30c9\u30e1\u30a4\u30f3\u306e\u6240\u6709\u3092\u8a3c\u660e\u3059\u308b\u305f\u3081\u306b\u4f5c\u6210 ACM\u3067\u30c9\u30e1\u30a4\u30f3\u3092\u4f7f\u7528\u3057\u3066\u6240\u6709\u8a3c\u660e\u3092\u3059\u308b\u5834\u5408\u306f\u57fa\u672c\u7684\u306bCNAME\u30ec\u30b3\u30fc\u30c9\u3068\u30ef\u30f3\u30bb\u30c3\u30c8\u3067\u5b9a\u7fa9\u3059\u308b\u3002 Route 53 A\u30ec\u30b3\u30fc\u30c9 ALB\u3068\u30c9\u30e1\u30a4\u30f3\u306e\u7d10\u4ed8\u3051\u7528\u30ec\u30b3\u30fc\u30c9 \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u30eb\u30fc\u30eb \u4f5c\u6210\u6e08\u307f\u306eALB\u7528\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u3078https\u3082\u53d7\u3051\u4ed8\u3051\u308b\u3088\u3046\u30eb\u30fc\u30eb\u3092\u8ffd\u52a0\u3059\u308b ALB http\u30ea\u30b9\u30ca\u30fc http\u30ea\u30af\u30a8\u30b9\u30c8\u53d7\u3051\u3064\u3051\u3001\u305d\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u3092https\u3078\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3055\u305b\u308b\u30eb\u30fc\u30eb ALB https\u30ea\u30b9\u30ca\u30fc https\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u53d7\u3051\u3064\u3051\u3001\u305d\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u4f5c\u6210\u6e08\u307f\u306eECS(nginx)\u3078\u6d41\u3059\u30eb\u30fc\u30eb \u30b3\u30fc\u30c9\u306e\u8a18\u8ff0 \u00b6 \u4eca\u56de\u306f\u65b0\u3057\u304f variable \u3068 data \u306e2\u3064\u306e\u30d6\u30ed\u30c3\u30af\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002 variable \u306f\u5909\u6570\u306e\u5b9a\u7fa9\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002 \u8907\u6570\u306e\u30d6\u30ed\u30c3\u30af\u3067\u5171\u901a\u3057\u3066\u4f7f\u7528\u3059\u308b\u5024\u3084\u3001\u74b0\u5883(\u30b9\u30c6\u30fc\u30b8\u30f3\u30b0\u30fb\u672c\u756a)\u6bce\u306b\u4f9d\u5b58\u3059\u308b\u5024\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002 data \u306f\u65e2\u5b58\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u53c2\u7167\u3057\u307e\u3059\u3002 \u57fa\u672c\u7684\u306b resource \u3067\u306fTerraform\u3067\u7ba1\u7406\u3055\u308c\u3066\u3044\u306a\u3044\u5834\u5408\u65b0\u898f\u306b\u4f5c\u6210\u3057\u307e\u3059\u3002\u3057\u304b\u3057\u3001\u65e2\u5b58\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u4f7f\u7528\u3057\u305f\u3044\u30b1\u30fc\u30b9\u3084Terraform\u3067\u7ba1\u7406\u3057\u305f\u304f\u306a\u3044\u30ea\u30bd\u30fc\u30b9\u306f\u5f80\u3005\u306b\u3057\u3066\u5b58\u5728\u3057\u307e\u3059\u3002\u305d\u3046\u3044\u3063\u305f\u30ea\u30bd\u30fc\u30b9\u306e\u60c5\u5831\u3092Terraform\u3067\u7ba1\u7406\u305b\u305a\u53c2\u7167\u3059\u308b\u305f\u3081\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002 \u5b9f\u969b\u306b\u30b3\u30fc\u30c9\u3092\u5b9a\u7fa9\u3057\u3066\u3044\u304d\u307e\u3059\u3002 variable \u306fRoute53\u3067\u7ba1\u7406\u3057\u3066\u3044\u308b\u30c9\u30e1\u30a4\u30f3\u540d\u3092\u5165\u529b\u3057\u3001 data \u3067\u305d\u306e\u30c9\u30e1\u30a4\u30f3\u3092\u53c2\u7167\u3057\u3066ACM\u306e\u8a3c\u660e\u66f8\u767a\u884c\u3084ALB\u3068\u30c9\u30e1\u30a4\u30f3\u306e\u7d10\u4ed8\u3051\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002 variable \"domain\" { description = \"Route 53 \u3067\u7ba1\u7406\u3057\u3066\u3044\u308b\u30c9\u30e1\u30a4\u30f3\u540d\" type = \"string\" #FIXME: default = \"<YOUR DOMAIN NAME>\" } # Route53 Hosted Zone # https://www.terraform.io/docs/providers/aws/d/route53_zone.html data \"aws_route53_zone\" \"main\" { name = \"${var.domain}\" private_zone = false } # ACM # https://www.terraform.io/docs/providers/aws/r/acm_certificate.html resource \"aws_acm_certificate\" \"main\" { domain_name = \"${var.domain}\" validation_method = \"DNS\" lifecycle { create_before_destroy = true } } # Route53 record # https://www.terraform.io/docs/providers/aws/r/route53_record.html resource \"aws_route53_record\" \"validation\" { depends_on = [ \"aws_acm_certificate.main\" ] zone_id = \"${data.aws_route53_zone.main.id}\" ttl = 60 name = \"${aws_acm_certificate.main.domain_validation_options.0.resource_record_name}\" type = \"${aws_acm_certificate.main.domain_validation_options.0.resource_record_type}\" records = [ \"${aws_acm_certificate.main.domain_validation_options.0.resource_record_value}\" ] } # ACM Validate # https://www.terraform.io/docs/providers/aws/r/acm_certificate_validation.html resource \"aws_acm_certificate_validation\" \"main\" { certificate_arn = \"${aws_acm_certificate.main.arn}\" validation_record_fqdns = [ \"${aws_route53_record.validation.0.fqdn}\" ] } # Route53 record # https://www.terraform.io/docs/providers/aws/r/route53_record.html resource \"aws_route53_record\" \"main\" { type = \"A\" name = \"${var.domain}\" zone_id = \"${data.aws_route53_zone.main.id}\" alias = { name = \"${aws_lb.main.dns_name}\" zone_id = \"${aws_lb.main.zone_id}\" evaluate_target_health = true } } # ALB Listener # https://www.terraform.io/docs/providers/aws/r/lb_listener.html resource \"aws_lb_listener\" \"https\" { load_balancer_arn = \"${aws_lb.main.arn}\" certificate_arn = \"${aws_acm_certificate.main.arn}\" port = \"443\" protocol = \"HTTPS\" default_action { type = \"forward\" target_group_arn = \"${aws_lb_target_group.main.id}\" } } # ALB Listener Rule # https://www.terraform.io/docs/providers/aws/r/lb_listener_rule.html resource \"aws_lb_listener_rule\" \"http_to_https\" { listener_arn = \"${aws_lb_listener.main.arn}\" priority = 99 action { type = \"redirect\" redirect { port = \"443\" protocol = \"HTTPS\" status_code = \"HTTP_301\" } } condition { field = \"host-header\" values = [ \"${var.domain}\" ] } } # Security Group Rule # https://www.terraform.io/docs/providers/aws/r/security_group_rule.html resource \"aws_security_group_rule\" \"alb_https\" { security_group_id = \"${aws_security_group.alb.id}\" type = \"ingress\" from_port = 443 to_port = 443 protocol = \"tcp\" cidr_blocks = [ \"0.0.0.0/0\" ] } \u30b3\u30fc\u30c9\u306e\u9069\u7528\u3092\u884c\u3044\u307e\u3059\u3002 # terraform plan # terraform apply : \u5b9f\u969b\u306b\u767b\u9332\u3057\u305f\u30c9\u30e1\u30a4\u30f3\u3078http\u3067\u30a2\u30af\u30bb\u30b9\u3057\u3001https\u3078\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3055\u308c\u3001nginx\u304c\u8868\u793a\u3055\u308c\u308c\u3070\u6210\u529f\u3067\u3059\u3002 \u7247\u4ed8\u3051 \u00b6 \u6e80\u8db3\u3057\u305f\u3089\u30ea\u30bd\u30fc\u30b9\u3092\u524a\u9664\u3057\u307e\u3057\u3087\u3046\u3002 # terraform destroy","title":"https\u5316"},{"location":"handson/https/#_1","text":"\u3053\u306e\u7ae0\u3067\u306fALB\u3068\u30c9\u30e1\u30a4\u30f3\u306e\u7d10\u4ed8\u3051\u3068https\u306e\u5bfe\u5fdc\u3092\u884c\u3044\u307e\u3059\u3002 \u305d\u306e\u305f\u3081\u3001\u30c9\u30e1\u30a4\u30f3\u304c\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002 \u4f5c\u6210\u3059\u308b\u30ea\u30bd\u30fc\u30b9\u306f\u4ee5\u4e0b\u306e6\u3064\u3067\u3059\u3002 AWS Certificate Manager TLS\u8a3c\u660e\u66f8\u306e\u767a\u884c Route 53 CNAME\u30ec\u30b3\u30fc\u30c9 TLS\u8a3c\u660e\u66f8\u767a\u884c\u6642\u306b\u30c9\u30e1\u30a4\u30f3\u306e\u6240\u6709\u3092\u8a3c\u660e\u3059\u308b\u305f\u3081\u306b\u4f5c\u6210 AWS Certificate Manager Validation TLS\u8a3c\u660e\u66f8\u767a\u884c\u6642\u306b\u30c9\u30e1\u30a4\u30f3\u306e\u6240\u6709\u3092\u8a3c\u660e\u3059\u308b\u305f\u3081\u306b\u4f5c\u6210 ACM\u3067\u30c9\u30e1\u30a4\u30f3\u3092\u4f7f\u7528\u3057\u3066\u6240\u6709\u8a3c\u660e\u3092\u3059\u308b\u5834\u5408\u306f\u57fa\u672c\u7684\u306bCNAME\u30ec\u30b3\u30fc\u30c9\u3068\u30ef\u30f3\u30bb\u30c3\u30c8\u3067\u5b9a\u7fa9\u3059\u308b\u3002 Route 53 A\u30ec\u30b3\u30fc\u30c9 ALB\u3068\u30c9\u30e1\u30a4\u30f3\u306e\u7d10\u4ed8\u3051\u7528\u30ec\u30b3\u30fc\u30c9 \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u30eb\u30fc\u30eb \u4f5c\u6210\u6e08\u307f\u306eALB\u7528\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u3078https\u3082\u53d7\u3051\u4ed8\u3051\u308b\u3088\u3046\u30eb\u30fc\u30eb\u3092\u8ffd\u52a0\u3059\u308b ALB http\u30ea\u30b9\u30ca\u30fc http\u30ea\u30af\u30a8\u30b9\u30c8\u53d7\u3051\u3064\u3051\u3001\u305d\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u3092https\u3078\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3055\u305b\u308b\u30eb\u30fc\u30eb ALB https\u30ea\u30b9\u30ca\u30fc https\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u53d7\u3051\u3064\u3051\u3001\u305d\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u4f5c\u6210\u6e08\u307f\u306eECS(nginx)\u3078\u6d41\u3059\u30eb\u30fc\u30eb","title":"\u3053\u306e\u7ae0\u306e\u76ee\u6a19"},{"location":"handson/https/#_2","text":"\u4eca\u56de\u306f\u65b0\u3057\u304f variable \u3068 data \u306e2\u3064\u306e\u30d6\u30ed\u30c3\u30af\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002 variable \u306f\u5909\u6570\u306e\u5b9a\u7fa9\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002 \u8907\u6570\u306e\u30d6\u30ed\u30c3\u30af\u3067\u5171\u901a\u3057\u3066\u4f7f\u7528\u3059\u308b\u5024\u3084\u3001\u74b0\u5883(\u30b9\u30c6\u30fc\u30b8\u30f3\u30b0\u30fb\u672c\u756a)\u6bce\u306b\u4f9d\u5b58\u3059\u308b\u5024\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002 data \u306f\u65e2\u5b58\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u53c2\u7167\u3057\u307e\u3059\u3002 \u57fa\u672c\u7684\u306b resource \u3067\u306fTerraform\u3067\u7ba1\u7406\u3055\u308c\u3066\u3044\u306a\u3044\u5834\u5408\u65b0\u898f\u306b\u4f5c\u6210\u3057\u307e\u3059\u3002\u3057\u304b\u3057\u3001\u65e2\u5b58\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u4f7f\u7528\u3057\u305f\u3044\u30b1\u30fc\u30b9\u3084Terraform\u3067\u7ba1\u7406\u3057\u305f\u304f\u306a\u3044\u30ea\u30bd\u30fc\u30b9\u306f\u5f80\u3005\u306b\u3057\u3066\u5b58\u5728\u3057\u307e\u3059\u3002\u305d\u3046\u3044\u3063\u305f\u30ea\u30bd\u30fc\u30b9\u306e\u60c5\u5831\u3092Terraform\u3067\u7ba1\u7406\u305b\u305a\u53c2\u7167\u3059\u308b\u305f\u3081\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002 \u5b9f\u969b\u306b\u30b3\u30fc\u30c9\u3092\u5b9a\u7fa9\u3057\u3066\u3044\u304d\u307e\u3059\u3002 variable \u306fRoute53\u3067\u7ba1\u7406\u3057\u3066\u3044\u308b\u30c9\u30e1\u30a4\u30f3\u540d\u3092\u5165\u529b\u3057\u3001 data \u3067\u305d\u306e\u30c9\u30e1\u30a4\u30f3\u3092\u53c2\u7167\u3057\u3066ACM\u306e\u8a3c\u660e\u66f8\u767a\u884c\u3084ALB\u3068\u30c9\u30e1\u30a4\u30f3\u306e\u7d10\u4ed8\u3051\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002 variable \"domain\" { description = \"Route 53 \u3067\u7ba1\u7406\u3057\u3066\u3044\u308b\u30c9\u30e1\u30a4\u30f3\u540d\" type = \"string\" #FIXME: default = \"<YOUR DOMAIN NAME>\" } # Route53 Hosted Zone # https://www.terraform.io/docs/providers/aws/d/route53_zone.html data \"aws_route53_zone\" \"main\" { name = \"${var.domain}\" private_zone = false } # ACM # https://www.terraform.io/docs/providers/aws/r/acm_certificate.html resource \"aws_acm_certificate\" \"main\" { domain_name = \"${var.domain}\" validation_method = \"DNS\" lifecycle { create_before_destroy = true } } # Route53 record # https://www.terraform.io/docs/providers/aws/r/route53_record.html resource \"aws_route53_record\" \"validation\" { depends_on = [ \"aws_acm_certificate.main\" ] zone_id = \"${data.aws_route53_zone.main.id}\" ttl = 60 name = \"${aws_acm_certificate.main.domain_validation_options.0.resource_record_name}\" type = \"${aws_acm_certificate.main.domain_validation_options.0.resource_record_type}\" records = [ \"${aws_acm_certificate.main.domain_validation_options.0.resource_record_value}\" ] } # ACM Validate # https://www.terraform.io/docs/providers/aws/r/acm_certificate_validation.html resource \"aws_acm_certificate_validation\" \"main\" { certificate_arn = \"${aws_acm_certificate.main.arn}\" validation_record_fqdns = [ \"${aws_route53_record.validation.0.fqdn}\" ] } # Route53 record # https://www.terraform.io/docs/providers/aws/r/route53_record.html resource \"aws_route53_record\" \"main\" { type = \"A\" name = \"${var.domain}\" zone_id = \"${data.aws_route53_zone.main.id}\" alias = { name = \"${aws_lb.main.dns_name}\" zone_id = \"${aws_lb.main.zone_id}\" evaluate_target_health = true } } # ALB Listener # https://www.terraform.io/docs/providers/aws/r/lb_listener.html resource \"aws_lb_listener\" \"https\" { load_balancer_arn = \"${aws_lb.main.arn}\" certificate_arn = \"${aws_acm_certificate.main.arn}\" port = \"443\" protocol = \"HTTPS\" default_action { type = \"forward\" target_group_arn = \"${aws_lb_target_group.main.id}\" } } # ALB Listener Rule # https://www.terraform.io/docs/providers/aws/r/lb_listener_rule.html resource \"aws_lb_listener_rule\" \"http_to_https\" { listener_arn = \"${aws_lb_listener.main.arn}\" priority = 99 action { type = \"redirect\" redirect { port = \"443\" protocol = \"HTTPS\" status_code = \"HTTP_301\" } } condition { field = \"host-header\" values = [ \"${var.domain}\" ] } } # Security Group Rule # https://www.terraform.io/docs/providers/aws/r/security_group_rule.html resource \"aws_security_group_rule\" \"alb_https\" { security_group_id = \"${aws_security_group.alb.id}\" type = \"ingress\" from_port = 443 to_port = 443 protocol = \"tcp\" cidr_blocks = [ \"0.0.0.0/0\" ] } \u30b3\u30fc\u30c9\u306e\u9069\u7528\u3092\u884c\u3044\u307e\u3059\u3002 # terraform plan # terraform apply : \u5b9f\u969b\u306b\u767b\u9332\u3057\u305f\u30c9\u30e1\u30a4\u30f3\u3078http\u3067\u30a2\u30af\u30bb\u30b9\u3057\u3001https\u3078\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3055\u308c\u3001nginx\u304c\u8868\u793a\u3055\u308c\u308c\u3070\u6210\u529f\u3067\u3059\u3002","title":"\u30b3\u30fc\u30c9\u306e\u8a18\u8ff0"},{"location":"handson/https/#_3","text":"\u6e80\u8db3\u3057\u305f\u3089\u30ea\u30bd\u30fc\u30b9\u3092\u524a\u9664\u3057\u307e\u3057\u3087\u3046\u3002 # terraform destroy","title":"\u7247\u4ed8\u3051"},{"location":"handson/syntax/","text":"\u3053\u306e\u7ae0\u3067\u306f\u4eca\u307e\u3067\u4f7f\u7528\u3057\u305fTerraform\u306e\u30b7\u30f3\u30bf\u30c3\u30af\u30b9\u306b\u3064\u3044\u3066\u5b66\u3093\u3067\u3044\u304d\u307e\u3059\u3002 \u4eca\u307e\u3067\u4f7f\u7528\u3057\u3066\u304d\u305f\u30d6\u30ed\u30c3\u30af prodivder , resource , variable , data \u306e\u3075\u308a\u304b\u3048\u308a\u3068\u3001\u65b0\u3057\u304f terraform , output , module , locals \u306b\u3064\u3044\u3066\u5b66\u3093\u3067\u3044\u304d\u307e\u3059\u3002 provider \u00b6 AWS/GCP/Azure\u306e\u3088\u3046\u306a\u30af\u30e9\u30a6\u30c9\u3001\u30aa\u30f3\u30d7\u30ec\u3001SaaS\u306a\u3069\u3001\u3069\u306e\u30a4\u30f3\u30d5\u30e9\u3092\u4f7f\u3046\u304b\u306e\u5ba3\u8a00\u3092\u884c\u3044\u307e\u3059\u3002 provider \"aws\" { region = \"ap-northeast-1\" } resource \u00b6 \u30a4\u30f3\u30d5\u30e9\u4e0a\u3078\u4f5c\u6210\u3059\u308b\u30ea\u30bd\u30fc\u30b9\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002 \u57fa\u672c\u7684\u306bTerraform\u306f\u3053\u306e resource \u30d6\u30ed\u30c3\u30af\u3092 \u30ea\u30d5\u30a1\u30ec\u30f3\u30b9 \u3092\u8aad\u307f\u306a\u304c\u3089\u66f8\u3044\u3066\u3044\u304d\u307e\u3059\u3002 resource \"aws_vpc\" \"main\" { cidr_block = \"10.0.0.0/16\" } variable \u00b6 \u5909\u6570\u306e\u5b9a\u7fa9\u3092\u884c\u3044\u307e\u3059\u3002 \u5171\u901a\u3067\u4f7f\u7528\u3057\u305f\u308a\u74b0\u5883\u6bce\u306b\u5206\u3051\u3066\u5b9a\u7fa9\u3057\u305f\u3044\u5024\u3092\u3053\u3053\u3067\u5ba3\u8a00\u3057\u307e\u3059\u3002 variable \"name\" { description = \"\u30ea\u30bd\u30fc\u30b9\u306b\u5171\u901a\u3057\u3066\u4ed8\u4e0e\u3059\u308b\u547d\u540d\" type = \"string\" default = \"handson\" } resource \"aws_vpc\" \"main\" { cidr_block = \"10.0.0.0/16\" tags = { Name = \"${var.name}\" } } resource \"aws_subnet\" \"public_1a\" { vpc_id = \"${aws_vpc.main.id}\" availability_zone = \"ap-northeast-1a\" cidr_block = \"10.0.1.0/24\" tags = { Name = \"${var.name}-public-1a\" } } data \u00b6 \u65e2\u5b58\u306e\u30ea\u30bd\u30fc\u30b9\u304b\u3089\u60c5\u5831\u3092\u53d6\u308a\u8fbc\u307f\u307e\u3059\u3002 \u4f8b\u3048\u3070\u624b\u52d5\u3067\u4f5c\u6210\u3057\u305f\u30c9\u30e1\u30a4\u30f3\u3092\u30b3\u30fc\u30c9\u3067\u7ba1\u7406\u3057\u305f\u308a\u3001\u5225\u306eTerraform\u3067\u7ba1\u7406\u3057\u3066\u3044\u308b\u30ea\u30bd\u30fc\u30b9\u3092\u53d6\u308a\u8fbc\u3080\u969b\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002 variable \"vpc_id\" { description = \"\u53d6\u308a\u8fbc\u3080VPC\u306eID\" type = \"string\" default = \"vpc-083474491091d1639\"\" } data \" aws_vpc \" \" main \" { id = \" $ { var . vpc_id } \" } resource \" aws_subnet \" \" public_1a \" { vpc_id = \" $ { data . aws_vpc . main . id } \" availability_zone = \" ap - northeast - 1 a \" cidr_block = \" 10 . 0 . 1 . 0 / 24 \" } terraform \u00b6 terraform\u30d6\u30ed\u30c3\u30af\u3092\u5b9a\u7fa9\u3059\u308b\u3053\u3068\u3067Terraform\u304c\u73fe\u5728\u7ba1\u7406\u3057\u3066\u3044\u308b\u30ea\u30bd\u30fc\u30b9\u60c5\u5831\u3092\u30ea\u30e2\u30fc\u30c8\u3067\u7ba1\u7406\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002 \u3053\u308c\u306b\u3088\u308a\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3084\u591a\u4eba\u6570\u958b\u767a\u304c\u53ef\u80fd\u306b\u306a\u308b\u305f\u3081\u3001\u57fa\u672c\u7684\u306bterraform\u30d6\u30ed\u30c3\u30af\u306f\u4f7f\u7528\u3059\u308b\u3053\u3068\u304c\u597d\u307e\u3057\u3044\u3067\u3059\u3002 AWS\u3067\u3042\u308c\u3070S3\u3092\u3001GCP\u3067\u3042\u308c\u3070GCS\u3092\u4f7f\u7528\u3059\u308b\u3068\u826f\u3044\u3067\u3057\u3087\u3046\u3002\u307e\u305f\u3001terraform\u30d6\u30ed\u30c3\u30af\u3067\u6307\u5b9a\u3059\u308bS3(GCS)\u306f\u5148\u306b\u4f5c\u6210\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 terraform { backend \"s3\" { bucket = \"<YOUR S3 BUCKET>\" key = \"terraform.tfstate\" region = \"ap-northeast-1\" } } module \u00b6 Terraform\u30b3\u30fc\u30c9\u3092\u5206\u5272\u3059\u308b\u305f\u3081\u306e\u6a5f\u80fd\u3067\u3059\u3002 \u4f8b\u3048\u3070\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30fb\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5\u30fb\u30b3\u30f3\u30c6\u30ca\u306a\u3069\u306e\u5358\u4f4d\u3067\u5206\u5272\u3057\u305f\u308a\u3001\u4ed6\u4eba\u304c\u516c\u958b\u3057\u3066\u3044\u308bTerraform\u306e\u30b3\u30fc\u30c9\u3092\u8aad\u307f\u8fbc\u3080\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002 # ./main.tf module \"network\" { source = \"./network\" } # ./network/main.tf resource \"aws_vpc\" \"main\" { cidr_block = \"10.0.0.0/16\" } resource \"aws_subnet\" \"public_1a\" { vpc_id = \"${aws_vpc.main.id}\" availability_zone = \"ap-northeast-1a\" cidr_block = \"10.0.1.0/24\" } output \u00b6 module\u5185\u306e\u30ea\u30bd\u30fc\u30b9\u306e\u60c5\u5831\u3092\u3001module\u5916\u3078\u516c\u958b\u3059\u308b\u305f\u3081\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002 # ./main.tf module \"network\" { source = \"./network\" } resource \"aws_security_group\" \"main\" { name = \"handson\" description = \"handson\" # module\u3092\u53c2\u7167\u3059\u308b vpc_id = \"${module.network.vpc_id}\" } # ./network/main.tf resource \"aws_vpc\" \"main\" { cidr_block = \"10.0.0.0/16\" } output \"vpc_id\" { value = \"${module.vpc.vpc_id}\" } locals \u00b6 variable\u30d6\u30ed\u30c3\u30af\u3068\u540c\u3058\u304f\u3001\u5909\u6570\u306e\u5ba3\u8a00\u3092\u884c\u3044\u307e\u3059\u3002 \u9055\u3044\u3068\u3057\u3066\u306f2\u70b9\u300c\u30b9\u30b3\u30fc\u30d7\u300d\u3068\u300c\u95a2\u6570\u306e\u4f7f\u7528\u304c\u53ef\u80fd\u300d\u306a\u70b9\u3067\u3059\u3002 variable\u3092\u5b9a\u7fa9\u3059\u308b\u3068\u30b9\u30b3\u30fc\u30d7\u304c\u30b0\u30ed\u30fc\u30d0\u30eb\u306b\u306a\u308b\u3053\u3068\u306b\u5bfe\u3057\u3001locals\u306f\u30b9\u30b3\u30fc\u30d7\u304cmodule\u5185\u3060\u3051\u306b\u306a\u308a\u307e\u3059\u3002 locals { name = \"myapp\" } resource \"aws_vpc\" \"main\" { cidr_block = \"10.0.0.0/16\" tags = { Name = \"${local.name}\" } } count \u00b6 \u7e70\u308a\u8fd4\u3057\u5b9f\u884c\u3092\u884c\u3046\u969b\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002 \u4f8b\u3048\u3070Subnet\u306e\u3088\u3046\u306a\u307b\u307c\u540c\u3058\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u5b9a\u7fa9\u3057\u3066\u8907\u6570\u4f5c\u6210\u3059\u308b\u3088\u3046\u306a\u30ea\u30bd\u30fc\u30b9\u3060\u3068\u30b3\u30fc\u30c9\u6570\u306e\u524a\u6e1b\u3068\u53ef\u8aad\u6027\u306e\u5411\u4e0a\u3078\u5f79\u7acb\u3061\u307e\u3059\u3002 provider \"aws\" { region = \"ap-northeast-1\" } variable \"azs\" { description = \"\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u914d\u7f6e\u3059\u308bAZ\u3002region\u3068\u5bfe\u5fdc\u3055\u305b\u308b\u5fc5\u8981\u3042\u308a\" default = [ \"ap-northeast-1a\" , \"ap-northeast-1c\" , \"ap-northeast-1d\" ] } variable \"subnet_cidrs\" { description = \"\u4f5c\u6210\u3059\u308b\u30b5\u30d6\u30cd\u30c3\u30c8CIDR\u4e00\u89a7\" default = [ \"10.0.0.0/24\" , \"10.0.1.0/24\" , \"10.0.2.0/24\" ] } resource \"aws_vpc\" \"main\" { cidr_block = \"10.0.0.0/16\" } resource \"aws_subnet\" \"public\" { # length\u95a2\u6570\u3067subnet_cidrs\u306e\u6570\u3092\u53d6\u5f97\u3057\u3001\u305d\u306e\u6570\u3076\u3093\u7e70\u308a\u8fd4\u3057\u5b9f\u884c\u3059\u308b count = \"${length(var.subnet_cidrs)}\" vpc_id = \"${aws_vpc.main.id}\" # \u73fe\u5728\u306e\u5b9f\u884c\u56de\u6570\u3092count.index\u3067\u53d6\u5f97\u3067\u304d\u3001\u305d\u308c\u3092\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3068\u3057\u3066\u914d\u5217\u304b\u3089\u5024\u3092\u53d6\u5f97\u3059\u308b availability_zone = \"${var.azs[count.index]}\" cidr_block = \"${var.subnet_cidrs[count.index]}\" } \u4e09\u9805\u6f14\u7b97\u5b50 \u00b6 \u6761\u4ef6\u5206\u5c90\u306f\u4e09\u9805\u6f14\u7b97\u5b50\u3068\u3057\u3066\u8a18\u8ff0\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002 1\u74b0\u5883\u3057\u304b\u4f5c\u6210\u3057\u306a\u3044\u5834\u5408\u306f\u57fa\u672c\u4f7f\u7528\u3057\u307e\u305b\u3093\u304c\u3001\u8907\u6570\u74b0\u5883\u4f5c\u6210\u3059\u308b\u5834\u5408\u74b0\u5883\u4f9d\u5b58\u306b\u306a\u3063\u3066\u3057\u307e\u3046\u7b87\u6240\u304c\u767a\u751f\u3057\u307e\u3059\u3002\u305d\u306e\u74b0\u5883\u306b\u3088\u3063\u3066\u7570\u306a\u308b\u5024\u3092\u632f\u308a\u5206\u3051\u308b\u305f\u3081\u306b\u4f7f\u7528\u3059\u308b\u3053\u3068\u304c\u591a\u3044\u3067\u3059\u3002 variable \"env\" { description = \"\u74b0\u5883\u540d\" default = \"dev\" } locals { cidr = \"${ env == \" prd \" ? \" 10 . 0 . 0 . 0 / 16 \" : \" 172 . 16 . 0 . 0 / 16 \" }\" } resource \"aws_vpc\" \"main\" { cidr_block = \"${locals.cidr}\" } depends_on \u00b6 \u5404\u30ea\u30bd\u30fc\u30b9\u306e\u4f9d\u5b58\u95a2\u4fc2\u3092\u5b9a\u7fa9\u3057\u3001\u30ea\u30bd\u30fc\u30b9\u306e\u4f5c\u6210\u9806\u756a\u3092\u5236\u5fa1\u3057\u307e\u3059\u3002 \u57fa\u672c\u7684\u306bTerraform\u304c\u4f9d\u5b58\u95a2\u4fc2\u3068\u4f5c\u6210\u9806\u306f\u89e3\u6c7a\u3057\u3066\u304f\u308c\u307e\u3059\u304c\u3001\u7a00\u306b\u4f5c\u6210\u9806\u306e\u5b9a\u7fa9\u304c\u5fc5\u8981\u306b\u306a\u308b\u30b1\u30fc\u30b9\u304c\u3042\u308b\u306e\u3067\u899a\u3048\u3066\u304a\u304f\u3068\u826f\u3044\u3067\u3057\u3087\u3046\u3002 \u30b7\u30f3\u30bf\u30c3\u30af\u30b9\u306e\u6d3b\u7528 \u00b6 \u30cf\u30f3\u30ba\u30aa\u30f3 \u3067\u5b9a\u7fa9\u3057\u305f\u30b3\u30fc\u30c9\u306f\u975e\u5e38\u9577\u304f\u3001\u53ef\u8aad\u6027\u304c\u60aa\u304f\u306a\u3063\u3066\u3044\u307e\u3059\u3002 \u3053\u306e\u7ae0\u3067\u7d39\u4ecb\u3057\u305f\u30b7\u30f3\u30bf\u30c3\u30af\u30b9\u3092\u4f7f\u7528\u3059\u308b\u3068\u3069\u306e\u69d8\u306b\u306a\u308b\u304b\u3001\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u3092\u8a18\u8ff0\u3057\u307e\u3057\u305f\u3002 https://github.com/y-ohgi/introduction-terraform/tree/master/handson/syntax \u3053\u306e\u5f8c\u306e\u7ae0\u306f\u3053\u306e\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u3092\u3082\u3068\u306b\u69cb\u7bc9\u3092\u9032\u3081\u307e\u3059\u3002","title":"\u30b7\u30f3\u30bf\u30c3\u30af\u30b9\u306e\u6d3b\u7528"},{"location":"handson/syntax/#provider","text":"AWS/GCP/Azure\u306e\u3088\u3046\u306a\u30af\u30e9\u30a6\u30c9\u3001\u30aa\u30f3\u30d7\u30ec\u3001SaaS\u306a\u3069\u3001\u3069\u306e\u30a4\u30f3\u30d5\u30e9\u3092\u4f7f\u3046\u304b\u306e\u5ba3\u8a00\u3092\u884c\u3044\u307e\u3059\u3002 provider \"aws\" { region = \"ap-northeast-1\" }","title":"provider"},{"location":"handson/syntax/#resource","text":"\u30a4\u30f3\u30d5\u30e9\u4e0a\u3078\u4f5c\u6210\u3059\u308b\u30ea\u30bd\u30fc\u30b9\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002 \u57fa\u672c\u7684\u306bTerraform\u306f\u3053\u306e resource \u30d6\u30ed\u30c3\u30af\u3092 \u30ea\u30d5\u30a1\u30ec\u30f3\u30b9 \u3092\u8aad\u307f\u306a\u304c\u3089\u66f8\u3044\u3066\u3044\u304d\u307e\u3059\u3002 resource \"aws_vpc\" \"main\" { cidr_block = \"10.0.0.0/16\" }","title":"resource"},{"location":"handson/syntax/#variable","text":"\u5909\u6570\u306e\u5b9a\u7fa9\u3092\u884c\u3044\u307e\u3059\u3002 \u5171\u901a\u3067\u4f7f\u7528\u3057\u305f\u308a\u74b0\u5883\u6bce\u306b\u5206\u3051\u3066\u5b9a\u7fa9\u3057\u305f\u3044\u5024\u3092\u3053\u3053\u3067\u5ba3\u8a00\u3057\u307e\u3059\u3002 variable \"name\" { description = \"\u30ea\u30bd\u30fc\u30b9\u306b\u5171\u901a\u3057\u3066\u4ed8\u4e0e\u3059\u308b\u547d\u540d\" type = \"string\" default = \"handson\" } resource \"aws_vpc\" \"main\" { cidr_block = \"10.0.0.0/16\" tags = { Name = \"${var.name}\" } } resource \"aws_subnet\" \"public_1a\" { vpc_id = \"${aws_vpc.main.id}\" availability_zone = \"ap-northeast-1a\" cidr_block = \"10.0.1.0/24\" tags = { Name = \"${var.name}-public-1a\" } }","title":"variable"},{"location":"handson/syntax/#data","text":"\u65e2\u5b58\u306e\u30ea\u30bd\u30fc\u30b9\u304b\u3089\u60c5\u5831\u3092\u53d6\u308a\u8fbc\u307f\u307e\u3059\u3002 \u4f8b\u3048\u3070\u624b\u52d5\u3067\u4f5c\u6210\u3057\u305f\u30c9\u30e1\u30a4\u30f3\u3092\u30b3\u30fc\u30c9\u3067\u7ba1\u7406\u3057\u305f\u308a\u3001\u5225\u306eTerraform\u3067\u7ba1\u7406\u3057\u3066\u3044\u308b\u30ea\u30bd\u30fc\u30b9\u3092\u53d6\u308a\u8fbc\u3080\u969b\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002 variable \"vpc_id\" { description = \"\u53d6\u308a\u8fbc\u3080VPC\u306eID\" type = \"string\" default = \"vpc-083474491091d1639\"\" } data \" aws_vpc \" \" main \" { id = \" $ { var . vpc_id } \" } resource \" aws_subnet \" \" public_1a \" { vpc_id = \" $ { data . aws_vpc . main . id } \" availability_zone = \" ap - northeast - 1 a \" cidr_block = \" 10 . 0 . 1 . 0 / 24 \" }","title":"data"},{"location":"handson/syntax/#terraform","text":"terraform\u30d6\u30ed\u30c3\u30af\u3092\u5b9a\u7fa9\u3059\u308b\u3053\u3068\u3067Terraform\u304c\u73fe\u5728\u7ba1\u7406\u3057\u3066\u3044\u308b\u30ea\u30bd\u30fc\u30b9\u60c5\u5831\u3092\u30ea\u30e2\u30fc\u30c8\u3067\u7ba1\u7406\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002 \u3053\u308c\u306b\u3088\u308a\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3084\u591a\u4eba\u6570\u958b\u767a\u304c\u53ef\u80fd\u306b\u306a\u308b\u305f\u3081\u3001\u57fa\u672c\u7684\u306bterraform\u30d6\u30ed\u30c3\u30af\u306f\u4f7f\u7528\u3059\u308b\u3053\u3068\u304c\u597d\u307e\u3057\u3044\u3067\u3059\u3002 AWS\u3067\u3042\u308c\u3070S3\u3092\u3001GCP\u3067\u3042\u308c\u3070GCS\u3092\u4f7f\u7528\u3059\u308b\u3068\u826f\u3044\u3067\u3057\u3087\u3046\u3002\u307e\u305f\u3001terraform\u30d6\u30ed\u30c3\u30af\u3067\u6307\u5b9a\u3059\u308bS3(GCS)\u306f\u5148\u306b\u4f5c\u6210\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 terraform { backend \"s3\" { bucket = \"<YOUR S3 BUCKET>\" key = \"terraform.tfstate\" region = \"ap-northeast-1\" } }","title":"terraform"},{"location":"handson/syntax/#module","text":"Terraform\u30b3\u30fc\u30c9\u3092\u5206\u5272\u3059\u308b\u305f\u3081\u306e\u6a5f\u80fd\u3067\u3059\u3002 \u4f8b\u3048\u3070\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30fb\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5\u30fb\u30b3\u30f3\u30c6\u30ca\u306a\u3069\u306e\u5358\u4f4d\u3067\u5206\u5272\u3057\u305f\u308a\u3001\u4ed6\u4eba\u304c\u516c\u958b\u3057\u3066\u3044\u308bTerraform\u306e\u30b3\u30fc\u30c9\u3092\u8aad\u307f\u8fbc\u3080\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002 # ./main.tf module \"network\" { source = \"./network\" } # ./network/main.tf resource \"aws_vpc\" \"main\" { cidr_block = \"10.0.0.0/16\" } resource \"aws_subnet\" \"public_1a\" { vpc_id = \"${aws_vpc.main.id}\" availability_zone = \"ap-northeast-1a\" cidr_block = \"10.0.1.0/24\" }","title":"module"},{"location":"handson/syntax/#output","text":"module\u5185\u306e\u30ea\u30bd\u30fc\u30b9\u306e\u60c5\u5831\u3092\u3001module\u5916\u3078\u516c\u958b\u3059\u308b\u305f\u3081\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002 # ./main.tf module \"network\" { source = \"./network\" } resource \"aws_security_group\" \"main\" { name = \"handson\" description = \"handson\" # module\u3092\u53c2\u7167\u3059\u308b vpc_id = \"${module.network.vpc_id}\" } # ./network/main.tf resource \"aws_vpc\" \"main\" { cidr_block = \"10.0.0.0/16\" } output \"vpc_id\" { value = \"${module.vpc.vpc_id}\" }","title":"output"},{"location":"handson/syntax/#locals","text":"variable\u30d6\u30ed\u30c3\u30af\u3068\u540c\u3058\u304f\u3001\u5909\u6570\u306e\u5ba3\u8a00\u3092\u884c\u3044\u307e\u3059\u3002 \u9055\u3044\u3068\u3057\u3066\u306f2\u70b9\u300c\u30b9\u30b3\u30fc\u30d7\u300d\u3068\u300c\u95a2\u6570\u306e\u4f7f\u7528\u304c\u53ef\u80fd\u300d\u306a\u70b9\u3067\u3059\u3002 variable\u3092\u5b9a\u7fa9\u3059\u308b\u3068\u30b9\u30b3\u30fc\u30d7\u304c\u30b0\u30ed\u30fc\u30d0\u30eb\u306b\u306a\u308b\u3053\u3068\u306b\u5bfe\u3057\u3001locals\u306f\u30b9\u30b3\u30fc\u30d7\u304cmodule\u5185\u3060\u3051\u306b\u306a\u308a\u307e\u3059\u3002 locals { name = \"myapp\" } resource \"aws_vpc\" \"main\" { cidr_block = \"10.0.0.0/16\" tags = { Name = \"${local.name}\" } }","title":"locals"},{"location":"handson/syntax/#count","text":"\u7e70\u308a\u8fd4\u3057\u5b9f\u884c\u3092\u884c\u3046\u969b\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002 \u4f8b\u3048\u3070Subnet\u306e\u3088\u3046\u306a\u307b\u307c\u540c\u3058\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u5b9a\u7fa9\u3057\u3066\u8907\u6570\u4f5c\u6210\u3059\u308b\u3088\u3046\u306a\u30ea\u30bd\u30fc\u30b9\u3060\u3068\u30b3\u30fc\u30c9\u6570\u306e\u524a\u6e1b\u3068\u53ef\u8aad\u6027\u306e\u5411\u4e0a\u3078\u5f79\u7acb\u3061\u307e\u3059\u3002 provider \"aws\" { region = \"ap-northeast-1\" } variable \"azs\" { description = \"\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u914d\u7f6e\u3059\u308bAZ\u3002region\u3068\u5bfe\u5fdc\u3055\u305b\u308b\u5fc5\u8981\u3042\u308a\" default = [ \"ap-northeast-1a\" , \"ap-northeast-1c\" , \"ap-northeast-1d\" ] } variable \"subnet_cidrs\" { description = \"\u4f5c\u6210\u3059\u308b\u30b5\u30d6\u30cd\u30c3\u30c8CIDR\u4e00\u89a7\" default = [ \"10.0.0.0/24\" , \"10.0.1.0/24\" , \"10.0.2.0/24\" ] } resource \"aws_vpc\" \"main\" { cidr_block = \"10.0.0.0/16\" } resource \"aws_subnet\" \"public\" { # length\u95a2\u6570\u3067subnet_cidrs\u306e\u6570\u3092\u53d6\u5f97\u3057\u3001\u305d\u306e\u6570\u3076\u3093\u7e70\u308a\u8fd4\u3057\u5b9f\u884c\u3059\u308b count = \"${length(var.subnet_cidrs)}\" vpc_id = \"${aws_vpc.main.id}\" # \u73fe\u5728\u306e\u5b9f\u884c\u56de\u6570\u3092count.index\u3067\u53d6\u5f97\u3067\u304d\u3001\u305d\u308c\u3092\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3068\u3057\u3066\u914d\u5217\u304b\u3089\u5024\u3092\u53d6\u5f97\u3059\u308b availability_zone = \"${var.azs[count.index]}\" cidr_block = \"${var.subnet_cidrs[count.index]}\" }","title":"count"},{"location":"handson/syntax/#_1","text":"\u6761\u4ef6\u5206\u5c90\u306f\u4e09\u9805\u6f14\u7b97\u5b50\u3068\u3057\u3066\u8a18\u8ff0\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002 1\u74b0\u5883\u3057\u304b\u4f5c\u6210\u3057\u306a\u3044\u5834\u5408\u306f\u57fa\u672c\u4f7f\u7528\u3057\u307e\u305b\u3093\u304c\u3001\u8907\u6570\u74b0\u5883\u4f5c\u6210\u3059\u308b\u5834\u5408\u74b0\u5883\u4f9d\u5b58\u306b\u306a\u3063\u3066\u3057\u307e\u3046\u7b87\u6240\u304c\u767a\u751f\u3057\u307e\u3059\u3002\u305d\u306e\u74b0\u5883\u306b\u3088\u3063\u3066\u7570\u306a\u308b\u5024\u3092\u632f\u308a\u5206\u3051\u308b\u305f\u3081\u306b\u4f7f\u7528\u3059\u308b\u3053\u3068\u304c\u591a\u3044\u3067\u3059\u3002 variable \"env\" { description = \"\u74b0\u5883\u540d\" default = \"dev\" } locals { cidr = \"${ env == \" prd \" ? \" 10 . 0 . 0 . 0 / 16 \" : \" 172 . 16 . 0 . 0 / 16 \" }\" } resource \"aws_vpc\" \"main\" { cidr_block = \"${locals.cidr}\" }","title":"\u4e09\u9805\u6f14\u7b97\u5b50"},{"location":"handson/syntax/#depends_on","text":"\u5404\u30ea\u30bd\u30fc\u30b9\u306e\u4f9d\u5b58\u95a2\u4fc2\u3092\u5b9a\u7fa9\u3057\u3001\u30ea\u30bd\u30fc\u30b9\u306e\u4f5c\u6210\u9806\u756a\u3092\u5236\u5fa1\u3057\u307e\u3059\u3002 \u57fa\u672c\u7684\u306bTerraform\u304c\u4f9d\u5b58\u95a2\u4fc2\u3068\u4f5c\u6210\u9806\u306f\u89e3\u6c7a\u3057\u3066\u304f\u308c\u307e\u3059\u304c\u3001\u7a00\u306b\u4f5c\u6210\u9806\u306e\u5b9a\u7fa9\u304c\u5fc5\u8981\u306b\u306a\u308b\u30b1\u30fc\u30b9\u304c\u3042\u308b\u306e\u3067\u899a\u3048\u3066\u304a\u304f\u3068\u826f\u3044\u3067\u3057\u3087\u3046\u3002","title":"depends_on"},{"location":"handson/syntax/#_2","text":"\u30cf\u30f3\u30ba\u30aa\u30f3 \u3067\u5b9a\u7fa9\u3057\u305f\u30b3\u30fc\u30c9\u306f\u975e\u5e38\u9577\u304f\u3001\u53ef\u8aad\u6027\u304c\u60aa\u304f\u306a\u3063\u3066\u3044\u307e\u3059\u3002 \u3053\u306e\u7ae0\u3067\u7d39\u4ecb\u3057\u305f\u30b7\u30f3\u30bf\u30c3\u30af\u30b9\u3092\u4f7f\u7528\u3059\u308b\u3068\u3069\u306e\u69d8\u306b\u306a\u308b\u304b\u3001\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u3092\u8a18\u8ff0\u3057\u307e\u3057\u305f\u3002 https://github.com/y-ohgi/introduction-terraform/tree/master/handson/syntax \u3053\u306e\u5f8c\u306e\u7ae0\u306f\u3053\u306e\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u3092\u3082\u3068\u306b\u69cb\u7bc9\u3092\u9032\u3081\u307e\u3059\u3002","title":"\u30b7\u30f3\u30bf\u30c3\u30af\u30b9\u306e\u6d3b\u7528"},{"location":"handson/vpc/","text":"\u3053\u306e\u7ae0\u306e\u76ee\u6a19 \u00b6 \u3053\u306e\u7ae0\u3067\u306f\u4e0a\u8a18\u306e\u56f3\u306e\u901a\u308a\u306eVPC\u30ea\u30bd\u30fc\u30b9\u3092\u69cb\u7bc9\u3057\u307e\u3059\u3002 3\u3064\u306eAvailability Zone \u3067\u8a2d\u8a08\u3057\u305f\u3068\u304d\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u304c\u76ee\u6a19\u3067\u3059\u3002 Terraform\u3067\u5b9f\u969b\u306b\u8a18\u8ff0\u3057\u3066\u3044\u304d\u307e\u3057\u3087\u3046\u3002 \u6e96\u5099 \u00b6 \u65b0\u3057\u3044Terminal\u3092\u7acb\u3061\u4e0a\u3052\u3001\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u3053\u306e\u7ae0\u7528\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u3001\u4f5c\u6210\u3057\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u79fb\u52d5\u3057\u3066\u304f\u3060\u3055\u3044\u3002 $ cd ~/Desktop/ $ mkdir terraform $ cd terraform Terraform\u3092\u7acb\u3061\u4e0a\u3052\u3066\u3044\u308bTerminal\u306b\u3082\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3001\u5171\u6709\u3055\u308c\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u79fb\u52d5\u3057\u3066\u304f\u3060\u3055\u3044\u3002 # cd /terraform # ls handson vpc-handson # cd handson \u30d7\u30ed\u30d0\u30a4\u30c0\u306e\u5b9a\u7fa9\u3092\u884c\u3044\u307e\u3059\u3002\u4eca\u56de\u3082AWS\u3092\u4f7f\u7528\u3059\u308b\u306e\u3067\u3001\"aws\"\u3068\u6307\u5b9a\u3057\u307e\u3059\u3002 \u4ee5\u4e0b\u306e\u30b3\u30fc\u30c9\u3092 main.tf \u306e\u547d\u540d\u3067 handson/ \u914d\u4e0b\u306b\u4f5c\u6210\u3057\u3066\u304f\u3060\u3055\u3044\u3002 provider \"aws\" { region = \"ap-northeast-1\" } terraform\u306e\u521d\u671f\u5316\u3092\u884c\u3044\u307e\u3059\u3002 # terraform init Initializing provider plugins... - Checking for available provider plugins on https://releases.hashicorp.com... - Downloading plugin for provider \"aws\" (2.6.0)... The following providers do not have any version constraints in configuration, so the latest version was installed. To prevent automatic upgrades to new major versions that may contain breaking changes, it is recommended to add version = \"...\" constraints to the corresponding provider blocks in configuration, with the constraint strings suggested below. * provider.aws: version = \"~> 2.6\" Terraform has been successfully initialized! You may now begin working with Terraform. Try running \"terraform plan\" to see any changes that are required for your infrastructure. All Terraform commands should now work. If you ever set or change modules or backend configuration for Terraform, rerun this command to reinitialize your working directory. If you forget, other commands will detect it and remind you to do so if necessary. VPC \u00b6 \u307e\u305a\u306f\u4eca\u56de\u4f7f\u7528\u3059\u308bVPC\u306e\u4f5c\u6210\u3092\u884c\u3044\u307e\u3059\u3002 \u4ee5\u4e0b\u306e\u30b3\u30fc\u30c9\u3092 main.tf \u3078\u8ffd\u8a18\u3057\u3066\u304f\u3060\u3055\u3044 # VPC # https://www.terraform.io/docs/providers/aws/r/vpc.html resource \"aws_vpc\" \"main\" { cidr_block = \"10.0.0.0/16\" tags = { Name = \"handson\" } } \u30b3\u30fc\u30c9\u306e\u8ffd\u8a18\u304c\u8ffd\u3048\u305f\u3089plan\u3092\u884c\u3063\u3066\u304b\u3089\u9069\u7528\u3092\u884c\u3044\u307e\u3059\u3002 # terraform plan terraform plan Refreshing Terraform state in-memory prior to plan... The refreshed state will be used to calculate this plan, but will not be persisted to local or remote state storage. ------------------------------------------------------------------------ An execution plan has been generated and is shown below. Resource actions are indicated with the following symbols: + create Terraform will perform the following actions: + aws_vpc.main id: <computed> arn: <computed> assign_generated_ipv6_cidr_block: \"false\" cidr_block: \"10.0.0.0/16\" default_network_acl_id: <computed> default_route_table_id: <computed> default_security_group_id: <computed> dhcp_options_id: <computed> enable_classiclink: <computed> enable_classiclink_dns_support: <computed> enable_dns_hostnames: <computed> enable_dns_support: \"true\" instance_tenancy: \"default\" ipv6_association_id: <computed> ipv6_cidr_block: <computed> main_route_table_id: <computed> owner_id: <computed> tags.%: \"1\" tags.Name: \"handson\" Plan: 1 to add, 0 to change, 0 to destroy. ------------------------------------------------------------------------ Note: You didn't specify an \"-out\" parameter to save this plan, so Terraform can't guarantee that exactly these actions will be performed if \"terraform apply\" is subsequently run. # terraform apply : \u5b9f\u969b\u306bVPC\u304c\u4f5c\u6210\u3055\u308c\u305f\u304b\u306e\u78ba\u8a8d\u3092\u3057\u307e\u3057\u3087\u3046\u3002 https://ap-northeast-1.console.aws.amazon.com/vpc/home?region=ap-northeast-1#vpcs:sort=desc:VpcId Subnet \u00b6 \u6b21\u306b\u30b5\u30d6\u30cd\u30c3\u30c8\u30926\u3064\u4f5c\u6210\u3057\u307e\u3059\u3002 Public Subnet\u3068Private Subnet\u306e2\u7a2e\u985e\u3068\u3001ap-northeast-1\u30ea\u30fc\u30b8\u30e7\u30f3(\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3)\u306b\u5b58\u5728\u3059\u308b3\u3064\u306eAZ\u3078\u5404\u7a2e\u30ea\u30bd\u30fc\u30b9(EC2\u3084ECS\u3084RDS\u306a\u3069)\u3092\u914d\u7f6e\u3057\u305f\u3044\u305f\u3081\u30012*3\u3067\u8a086\u3064\u306e\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002 \u307e\u305a\u306f\u300c\"handson-public-1a\"\u3068\u3044\u3046\u547d\u540d\u3067ap-northeast-1a\u306bCIDR\u304c10.0.1.0/24\u306e\u30b5\u30d6\u30cd\u30c3\u30c8\u300d\u3092\u4f5c\u6210\u3057\u3066\u307f\u307e\u3057\u3087\u3046 # Subnet # https://www.terraform.io/docs/providers/aws/r/subnet.html resource \"aws_subnet\" \"public_1a\" { # \u5148\u7a0b\u4f5c\u6210\u3057\u305fVPC\u3092\u53c2\u7167\u3057\u3001\u305d\u306eVPC\u5185\u306bSubnet\u3092\u7acb\u3066\u308b vpc_id = \"${aws_vpc.main.id}\" # Subnet\u3092\u4f5c\u6210\u3059\u308bAZ availability_zone = \"ap-northeast-1a\" cidr_block = \"10.0.1.0/24\" tags = { Name = \"handson-public-1a\" } } plan\u3092\u5b9f\u884c\u3057\u3001Subnet\u304c\u4f5c\u6210\u3055\u308c\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046\u3002 # terraform plan Refreshing Terraform state in-memory prior to plan... The refreshed state will be used to calculate this plan, but will not be persisted to local or remote state storage. aws_vpc.main: Refreshing state... (ID: vpc-0396987ded1c4fd87) ------------------------------------------------------------------------ An execution plan has been generated and is shown below. Resource actions are indicated with the following symbols: + create Terraform will perform the following actions: + aws_subnet.public_1a id: <computed> arn: <computed> assign_ipv6_address_on_creation: \"false\" availability_zone: \"ap-northeast-1a\" availability_zone_id: <computed> cidr_block: \"10.0.1.0/24\" ipv6_cidr_block: <computed> ipv6_cidr_block_association_id: <computed> map_public_ip_on_launch: \"false\" owner_id: <computed> tags.%: \"1\" tags.Name: \"handson-public-1a\" vpc_id: \"vpc-0396987ded1c4fd87\" Plan: 1 to add, 0 to change, 0 to destroy. ------------------------------------------------------------------------ Note: You didn't specify an \"-out\" parameter to save this plan, so Terraform can't guarantee that exactly these actions will be performed if \"terraform apply\" is subsequently run. \u554f\u984c\u306a\u3051\u308c\u3070apply\u3092\u5b9f\u884c\u3057\u3066Subnet\u306e\u4f5c\u6210\u3092\u884c\u3044\u307e\u3059\u3002 # terraform apply : \u4ee5\u4e0b\u306e\u30b3\u30fc\u30c9\u3092\u8ffd\u8a18\u3057\u3066\u3001\u6b8b\u308a5\u3064\u306e\u30b5\u30d6\u30cd\u30c3\u30c8\u3082\u4f5c\u6210\u3057\u307e\u3059\u3002 \u30ea\u30bd\u30fc\u30b9\u540d\uff08e.g. \"publi_1c\", \"public_1d\"\uff09\u3068\u5404\u7a2e\u30d7\u30ed\u30d1\u30c6\u30a3\u304c\u5c11\u3057\u305a\u3064\u3053\u3068\u306a\u308b\u306e\u3067\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002 resource \"aws_subnet\" \"public_1c\" { vpc_id = \"${aws_vpc.main.id}\" availability_zone = \"ap-northeast-1c\" cidr_block = \"10.0.2.0/24\" tags = { Name = \"handson-public-1c\" } } resource \"aws_subnet\" \"public_1d\" { vpc_id = \"${aws_vpc.main.id}\" availability_zone = \"ap-northeast-1d\" cidr_block = \"10.0.3.0/24\" tags = { Name = \"handson-public-1d\" } } # Private Subnets resource \"aws_subnet\" \"private_1a\" { vpc_id = \"${aws_vpc.main.id}\" availability_zone = \"ap-northeast-1a\" cidr_block = \"10.0.10.0/24\" tags = { Name = \"handson-private-1a\" } } resource \"aws_subnet\" \"private_1c\" { vpc_id = \"${aws_vpc.main.id}\" availability_zone = \"ap-northeast-1c\" cidr_block = \"10.0.20.0/24\" tags = { Name = \"handson-private-1c\" } } resource \"aws_subnet\" \"private_1d\" { vpc_id = \"${aws_vpc.main.id}\" availability_zone = \"ap-northeast-1d\" cidr_block = \"10.0.30.0/24\" tags = { Name = \"handson-private-1d\" } } plan\u3092\u5b9f\u884c\u3057\u30015\u3064\u306e\u65b0\u3057\u3044\u30ea\u30bd\u30fc\u30b9\u304c\u8ffd\u52a0\u3055\u308c\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046\u3002 # terraform plan : Plan: 5 to add, 0 to change, 0 to destroy. \u554f\u984c\u306a\u3051\u308c\u3070apply\u3092\u5b9f\u884c\u3057\u3066Subnet\u306e\u4f5c\u6210\u3092\u884c\u3044\u307e\u3059\u3002 # terraform apply Web\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089Subnet\u304c6\u3064\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046\u3002 \u30b5\u30a4\u30c9\u30d0\u30fc\u306eVPC\u3067\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3067\u5148\u7a0bTerraform\u304b\u3089\u4f5c\u6210\u3057\u305f \"handson\" \u3068\u3044\u3046VPC\u3092\u9078\u629e\u3059\u308b\u3068\u5206\u304b\u308a\u3084\u3059\u3044\u3067\u3059\u3002 https://ap-northeast-1.console.aws.amazon.com/vpc/home?region=ap-northeast-1#subnets:sort=tag:Name Internet Gateway \u00b6 VPC\u304b\u3089\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u3078\u306e\u51fa\u5165\u308a\u53e3\u3068\u306a\u308bInternet Gateway\u3092\u4f5c\u6210\u3057\u307e\u3057\u3087\u3046\u3002 \u30b3\u30f3\u30bd\u30fc\u30eb\u4e0a\u304b\u3089\u4f5c\u6210\u3059\u308b\u3068Internet Gateway \u3068VPC\u306f\u81ea\u52d5\u3067\u7d10\u4ed8\u304d\u307e\u305b\u3093\u304c\u3001Terraform\u306e\u5834\u5408\u30d7\u30ed\u30d1\u30c6\u30a3\u3067VPC\u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u3067\u81ea\u52d5\u7684\u306b\u7d10\u3065\u3051\u3066\u304f\u308c\u307e\u3059\u3002 # Internet Gateway # https://www.terraform.io/docs/providers/aws/r/internet_gateway.html resource \"aws_internet_gateway\" \"main\" { vpc_id = \"${aws_vpc.main.id}\" tags = { Name = \"handson\" } } plan\u3092\u5b9f\u884c\u3057\u30011\u3064\u306e\u30ea\u30bd\u30fc\u30b9\u304c\u8ffd\u52a0\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002 # terraform plan Plan: 1 to add, 0 to change, 0 to destroy. \u554f\u984c\u306a\u3051\u308c\u3070apply\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002 # terraform apply NAT Gateway \u00b6 \u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\u304b\u3089\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u3078\u901a\u4fe1\u3059\u308b\u305f\u3081\u306bNAT Gateway\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002 NAT Gateway\u306f1\u3064\u306eElastic IP\u304c\u5fc5\u8981\u306a\u306e\u3067\u305d\u306e\u5272\u308a\u5f53\u3066\u3068\u3001AZ\u6bce\u306b\u5fc5\u8981\u306a\u306e\u30673\u3064\u4f5c\u6210\u3057\u307e\u3059\u3002 \u307e\u305a\u306fap-northeast-1a\u7528\u306eNAT Gateway\u30921\u3064\u4f5c\u6210\u3057\u3066\u307f\u307e\u3057\u3087\u3046 # Elasti IP # https://www.terraform.io/docs/providers/aws/r/eip.html resource \"aws_eip\" \"nat_1a\" { vpc = true tags = { Name = \"handson-natgw-1a\" } } # NAT Gateway # https://www.terraform.io/docs/providers/aws/r/nat_gateway.html resource \"aws_nat_gateway\" \"nat_1a\" { subnet_id = \"${aws_subnet.public_1a.id}\" # NAT Gateway\u3092\u914d\u7f6e\u3059\u308bSubnet\u3092\u6307\u5b9a allocation_id = \"${aws_eip.nat_1a.id}\" # \u7d10\u4ed8\u3051\u308bElasti IP tags = { Name = \"handson-1a\" } } plan\u3067\u5909\u66f4\u78ba\u8a8d\u3092\u884c\u3044\u307e\u3059\u3002 # terraform plan Refreshing Terraform state in-memory prior to plan... The refreshed state will be used to calculate this plan, but will not be persisted to local or remote state storage. aws_vpc.main: Refreshing state... (ID: vpc-0396987ded1c4fd87) aws_subnet.public_1d: Refreshing state... (ID: subnet-0f8eb38d6429200be) aws_internet_gateway.main: Refreshing state... (ID: igw-0e46a72941683c00f) aws_subnet.private_1a: Refreshing state... (ID: subnet-0b4e88abdc1cf586a) aws_subnet.private_1d: Refreshing state... (ID: subnet-0910f1d541d1ad52d) aws_subnet.private_1c: Refreshing state... (ID: subnet-01e1173f6b8ed56d5) aws_subnet.public_1c: Refreshing state... (ID: subnet-0519598224db34049) aws_subnet.public_1a: Refreshing state... (ID: subnet-08b90fd31e5d8dec4) ------------------------------------------------------------------------ An execution plan has been generated and is shown below. Resource actions are indicated with the following symbols: + create Terraform will perform the following actions: + aws_eip.nat_1a id: <computed> allocation_id: <computed> association_id: <computed> domain: <computed> instance: <computed> network_interface: <computed> private_dns: <computed> private_ip: <computed> public_dns: <computed> public_ip: <computed> public_ipv4_pool: <computed> tags.%: \"1\" tags.Name: \"handson-natgw-1a\" vpc: \"true\" + aws_nat_gateway.nat_1a id: <computed> allocation_id: \"${aws_eip.nat_1a.id}\" network_interface_id: <computed> private_ip: <computed> public_ip: <computed> subnet_id: \"subnet-08b90fd31e5d8dec4\" Plan: 2 to add, 0 to change, 0 to destroy. ------------------------------------------------------------------------ Note: You didn't specify an \"-out\" parameter to save this plan, so Terraform can't guarantee that exactly these actions will be performed if \"terraform apply\" is subsequently run. Elastic IP \u3068NAT Gateway \u306e2\u3064\u304c\u4f5c\u6210\u3055\u308c\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3057\u305f\u3002 apply\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002 # terraform apply \u6b8b\u308a2\u3064\u306eNAT Gateway\u3082\u4f5c\u6210\u3057\u3066\u9069\u7528\u3057\u307e\u3057\u3087\u3046 resource \"aws_eip\" \"nat_1c\" { vpc = true tags = { Name = \"handson-natgw-1c\" } } resource \"aws_nat_gateway\" \"nat_1c\" { subnet_id = \"${aws_subnet.public_1c.id}\" allocation_id = \"${aws_eip.nat_1c.id}\" tags = { Name = \"handson-1c\" } } resource \"aws_eip\" \"nat_1d\" { vpc = true tags = { Name = \"handson-natgw-1d\" } } resource \"aws_nat_gateway\" \"nat_1d\" { subnet_id = \"${aws_subnet.public_1d.id}\" allocation_id = \"${aws_eip.nat_1d.id}\" tags = { Name = \"handson-1d\" } } # terraform plan : Plan: 6 to add, 0 to change, 0 to destroy. : # terraform apply : Route Table \u00b6 \u6700\u5f8c\u306b\u3001\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u3092\u758e\u901a\u3055\u305b\u308b\u305f\u3081\u306e\u7d4c\u8def\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002 Internet Gateway\u3092\u4f7f\u7528\u3057\u3066\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u3078\u758e\u901a\u3059\u308b\u305f\u3081\u306eRoute Table/Routes \u3068 NAT Gateway\u3092\u7d4c\u7531\u3057\u3066\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u3078\u758e\u901a\u3059\u308b\u305f\u3081\u306eRoute Table/Routes \u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002 Subnet\u306e\u547c\u3073\u5206\u3051 Internet Gateway\u3068\u76f4\u63a5\u7684\u306a\u7d4c\u8def\u304c\u5b58\u5728\u3059\u308bSubnet\u3092\"Public Subnet\"\u3068\u547c\u3073\u3001 \u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u3078\u306e\u7d4c\u8def\u304c\u5b58\u5728\u3057\u306a\u3044\u30fbNAT Gateway\u3092\u4f7f\u7528\u3057\u3066\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u3078\u63a5\u7d9a\u3057\u3066\u3044\u308bSubnet\u3092\"Private Subnet\" \u3068\u547c\u3073\u307e\u3059 \u307e\u305a\u306fInternet Gateway\u3068Subnet\u306e\u7d4c\u8def\u3092\u4f5c\u6210\u3057\u307e\u3057\u3087\u3046\u3002 \u5c11\u3057\u591a\u3044\u306e\u3067\u89e3\u8aac\u3059\u308b\u3068\u3001\u4f5c\u6210\u3059\u308b\u306e\u306f\u4ee5\u4e0b\u306e3\u7a2e\u985e\u306e\u30ea\u30bd\u30fc\u30b9\u3067\u3059\u3002 \"aws_route_table\" \u7d4c\u8def\u60c5\u5831\u306e\u683c\u7d0d \"aws_route\" Route Table\u3078\u7d4c\u8def\u60c5\u5831\u3092\u8ffd\u52a0 \u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8(0.0.0.0/0)\u3078\u63a5\u7d9a\u3059\u308b\u969b\u306fInternet Gateway\u3092\u4f7f\u7528\u3059\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3059\u308b \"aws_route_table_association\" Route Table\u3068Subnet\u306e\u7d10\u3065\u3051 # Route Table # https://www.terraform.io/docs/providers/aws/r/route_table.html resource \"aws_route_table\" \"public\" { vpc_id = \"${aws_vpc.main.id}\" tags = { Name = \"handson-public\" } } # Route # https://www.terraform.io/docs/providers/aws/r/route.html resource \"aws_route\" \"public\" { destination_cidr_block = \"0.0.0.0/0\" route_table_id = \"${aws_route_table.public.id}\" gateway_id = \"${aws_internet_gateway.main.id}\" } # Association # https://www.terraform.io/docs/providers/aws/r/route_table_association.html resource \"aws_route_table_association\" \"public_1a\" { subnet_id = \"${aws_subnet.public_1a.id}\" route_table_id = \"${aws_route_table.public.id}\" } resource \"aws_route_table_association\" \"public_1c\" { subnet_id = \"${aws_subnet.public_1c.id}\" route_table_id = \"${aws_route_table.public.id}\" } resource \"aws_route_table_association\" \"public_1d\" { subnet_id = \"${aws_subnet.public_1d.id}\" route_table_id = \"${aws_route_table.public.id}\" } # terraform plan : Plan: 5 to add, 0 to change, 0 to destroy. : # terraform apply : NAT Gateway\u3068Subnet\u306e\u7d4c\u8def\u3092\u4f5c\u6210\u3057\u307e\u3057\u3087\u3046\u3002 Internet Gateway \u3068\u306e\u9055\u3044\u3068\u3057\u3066\u306f\u5404AZ\u306bNAT Gateway \u304c\u5fc5\u8981\u306b\u306a\u308b\u70b9\u3067\u3059\u3002 # Route Table (Private) # https://www.terraform.io/docs/providers/aws/r/route_table.html resource \"aws_route_table\" \"private_1a\" { vpc_id = \"${aws_vpc.main.id}\" tags = { Name = \"handson-private-1a\" } } resource \"aws_route_table\" \"private_1c\" { vpc_id = \"${aws_vpc.main.id}\" tags = { Name = \"handson-private-1c\" } } resource \"aws_route_table\" \"private_1d\" { vpc_id = \"${aws_vpc.main.id}\" tags = { Name = \"handson-private-1d\" } } # Route (Private) # https://www.terraform.io/docs/providers/aws/r/route.html resource \"aws_route\" \"private_1a\" { destination_cidr_block = \"0.0.0.0/0\" route_table_id = \"${aws_route_table.private_1a.id}\" nat_gateway_id = \"${aws_nat_gateway.nat_1a.id}\" } resource \"aws_route\" \"private_1c\" { destination_cidr_block = \"0.0.0.0/0\" route_table_id = \"${aws_route_table.private_1c.id}\" nat_gateway_id = \"${aws_nat_gateway.nat_1c.id}\" } resource \"aws_route\" \"private_1d\" { destination_cidr_block = \"0.0.0.0/0\" route_table_id = \"${aws_route_table.private_1d.id}\" nat_gateway_id = \"${aws_nat_gateway.nat_1d.id}\" } # Association (Private) # https://www.terraform.io/docs/providers/aws/r/route_table_association.html resource \"aws_route_table_association\" \"private_1a\" { subnet_id = \"${aws_subnet.private_1a.id}\" route_table_id = \"${aws_route_table.private_1a.id}\" } resource \"aws_route_table_association\" \"private_1c\" { subnet_id = \"${aws_subnet.private_1c.id}\" route_table_id = \"${aws_route_table.private_1c.id}\" } resource \"aws_route_table_association\" \"private_1d\" { subnet_id = \"${aws_subnet.private_1d.id}\" route_table_id = \"${aws_route_table.private_1d.id}\" } # terraform plan : Plan: 9 to add, 0 to change, 0 to destroy. : # terraform apply : \u7d4c\u8def\u8a2d\u5b9a\u304c\u884c\u3048\u3066\u3044\u308b\u304bWeb\u30b3\u30f3\u30bd\u30fc\u30eb\u4e0a\u304b\u3089\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002 \u78ba\u8a8d\u30dd\u30a4\u30f3\u30c8 \"handson-\" \u3068\u3044\u3046\u540d\u524d\u304b\u3089\u306f\u3058\u307e\u308bRoute Table\u304c4\u3064\u3042\u308b\u304b \"handson-public\" \u306b3\u3064Subnet\u304c\u767b\u9332\u3055\u308c\u3066\u3044\u308b\u304b \"handson-public\" \u306b\u767b\u9332\u3055\u308c\u3066\u3044\u308bSubnet\u306fPublic Subnet\u306e\u547d\u540d\u306b\u306a\u3063\u3066\u3044\u308b\u304b \"handson-public\" \u306e0.0.0.0\u3078\u306e\u7d4c\u8def\u306fInternet Gateway\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\u304b \"handson-private-*\" \u306f3\u3064\u5b58\u5728\u3057\u3001\u305d\u308c\u305e\u308c1\u3064\u305a\u3064Subnet\u3092\u6301\u3063\u3066\u3044\u308b\u304b \"handson-private-*\" \u306f0.0.0.0\u3078\u306e\u7d4c\u8def\u306fNAT Gateway\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\u304b https://ap-northeast-1.console.aws.amazon.com/vpc/home?region=ap-northeast-1#RouteTables:sort=routeTableId \u3053\u3053\u307e\u3067\u3067\u57fa\u790e\u3068\u306a\u308b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30ea\u30bd\u30fc\u30b9\u306e\u4f5c\u6210\u306f\u5b8c\u4e86\u3067\u3059\uff01","title":"VPC"},{"location":"handson/vpc/#_1","text":"\u3053\u306e\u7ae0\u3067\u306f\u4e0a\u8a18\u306e\u56f3\u306e\u901a\u308a\u306eVPC\u30ea\u30bd\u30fc\u30b9\u3092\u69cb\u7bc9\u3057\u307e\u3059\u3002 3\u3064\u306eAvailability Zone \u3067\u8a2d\u8a08\u3057\u305f\u3068\u304d\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u304c\u76ee\u6a19\u3067\u3059\u3002 Terraform\u3067\u5b9f\u969b\u306b\u8a18\u8ff0\u3057\u3066\u3044\u304d\u307e\u3057\u3087\u3046\u3002","title":"\u3053\u306e\u7ae0\u306e\u76ee\u6a19"},{"location":"handson/vpc/#_2","text":"\u65b0\u3057\u3044Terminal\u3092\u7acb\u3061\u4e0a\u3052\u3001\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u3053\u306e\u7ae0\u7528\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u3001\u4f5c\u6210\u3057\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u79fb\u52d5\u3057\u3066\u304f\u3060\u3055\u3044\u3002 $ cd ~/Desktop/ $ mkdir terraform $ cd terraform Terraform\u3092\u7acb\u3061\u4e0a\u3052\u3066\u3044\u308bTerminal\u306b\u3082\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3001\u5171\u6709\u3055\u308c\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u79fb\u52d5\u3057\u3066\u304f\u3060\u3055\u3044\u3002 # cd /terraform # ls handson vpc-handson # cd handson \u30d7\u30ed\u30d0\u30a4\u30c0\u306e\u5b9a\u7fa9\u3092\u884c\u3044\u307e\u3059\u3002\u4eca\u56de\u3082AWS\u3092\u4f7f\u7528\u3059\u308b\u306e\u3067\u3001\"aws\"\u3068\u6307\u5b9a\u3057\u307e\u3059\u3002 \u4ee5\u4e0b\u306e\u30b3\u30fc\u30c9\u3092 main.tf \u306e\u547d\u540d\u3067 handson/ \u914d\u4e0b\u306b\u4f5c\u6210\u3057\u3066\u304f\u3060\u3055\u3044\u3002 provider \"aws\" { region = \"ap-northeast-1\" } terraform\u306e\u521d\u671f\u5316\u3092\u884c\u3044\u307e\u3059\u3002 # terraform init Initializing provider plugins... - Checking for available provider plugins on https://releases.hashicorp.com... - Downloading plugin for provider \"aws\" (2.6.0)... The following providers do not have any version constraints in configuration, so the latest version was installed. To prevent automatic upgrades to new major versions that may contain breaking changes, it is recommended to add version = \"...\" constraints to the corresponding provider blocks in configuration, with the constraint strings suggested below. * provider.aws: version = \"~> 2.6\" Terraform has been successfully initialized! You may now begin working with Terraform. Try running \"terraform plan\" to see any changes that are required for your infrastructure. All Terraform commands should now work. If you ever set or change modules or backend configuration for Terraform, rerun this command to reinitialize your working directory. If you forget, other commands will detect it and remind you to do so if necessary.","title":"\u6e96\u5099"},{"location":"handson/vpc/#vpc","text":"\u307e\u305a\u306f\u4eca\u56de\u4f7f\u7528\u3059\u308bVPC\u306e\u4f5c\u6210\u3092\u884c\u3044\u307e\u3059\u3002 \u4ee5\u4e0b\u306e\u30b3\u30fc\u30c9\u3092 main.tf \u3078\u8ffd\u8a18\u3057\u3066\u304f\u3060\u3055\u3044 # VPC # https://www.terraform.io/docs/providers/aws/r/vpc.html resource \"aws_vpc\" \"main\" { cidr_block = \"10.0.0.0/16\" tags = { Name = \"handson\" } } \u30b3\u30fc\u30c9\u306e\u8ffd\u8a18\u304c\u8ffd\u3048\u305f\u3089plan\u3092\u884c\u3063\u3066\u304b\u3089\u9069\u7528\u3092\u884c\u3044\u307e\u3059\u3002 # terraform plan terraform plan Refreshing Terraform state in-memory prior to plan... The refreshed state will be used to calculate this plan, but will not be persisted to local or remote state storage. ------------------------------------------------------------------------ An execution plan has been generated and is shown below. Resource actions are indicated with the following symbols: + create Terraform will perform the following actions: + aws_vpc.main id: <computed> arn: <computed> assign_generated_ipv6_cidr_block: \"false\" cidr_block: \"10.0.0.0/16\" default_network_acl_id: <computed> default_route_table_id: <computed> default_security_group_id: <computed> dhcp_options_id: <computed> enable_classiclink: <computed> enable_classiclink_dns_support: <computed> enable_dns_hostnames: <computed> enable_dns_support: \"true\" instance_tenancy: \"default\" ipv6_association_id: <computed> ipv6_cidr_block: <computed> main_route_table_id: <computed> owner_id: <computed> tags.%: \"1\" tags.Name: \"handson\" Plan: 1 to add, 0 to change, 0 to destroy. ------------------------------------------------------------------------ Note: You didn't specify an \"-out\" parameter to save this plan, so Terraform can't guarantee that exactly these actions will be performed if \"terraform apply\" is subsequently run. # terraform apply : \u5b9f\u969b\u306bVPC\u304c\u4f5c\u6210\u3055\u308c\u305f\u304b\u306e\u78ba\u8a8d\u3092\u3057\u307e\u3057\u3087\u3046\u3002 https://ap-northeast-1.console.aws.amazon.com/vpc/home?region=ap-northeast-1#vpcs:sort=desc:VpcId","title":"VPC"},{"location":"handson/vpc/#subnet","text":"\u6b21\u306b\u30b5\u30d6\u30cd\u30c3\u30c8\u30926\u3064\u4f5c\u6210\u3057\u307e\u3059\u3002 Public Subnet\u3068Private Subnet\u306e2\u7a2e\u985e\u3068\u3001ap-northeast-1\u30ea\u30fc\u30b8\u30e7\u30f3(\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3)\u306b\u5b58\u5728\u3059\u308b3\u3064\u306eAZ\u3078\u5404\u7a2e\u30ea\u30bd\u30fc\u30b9(EC2\u3084ECS\u3084RDS\u306a\u3069)\u3092\u914d\u7f6e\u3057\u305f\u3044\u305f\u3081\u30012*3\u3067\u8a086\u3064\u306e\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002 \u307e\u305a\u306f\u300c\"handson-public-1a\"\u3068\u3044\u3046\u547d\u540d\u3067ap-northeast-1a\u306bCIDR\u304c10.0.1.0/24\u306e\u30b5\u30d6\u30cd\u30c3\u30c8\u300d\u3092\u4f5c\u6210\u3057\u3066\u307f\u307e\u3057\u3087\u3046 # Subnet # https://www.terraform.io/docs/providers/aws/r/subnet.html resource \"aws_subnet\" \"public_1a\" { # \u5148\u7a0b\u4f5c\u6210\u3057\u305fVPC\u3092\u53c2\u7167\u3057\u3001\u305d\u306eVPC\u5185\u306bSubnet\u3092\u7acb\u3066\u308b vpc_id = \"${aws_vpc.main.id}\" # Subnet\u3092\u4f5c\u6210\u3059\u308bAZ availability_zone = \"ap-northeast-1a\" cidr_block = \"10.0.1.0/24\" tags = { Name = \"handson-public-1a\" } } plan\u3092\u5b9f\u884c\u3057\u3001Subnet\u304c\u4f5c\u6210\u3055\u308c\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046\u3002 # terraform plan Refreshing Terraform state in-memory prior to plan... The refreshed state will be used to calculate this plan, but will not be persisted to local or remote state storage. aws_vpc.main: Refreshing state... (ID: vpc-0396987ded1c4fd87) ------------------------------------------------------------------------ An execution plan has been generated and is shown below. Resource actions are indicated with the following symbols: + create Terraform will perform the following actions: + aws_subnet.public_1a id: <computed> arn: <computed> assign_ipv6_address_on_creation: \"false\" availability_zone: \"ap-northeast-1a\" availability_zone_id: <computed> cidr_block: \"10.0.1.0/24\" ipv6_cidr_block: <computed> ipv6_cidr_block_association_id: <computed> map_public_ip_on_launch: \"false\" owner_id: <computed> tags.%: \"1\" tags.Name: \"handson-public-1a\" vpc_id: \"vpc-0396987ded1c4fd87\" Plan: 1 to add, 0 to change, 0 to destroy. ------------------------------------------------------------------------ Note: You didn't specify an \"-out\" parameter to save this plan, so Terraform can't guarantee that exactly these actions will be performed if \"terraform apply\" is subsequently run. \u554f\u984c\u306a\u3051\u308c\u3070apply\u3092\u5b9f\u884c\u3057\u3066Subnet\u306e\u4f5c\u6210\u3092\u884c\u3044\u307e\u3059\u3002 # terraform apply : \u4ee5\u4e0b\u306e\u30b3\u30fc\u30c9\u3092\u8ffd\u8a18\u3057\u3066\u3001\u6b8b\u308a5\u3064\u306e\u30b5\u30d6\u30cd\u30c3\u30c8\u3082\u4f5c\u6210\u3057\u307e\u3059\u3002 \u30ea\u30bd\u30fc\u30b9\u540d\uff08e.g. \"publi_1c\", \"public_1d\"\uff09\u3068\u5404\u7a2e\u30d7\u30ed\u30d1\u30c6\u30a3\u304c\u5c11\u3057\u305a\u3064\u3053\u3068\u306a\u308b\u306e\u3067\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002 resource \"aws_subnet\" \"public_1c\" { vpc_id = \"${aws_vpc.main.id}\" availability_zone = \"ap-northeast-1c\" cidr_block = \"10.0.2.0/24\" tags = { Name = \"handson-public-1c\" } } resource \"aws_subnet\" \"public_1d\" { vpc_id = \"${aws_vpc.main.id}\" availability_zone = \"ap-northeast-1d\" cidr_block = \"10.0.3.0/24\" tags = { Name = \"handson-public-1d\" } } # Private Subnets resource \"aws_subnet\" \"private_1a\" { vpc_id = \"${aws_vpc.main.id}\" availability_zone = \"ap-northeast-1a\" cidr_block = \"10.0.10.0/24\" tags = { Name = \"handson-private-1a\" } } resource \"aws_subnet\" \"private_1c\" { vpc_id = \"${aws_vpc.main.id}\" availability_zone = \"ap-northeast-1c\" cidr_block = \"10.0.20.0/24\" tags = { Name = \"handson-private-1c\" } } resource \"aws_subnet\" \"private_1d\" { vpc_id = \"${aws_vpc.main.id}\" availability_zone = \"ap-northeast-1d\" cidr_block = \"10.0.30.0/24\" tags = { Name = \"handson-private-1d\" } } plan\u3092\u5b9f\u884c\u3057\u30015\u3064\u306e\u65b0\u3057\u3044\u30ea\u30bd\u30fc\u30b9\u304c\u8ffd\u52a0\u3055\u308c\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046\u3002 # terraform plan : Plan: 5 to add, 0 to change, 0 to destroy. \u554f\u984c\u306a\u3051\u308c\u3070apply\u3092\u5b9f\u884c\u3057\u3066Subnet\u306e\u4f5c\u6210\u3092\u884c\u3044\u307e\u3059\u3002 # terraform apply Web\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089Subnet\u304c6\u3064\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046\u3002 \u30b5\u30a4\u30c9\u30d0\u30fc\u306eVPC\u3067\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3067\u5148\u7a0bTerraform\u304b\u3089\u4f5c\u6210\u3057\u305f \"handson\" \u3068\u3044\u3046VPC\u3092\u9078\u629e\u3059\u308b\u3068\u5206\u304b\u308a\u3084\u3059\u3044\u3067\u3059\u3002 https://ap-northeast-1.console.aws.amazon.com/vpc/home?region=ap-northeast-1#subnets:sort=tag:Name","title":"Subnet"},{"location":"handson/vpc/#internet-gateway","text":"VPC\u304b\u3089\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u3078\u306e\u51fa\u5165\u308a\u53e3\u3068\u306a\u308bInternet Gateway\u3092\u4f5c\u6210\u3057\u307e\u3057\u3087\u3046\u3002 \u30b3\u30f3\u30bd\u30fc\u30eb\u4e0a\u304b\u3089\u4f5c\u6210\u3059\u308b\u3068Internet Gateway \u3068VPC\u306f\u81ea\u52d5\u3067\u7d10\u4ed8\u304d\u307e\u305b\u3093\u304c\u3001Terraform\u306e\u5834\u5408\u30d7\u30ed\u30d1\u30c6\u30a3\u3067VPC\u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u3067\u81ea\u52d5\u7684\u306b\u7d10\u3065\u3051\u3066\u304f\u308c\u307e\u3059\u3002 # Internet Gateway # https://www.terraform.io/docs/providers/aws/r/internet_gateway.html resource \"aws_internet_gateway\" \"main\" { vpc_id = \"${aws_vpc.main.id}\" tags = { Name = \"handson\" } } plan\u3092\u5b9f\u884c\u3057\u30011\u3064\u306e\u30ea\u30bd\u30fc\u30b9\u304c\u8ffd\u52a0\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002 # terraform plan Plan: 1 to add, 0 to change, 0 to destroy. \u554f\u984c\u306a\u3051\u308c\u3070apply\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002 # terraform apply","title":"Internet Gateway"},{"location":"handson/vpc/#nat-gateway","text":"\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\u304b\u3089\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u3078\u901a\u4fe1\u3059\u308b\u305f\u3081\u306bNAT Gateway\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002 NAT Gateway\u306f1\u3064\u306eElastic IP\u304c\u5fc5\u8981\u306a\u306e\u3067\u305d\u306e\u5272\u308a\u5f53\u3066\u3068\u3001AZ\u6bce\u306b\u5fc5\u8981\u306a\u306e\u30673\u3064\u4f5c\u6210\u3057\u307e\u3059\u3002 \u307e\u305a\u306fap-northeast-1a\u7528\u306eNAT Gateway\u30921\u3064\u4f5c\u6210\u3057\u3066\u307f\u307e\u3057\u3087\u3046 # Elasti IP # https://www.terraform.io/docs/providers/aws/r/eip.html resource \"aws_eip\" \"nat_1a\" { vpc = true tags = { Name = \"handson-natgw-1a\" } } # NAT Gateway # https://www.terraform.io/docs/providers/aws/r/nat_gateway.html resource \"aws_nat_gateway\" \"nat_1a\" { subnet_id = \"${aws_subnet.public_1a.id}\" # NAT Gateway\u3092\u914d\u7f6e\u3059\u308bSubnet\u3092\u6307\u5b9a allocation_id = \"${aws_eip.nat_1a.id}\" # \u7d10\u4ed8\u3051\u308bElasti IP tags = { Name = \"handson-1a\" } } plan\u3067\u5909\u66f4\u78ba\u8a8d\u3092\u884c\u3044\u307e\u3059\u3002 # terraform plan Refreshing Terraform state in-memory prior to plan... The refreshed state will be used to calculate this plan, but will not be persisted to local or remote state storage. aws_vpc.main: Refreshing state... (ID: vpc-0396987ded1c4fd87) aws_subnet.public_1d: Refreshing state... (ID: subnet-0f8eb38d6429200be) aws_internet_gateway.main: Refreshing state... (ID: igw-0e46a72941683c00f) aws_subnet.private_1a: Refreshing state... (ID: subnet-0b4e88abdc1cf586a) aws_subnet.private_1d: Refreshing state... (ID: subnet-0910f1d541d1ad52d) aws_subnet.private_1c: Refreshing state... (ID: subnet-01e1173f6b8ed56d5) aws_subnet.public_1c: Refreshing state... (ID: subnet-0519598224db34049) aws_subnet.public_1a: Refreshing state... (ID: subnet-08b90fd31e5d8dec4) ------------------------------------------------------------------------ An execution plan has been generated and is shown below. Resource actions are indicated with the following symbols: + create Terraform will perform the following actions: + aws_eip.nat_1a id: <computed> allocation_id: <computed> association_id: <computed> domain: <computed> instance: <computed> network_interface: <computed> private_dns: <computed> private_ip: <computed> public_dns: <computed> public_ip: <computed> public_ipv4_pool: <computed> tags.%: \"1\" tags.Name: \"handson-natgw-1a\" vpc: \"true\" + aws_nat_gateway.nat_1a id: <computed> allocation_id: \"${aws_eip.nat_1a.id}\" network_interface_id: <computed> private_ip: <computed> public_ip: <computed> subnet_id: \"subnet-08b90fd31e5d8dec4\" Plan: 2 to add, 0 to change, 0 to destroy. ------------------------------------------------------------------------ Note: You didn't specify an \"-out\" parameter to save this plan, so Terraform can't guarantee that exactly these actions will be performed if \"terraform apply\" is subsequently run. Elastic IP \u3068NAT Gateway \u306e2\u3064\u304c\u4f5c\u6210\u3055\u308c\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3057\u305f\u3002 apply\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002 # terraform apply \u6b8b\u308a2\u3064\u306eNAT Gateway\u3082\u4f5c\u6210\u3057\u3066\u9069\u7528\u3057\u307e\u3057\u3087\u3046 resource \"aws_eip\" \"nat_1c\" { vpc = true tags = { Name = \"handson-natgw-1c\" } } resource \"aws_nat_gateway\" \"nat_1c\" { subnet_id = \"${aws_subnet.public_1c.id}\" allocation_id = \"${aws_eip.nat_1c.id}\" tags = { Name = \"handson-1c\" } } resource \"aws_eip\" \"nat_1d\" { vpc = true tags = { Name = \"handson-natgw-1d\" } } resource \"aws_nat_gateway\" \"nat_1d\" { subnet_id = \"${aws_subnet.public_1d.id}\" allocation_id = \"${aws_eip.nat_1d.id}\" tags = { Name = \"handson-1d\" } } # terraform plan : Plan: 6 to add, 0 to change, 0 to destroy. : # terraform apply :","title":"NAT Gateway"},{"location":"handson/vpc/#route-table","text":"\u6700\u5f8c\u306b\u3001\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u3092\u758e\u901a\u3055\u305b\u308b\u305f\u3081\u306e\u7d4c\u8def\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002 Internet Gateway\u3092\u4f7f\u7528\u3057\u3066\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u3078\u758e\u901a\u3059\u308b\u305f\u3081\u306eRoute Table/Routes \u3068 NAT Gateway\u3092\u7d4c\u7531\u3057\u3066\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u3078\u758e\u901a\u3059\u308b\u305f\u3081\u306eRoute Table/Routes \u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002 Subnet\u306e\u547c\u3073\u5206\u3051 Internet Gateway\u3068\u76f4\u63a5\u7684\u306a\u7d4c\u8def\u304c\u5b58\u5728\u3059\u308bSubnet\u3092\"Public Subnet\"\u3068\u547c\u3073\u3001 \u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u3078\u306e\u7d4c\u8def\u304c\u5b58\u5728\u3057\u306a\u3044\u30fbNAT Gateway\u3092\u4f7f\u7528\u3057\u3066\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u3078\u63a5\u7d9a\u3057\u3066\u3044\u308bSubnet\u3092\"Private Subnet\" \u3068\u547c\u3073\u307e\u3059 \u307e\u305a\u306fInternet Gateway\u3068Subnet\u306e\u7d4c\u8def\u3092\u4f5c\u6210\u3057\u307e\u3057\u3087\u3046\u3002 \u5c11\u3057\u591a\u3044\u306e\u3067\u89e3\u8aac\u3059\u308b\u3068\u3001\u4f5c\u6210\u3059\u308b\u306e\u306f\u4ee5\u4e0b\u306e3\u7a2e\u985e\u306e\u30ea\u30bd\u30fc\u30b9\u3067\u3059\u3002 \"aws_route_table\" \u7d4c\u8def\u60c5\u5831\u306e\u683c\u7d0d \"aws_route\" Route Table\u3078\u7d4c\u8def\u60c5\u5831\u3092\u8ffd\u52a0 \u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8(0.0.0.0/0)\u3078\u63a5\u7d9a\u3059\u308b\u969b\u306fInternet Gateway\u3092\u4f7f\u7528\u3059\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3059\u308b \"aws_route_table_association\" Route Table\u3068Subnet\u306e\u7d10\u3065\u3051 # Route Table # https://www.terraform.io/docs/providers/aws/r/route_table.html resource \"aws_route_table\" \"public\" { vpc_id = \"${aws_vpc.main.id}\" tags = { Name = \"handson-public\" } } # Route # https://www.terraform.io/docs/providers/aws/r/route.html resource \"aws_route\" \"public\" { destination_cidr_block = \"0.0.0.0/0\" route_table_id = \"${aws_route_table.public.id}\" gateway_id = \"${aws_internet_gateway.main.id}\" } # Association # https://www.terraform.io/docs/providers/aws/r/route_table_association.html resource \"aws_route_table_association\" \"public_1a\" { subnet_id = \"${aws_subnet.public_1a.id}\" route_table_id = \"${aws_route_table.public.id}\" } resource \"aws_route_table_association\" \"public_1c\" { subnet_id = \"${aws_subnet.public_1c.id}\" route_table_id = \"${aws_route_table.public.id}\" } resource \"aws_route_table_association\" \"public_1d\" { subnet_id = \"${aws_subnet.public_1d.id}\" route_table_id = \"${aws_route_table.public.id}\" } # terraform plan : Plan: 5 to add, 0 to change, 0 to destroy. : # terraform apply : NAT Gateway\u3068Subnet\u306e\u7d4c\u8def\u3092\u4f5c\u6210\u3057\u307e\u3057\u3087\u3046\u3002 Internet Gateway \u3068\u306e\u9055\u3044\u3068\u3057\u3066\u306f\u5404AZ\u306bNAT Gateway \u304c\u5fc5\u8981\u306b\u306a\u308b\u70b9\u3067\u3059\u3002 # Route Table (Private) # https://www.terraform.io/docs/providers/aws/r/route_table.html resource \"aws_route_table\" \"private_1a\" { vpc_id = \"${aws_vpc.main.id}\" tags = { Name = \"handson-private-1a\" } } resource \"aws_route_table\" \"private_1c\" { vpc_id = \"${aws_vpc.main.id}\" tags = { Name = \"handson-private-1c\" } } resource \"aws_route_table\" \"private_1d\" { vpc_id = \"${aws_vpc.main.id}\" tags = { Name = \"handson-private-1d\" } } # Route (Private) # https://www.terraform.io/docs/providers/aws/r/route.html resource \"aws_route\" \"private_1a\" { destination_cidr_block = \"0.0.0.0/0\" route_table_id = \"${aws_route_table.private_1a.id}\" nat_gateway_id = \"${aws_nat_gateway.nat_1a.id}\" } resource \"aws_route\" \"private_1c\" { destination_cidr_block = \"0.0.0.0/0\" route_table_id = \"${aws_route_table.private_1c.id}\" nat_gateway_id = \"${aws_nat_gateway.nat_1c.id}\" } resource \"aws_route\" \"private_1d\" { destination_cidr_block = \"0.0.0.0/0\" route_table_id = \"${aws_route_table.private_1d.id}\" nat_gateway_id = \"${aws_nat_gateway.nat_1d.id}\" } # Association (Private) # https://www.terraform.io/docs/providers/aws/r/route_table_association.html resource \"aws_route_table_association\" \"private_1a\" { subnet_id = \"${aws_subnet.private_1a.id}\" route_table_id = \"${aws_route_table.private_1a.id}\" } resource \"aws_route_table_association\" \"private_1c\" { subnet_id = \"${aws_subnet.private_1c.id}\" route_table_id = \"${aws_route_table.private_1c.id}\" } resource \"aws_route_table_association\" \"private_1d\" { subnet_id = \"${aws_subnet.private_1d.id}\" route_table_id = \"${aws_route_table.private_1d.id}\" } # terraform plan : Plan: 9 to add, 0 to change, 0 to destroy. : # terraform apply : \u7d4c\u8def\u8a2d\u5b9a\u304c\u884c\u3048\u3066\u3044\u308b\u304bWeb\u30b3\u30f3\u30bd\u30fc\u30eb\u4e0a\u304b\u3089\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002 \u78ba\u8a8d\u30dd\u30a4\u30f3\u30c8 \"handson-\" \u3068\u3044\u3046\u540d\u524d\u304b\u3089\u306f\u3058\u307e\u308bRoute Table\u304c4\u3064\u3042\u308b\u304b \"handson-public\" \u306b3\u3064Subnet\u304c\u767b\u9332\u3055\u308c\u3066\u3044\u308b\u304b \"handson-public\" \u306b\u767b\u9332\u3055\u308c\u3066\u3044\u308bSubnet\u306fPublic Subnet\u306e\u547d\u540d\u306b\u306a\u3063\u3066\u3044\u308b\u304b \"handson-public\" \u306e0.0.0.0\u3078\u306e\u7d4c\u8def\u306fInternet Gateway\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\u304b \"handson-private-*\" \u306f3\u3064\u5b58\u5728\u3057\u3001\u305d\u308c\u305e\u308c1\u3064\u305a\u3064Subnet\u3092\u6301\u3063\u3066\u3044\u308b\u304b \"handson-private-*\" \u306f0.0.0.0\u3078\u306e\u7d4c\u8def\u306fNAT Gateway\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\u304b https://ap-northeast-1.console.aws.amazon.com/vpc/home?region=ap-northeast-1#RouteTables:sort=routeTableId \u3053\u3053\u307e\u3067\u3067\u57fa\u790e\u3068\u306a\u308b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30ea\u30bd\u30fc\u30b9\u306e\u4f5c\u6210\u306f\u5b8c\u4e86\u3067\u3059\uff01","title":"Route Table"},{"location":"laravel/about/","text":"\u3053\u3053\u307e\u3067\u306fTerraform\u306b\u6163\u308c\u308b\u3053\u3068\u3092\u76ee\u7684\u306b\u30cf\u30f3\u30ba\u30aa\u30f3\u3092\u884c\u3044\u307e\u3057\u305f\u3002 \u3053\u3053\u304b\u3089\u306fPHP\u306e\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af \"Laravel\" \u3092\u4f7f\u7528\u3057\u3001\u5b9f\u969b\u306bECS\u3068RDS\u3092\u4f7f\u7528\u3057\u3066\u69cb\u7bc9\u3057\u307e\u3059\u3002 \u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u306f\u4ee5\u4e0b\u306b\u3042\u308b\u306e\u3067\u3001\u3064\u307e\u3063\u305f\u3089\u898b\u3066\u304f\u3060\u3055\u3044\u3002 $ git clone https://github.com/y-ohgi/introduction-terraform-example \u6e96\u5099 \u00b6 \u30b7\u30f3\u30bf\u30c3\u30af\u30b9\u306e\u6d3b\u7528 \u3067\u4f8b\u306b\u4e0a\u3052\u305f\u30b3\u30fc\u30c9\u3092\u8ffd\u52a0\u3059\u308b\u5f62\u3067\u52e7\u3081\u307e\u3059\u3002 \u4f5c\u696d\u7528\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u3001\u30b3\u30d4\u30fc\u3059\u308b\u3068\u3053\u308d\u304b\u3089\u521d\u3081\u307e\u3057\u3087\u3046\u3002 $ cd ~/Desktop/ $ git clone https://github.com/y-ohgi/introduction-terraform $ mkdir laravel $ cp -R introduction-terraform/handson/syntax laravel/terraform $ cd laravel $ ls terraform $ cd terraform $ vi main.tf # variable\u3067\u5b9a\u7fa9\u3057\u3066\u3044\u308b\u30c9\u30e1\u30a4\u30f3\u540d\u306e\u4fee\u6b63 $ terraform init $ terraform apply \u72ec\u81ea\u30c9\u30e1\u30a4\u30f3\u3067nginx\u306e\u753b\u9762\u304c\u898b\u308c\u308c\u3070\u6210\u529f\u3067\u3059\u3002 \u4eca\u56de\u306fnginx\u3092\u4f7f\u7528\u3057\u306a\u3044\u306e\u3067\u3001\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3057\u307e\u3057\u3087\u3046\u3002","title":"\u6982\u8981"},{"location":"laravel/about/#_1","text":"\u30b7\u30f3\u30bf\u30c3\u30af\u30b9\u306e\u6d3b\u7528 \u3067\u4f8b\u306b\u4e0a\u3052\u305f\u30b3\u30fc\u30c9\u3092\u8ffd\u52a0\u3059\u308b\u5f62\u3067\u52e7\u3081\u307e\u3059\u3002 \u4f5c\u696d\u7528\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u3001\u30b3\u30d4\u30fc\u3059\u308b\u3068\u3053\u308d\u304b\u3089\u521d\u3081\u307e\u3057\u3087\u3046\u3002 $ cd ~/Desktop/ $ git clone https://github.com/y-ohgi/introduction-terraform $ mkdir laravel $ cp -R introduction-terraform/handson/syntax laravel/terraform $ cd laravel $ ls terraform $ cd terraform $ vi main.tf # variable\u3067\u5b9a\u7fa9\u3057\u3066\u3044\u308b\u30c9\u30e1\u30a4\u30f3\u540d\u306e\u4fee\u6b63 $ terraform init $ terraform apply \u72ec\u81ea\u30c9\u30e1\u30a4\u30f3\u3067nginx\u306e\u753b\u9762\u304c\u898b\u308c\u308c\u3070\u6210\u529f\u3067\u3059\u3002 \u4eca\u56de\u306fnginx\u3092\u4f7f\u7528\u3057\u306a\u3044\u306e\u3067\u3001\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3057\u307e\u3057\u3087\u3046\u3002","title":"\u6e96\u5099"},{"location":"laravel/cleanup/","text":"$ terraform destroy","title":"\u7247\u4ed8\u3051"},{"location":"laravel/docker-compose/","text":"\u6982\u8981 \u00b6 \u3053\u306e\u30cf\u30f3\u30ba\u30aa\u30f3\u3067\u306fLaravel\u3092ECS\u4e0a\u3067\u52d5\u304b\u3057\u307e\u3059\u3002 \u305d\u306e\u524d\u306b\u4eca\u56de\u7acb\u3061\u4e0a\u3052\u308bLaravel\u3092docker-compose\u3092\u4f7f\u7528\u3057\u3066\u30ed\u30fc\u30ab\u30eb\u74b0\u5883\u3092\u7acb\u3061\u4e0a\u3052\u3066\u307f\u307e\u3057\u3087\u3046\u3002 \u6e96\u5099 \u00b6 \u5148\u7a0b\u4f5c\u6210\u3057\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3078\u5165\u308a\u3001Laravel\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u521d\u671f\u5316\u3092\u884c\u3044\u307e\u3059\u3002 $ cd ~/Desktop/laravel $ docker run -v ` pwd ` :/app -w /app composer create-project --prefer-dist laravel/laravel laravel $ ls laravel terraform Docker\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u6e96\u5099 \u00b6 docker-compose\u3092\u7acb\u3061\u4e0a\u3052\u308b\u305f\u3081\u306b\u3001Laravel\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306edockerize\u3092\u3057\u307e\u3059\u3002 \u307e\u305a\u306flaravel\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u5b58\u5728\u3059\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046 $ cd laravel $ ls app bootstrap composer.lock database phpunit.xml readme.md routes storage vendor artisan composer.json config package.json public resources server.php tests webpack.mix.js Laravel\u3092\u8d77\u52d5\u3059\u308b\u305f\u3081\u306b\u4eca\u56de\u306fnginx\u3082\u4f7f\u7528\u3057\u307e\u3059\u3002 nginx\u3068Laravel\u306eDocker\u7528\u30d5\u30a1\u30a4\u30eb\u3092\u7528\u610f\u3057\u3066\u3044\u304d\u307e\u3057\u3087\u3046 Laravel \u00b6 \u307e\u305a\u306fLaravel\u306e\u8a2d\u5b9a\u304b\u3089\u884c\u3044\u307e\u3057\u3087\u3046\u3002 $ vi Dockerfile FROM php:7.2-fpm-alpine ARG UID = 991 ARG UNAME = www ARG GID = 991 ARG GNAME = www ENV WORKDIR = /var/www/html WORKDIR $WORKDIR COPY ./docker/php/php.ini /usr/local/etc/php COPY composer.json composer.lock ${ WORKDIR } / RUN set -x \\ && apk add --no-cache git php7-zlib zlib-dev \\ && docker-php-ext-install pdo_mysql zip \\ && curl -sS https://getcomposer.org/installer | php -- --install-dir = /usr/local/bin --filename = composer \\ && composer install --no-autoloader --no-progress --no-dev COPY . . RUN set -x \\ && composer install --no-progress --no-dev \\ && php artisan config:clear \\ && addgroup ${ GNAME } -g ${ GID } \\ && adduser -D -G ${ GNAME } -u ${ UID } ${ UNAME } \\ && chown -R ${ UNAME } : ${ GNAME } ${ WORKDIR } \\ && mv /root/.composer /home/ ${ UNAME } / \\ && chown -R ${ UNAME } : ${ GNAME } /home/ ${ UNAME } USER ${UNAME} PHP\u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\u306fPHP\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb php.ini \u304c\u6b32\u3057\u3044\u305f\u3081\u3001\u305d\u306e\u4f5c\u6210\u3092\u884c\u3044\u307e\u3059\u3002 $ mkdir -p docker/php/php.ini $ vi docker/php/php.ini [php] expose_php = Off default_charset = \"UTF-8\" max_execution_time = 30 memory_limit = 128M file_uploads = On upload_max_filesize = 5M post_max_size = 5M laravel\u81ea\u4f53\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002 \u30cf\u30f3\u30ba\u30aa\u30f3\u306e\u7c21\u6613\u5316\u306e\u305f\u3081\u306bdocker-compose\u3067 .env \u3067\u306f\u306a\u304f .env.example \u304b\u3089\u74b0\u5883\u5909\u6570\u306e\u8a2d\u5b9a\u3092\u8aad\u307f\u8fbc\u307f\u307e\u3059\u3002\u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u3067\u306f\u53b3\u5bc6\u306b\u7ba1\u7406\u3057\u305f\u307b\u3046\u304c\u826f\u3044\u3067\u3057\u3087\u3046\u3002 \u74b0\u5883\u5909\u6570\u304b\u3089\u4e0d\u8981\u306a\u8a2d\u5b9a\u3092\u5916\u3057\u3001\u30ed\u30fc\u30ab\u30eb\u3067Laravel\u304b\u3089MySQL\u3078\u306e\u63a5\u7d9a\u8a2d\u5b9a\u3092\u3057\u307e\u3059\u3002 $ vi .env.example APP_NAME=handson APP_ENV=local APP_KEY= APP_KEY=base64:p5Fu8gRUOuPUXzY3VcxpnYsUR9f2h8nTSm5JlYkzPTM= APP_DEBUG=true APP_URL=http://localhost LOG_CHANNEL=stderr DB_CONNECTION=mysql DB_HOST=mysql DB_DATABASE=app DB_USERNAME=root DB_PASSWORD= \u3053\u3053\u307e\u3067\u3067Laravel\u306e\u8a2d\u5b9a\u306f\u7d42\u308f\u308a\u3067\u3059\u3002 nginx \u00b6 \u5f93\u6765\u306e\u30db\u30b9\u30c8\u4e0a\u3067\u74b0\u5883\u69cb\u7bc9\u3092\u3059\u308b\u5834\u5408nginx\u3092\u7acb\u3066\u308b\u306e\u306f\u7169\u308f\u3057\u3044\u3060\u3051\u3067\u3057\u305f\u304c\u3001docker\u306e\u304a\u304b\u3052\u3067\u7c21\u5358\u306b\u7acb\u3061\u4e0a\u3052\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002 \u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u74b0\u5883\u3068\u306e\u969b\u3092\u5c0f\u3055\u304f\u3059\u308b\u305f\u3081\u306b\u3082\u3001\u30ed\u30fc\u30ab\u30eb\u3067\u3082nginx\u3092\u7acb\u3066\u3066\u3057\u307e\u3044\u307e\u3057\u3087\u3046\u3002 nginx\u306b\u304d\u305f\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u3092php\u3078\u6e21\u3059\u8a2d\u5b9a\u3092\u66f8\u304d\u307e\u3059\u3002 $ mkdir docker/nginx $ vi docker/nginx/default.conf.template server { listen 80 ; add_header X-Frame-Options \"SAMEORIGIN\" ; add_header X-XSS-Protection \"1 ; mode=block\" ; add_header X-Content-Type-Options \"nosniff\" ; root /var/www/html/public/ ; charset utf-8 ; location = /favicon.ico { access_log off ; log_not_found off ; } location = /robots.txt { access_log off ; log_not_found off ; } location / { try_files $uri /index.php? $query_string ; } location ~ [^/]\\.php(/|$) { fastcgi_pass ${PHP_HOST}:9000 ; fastcgi_split_path_info ^(.+?\\.php)(/.*) $ ; fastcgi_index index.php ; fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name ; fastcgi_param PATH_INFO $fastcgi_path_info ; fastcgi_param REQUEST_FILENAME $request_filename ; include fastcgi_params ; } } nginx\u7528Dockerfile\u306e\u8a18\u8f09\u3092\u884c\u3044\u307e\u3059\u3002 FROM nginx:1.15-alpine COPY public /var/www/html/public COPY docker/nginx/default.conf.template /etc/nginx/conf.d/default.conf.template ENV PHP_HOST = 127 .0.0.1 EXPOSE 80 CMD /bin/sh -c 'sed \"s/\\${PHP_HOST}/${PHP_HOST}/\" /etc/nginx/conf.d/default.conf.template > /etc/nginx/conf.d/default.conf && nginx -g \"daemon off;\"' nginx\u306f1\u70b9\u30dd\u30a4\u30f3\u30c8\u304c\u3042\u308a\u307e\u3059\u3002 \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30c9\u30e9\u30a4\u30d0\u306b\u3088\u3063\u3066DNS\u7d4c\u7531\u304b\u3089\u30ed\u30fc\u30ab\u30eb\u30db\u30b9\u30c8\u7d4c\u7531\u304b\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u304c\u7570\u306a\u308b\u305f\u3081\u3001 default.conf.template \u3067 ${PHP_HOST} \u3067\u4e00\u65e6\u5909\u6570(?)\u306b\u3057\u307e\u3059\u3002 fastcgi_pass ${PHP_HOST}:9000; \u305d\u3057\u3066Docker\u8d77\u52d5\u6642\u306b sed \u3067\u66f8\u304d\u63db\u3048\u307e\u3059\u3002 \u30c7\u30d5\u30a9\u30eb\u30c8\u306fDockerfile\u5185\u306e ENV PHP_HOST=127.0.0.1 \u306b\u3066 127.0.0.1 \u3092\u6307\u5b9a\u3057\u3066\u30ed\u30fc\u30ab\u30eb\u30db\u30b9\u30c8\u306b\u3057\u3066\u3044\u307e\u3059\u3002 CMD /bin/sh -c 'sed \"s/\\${PHP_HOST}/${PHP_HOST}/\" /etc/nginx/conf.d/default.conf.template > /etc/nginx/conf.d/default.conf && nginx -g \"daemon off;\"' \u6570\u304c\u591a\u3044\u5834\u5408 envsubst \u30b3\u30de\u30f3\u30c9\u3067\u3082\u826f\u3044\u306e\u3067\u3059\u304c\u30011\u7b87\u6240\u66f8\u304d\u63db\u3048\u308b\u3060\u3051\u306a\u3089\u30b7\u30f3\u30d7\u30eb\u306b sed \u306e\u65b9\u304c\u5206\u304b\u308a\u3084\u3059\u3044\u3067\u3057\u3087\u3046\u3002 \u3053\u3053\u307e\u3067\u3067docker\u306e\u8a2d\u5b9a\u306f\u5b8c\u4e86\u3067\u3059\u3002 docker-compose \u00b6 \u5148\u307b\u3069\u4f5c\u6210\u3057\u305fDockerfile\u3068\u5404\u7a2e\u8a2d\u5b9a\u3092\u8aad\u307f\u8fbc\u3080docker-compose\u306e\u8a2d\u5b9a\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002 $ vi docker-compose.yaml version : '3.7' services : nginx : build : context : . dockerfile : docker/nginx/Dockerfile volumes : - ./public:/var/www/html/public:ro ports : - 8001:80 environment : PHP_HOST : app app : build : . env_file : - .env.example volumes : - .:/var/www/html:cached mysql : image : mysql:5.7 volumes : - ./mysql:/var/lib/mysql:delegated command : mysqld --character-set-server=utf8mb4 --collation-server=utf8mb4_general_ci environment : MYSQL_ALLOW_EMPTY_PASSWORD : 'yes' MYSQL_DATABASE : 'app' ports : - 3306 \u8a18\u8ff0\u3057\u304a\u308f\u3063\u305f\u3089\u8d77\u52d5\u3057\u3001\u52d5\u4f5c\u78ba\u8a8d\u3092\u3057\u307e\u3059\u3002 $ docker-compose up http://localhost:8001 Laravel\u306e\u30a6\u30a7\u30eb\u30ab\u30e0\u30da\u30fc\u30b8\u304c\u8868\u793a\u3055\u308c\u308c\u3070\u6210\u529f\u3067\u3059\uff01 MySQL\u3092\u4f7f\u7528\u3059\u308b \u00b6 \u3053\u3053\u304b\u3089\u306fLaravel\u3068MySQL\u3092\u9023\u643a\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002 migrate\u306e\u5b9f\u884c \u00b6 \u8d77\u52d5\u3057\u3066\u3044\u308bdocker-compose\u3092\u305d\u306e\u307e\u307e\u306b\u3001\u5225\u306e\u30bf\u30fc\u30df\u30ca\u30eb\u3092\u958b\u3044\u3066\u64cd\u4f5c\u3057\u307e\u3059\u3002 \u307e\u305a\u306fmigrate\u306e\u5b9f\u884c\u3092\u884c\u3044\u307e\u3059\u3002 \u65e2\u306b\u8d77\u52d5\u3057\u3066\u3044\u308bDocker\u30b3\u30f3\u30c6\u30ca\u306e\u4e2d\u3067 php \u30b3\u30de\u30f3\u30c9\u3092\u6253\u3063\u3066migrate\u3092\u884c\u3044\u307e\u3059\u3002 $ cd /path/to/introduction-terraform-example/laravel $ docker-compose exec app php artisan migrate API\u306e\u52d5\u4f5c\u78ba\u8a8d \u00b6 \u307e\u305a\u306f /api/books \u306e\u30d1\u30b9\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u3001\u4f55\u3082\u5e30\u3063\u3066\u3053\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002 $ curl localhost:8001/api/books [] \u4f55\u56de\u304bPOST\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9001\u3063\u3066\u3001\u30c7\u30fc\u30bf\u3092\u5897\u3084\u3057\u3066\u307f\u307e\u3059\u3002 $ curl -X POST localhost:8001/api/books { \"title\": \"Ramiro Bernhard\", \"updated_at\": \"2019-03-20 04:59:05\", \"created_at\": \"2019-03-20 04:59:05\", \"id\": 1 } $ curl -X POST localhost:8001/api/books { \"title\": \"Ramiro Bernhard\", \"updated_at\": \"2019-03-20 04:59:05\", \"created_at\": \"2019-03-20 04:59:05\", \"id\": 2 } : \u6700\u5f8c\u306b /api/books \u3078GET\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9001\u308a\u3001MySQL\u3078\u30c7\u30fc\u30bf\u304c\u683c\u7d0d\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002 $ curl localhost:8001/api/books [ { \"id\": 1, \"title\": \"Ramiro Bernhard\", \"created_at\": \"2019-03-20 04:59:05\", \"updated_at\": \"2019-03-20 04:59:05\" }, { \"id\": 2, \"title\": \"Mr. Ford Nitzsche\", \"created_at\": \"2019-03-20 05:00:36\", \"updated_at\": \"2019-03-20 05:00:36\" } ] MySQL\u306e\u4e2d\u306b\u5165\u3063\u3066\u307f\u308b \u00b6 Docker\u30b3\u30f3\u30c6\u30ca\u4e0a\u3067\u52d5\u304b\u3057\u3066\u3044\u308bMySQL\u3078\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u307f\u307e\u3059\u3002 $ docker-compose exec mysql mysql Your MySQL connection id is 8 Server version: 5.7.25 MySQL Community Server (GPL) Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> MySQL\u306e\u516c\u5f0fDocker Image \u306f\u74b0\u5883\u5909\u6570\u3067\u5b9a\u7fa9\u3057\u305f app \u3068\u3044\u3046\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002 MySQL\u30b3\u30f3\u30c6\u30ca\u306e\u4e2d\u306b\u5165\u308a\u3001 app \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u30c6\u30fc\u30d6\u30eb\u3092\u4e00\u89a7\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002 mysql> use mysql Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> show tables; +-----------------+ | Tables_in_app | +-----------------+ | books | | migrations | | password_resets | | users | +-----------------+ 4 rows in set (0.00 sec)","title":"docker-compose\u306e\u8d77\u52d5"},{"location":"laravel/docker-compose/#_1","text":"\u3053\u306e\u30cf\u30f3\u30ba\u30aa\u30f3\u3067\u306fLaravel\u3092ECS\u4e0a\u3067\u52d5\u304b\u3057\u307e\u3059\u3002 \u305d\u306e\u524d\u306b\u4eca\u56de\u7acb\u3061\u4e0a\u3052\u308bLaravel\u3092docker-compose\u3092\u4f7f\u7528\u3057\u3066\u30ed\u30fc\u30ab\u30eb\u74b0\u5883\u3092\u7acb\u3061\u4e0a\u3052\u3066\u307f\u307e\u3057\u3087\u3046\u3002","title":"\u6982\u8981"},{"location":"laravel/docker-compose/#_2","text":"\u5148\u7a0b\u4f5c\u6210\u3057\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3078\u5165\u308a\u3001Laravel\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u521d\u671f\u5316\u3092\u884c\u3044\u307e\u3059\u3002 $ cd ~/Desktop/laravel $ docker run -v ` pwd ` :/app -w /app composer create-project --prefer-dist laravel/laravel laravel $ ls laravel terraform","title":"\u6e96\u5099"},{"location":"laravel/docker-compose/#docker","text":"docker-compose\u3092\u7acb\u3061\u4e0a\u3052\u308b\u305f\u3081\u306b\u3001Laravel\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306edockerize\u3092\u3057\u307e\u3059\u3002 \u307e\u305a\u306flaravel\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u5b58\u5728\u3059\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046 $ cd laravel $ ls app bootstrap composer.lock database phpunit.xml readme.md routes storage vendor artisan composer.json config package.json public resources server.php tests webpack.mix.js Laravel\u3092\u8d77\u52d5\u3059\u308b\u305f\u3081\u306b\u4eca\u56de\u306fnginx\u3082\u4f7f\u7528\u3057\u307e\u3059\u3002 nginx\u3068Laravel\u306eDocker\u7528\u30d5\u30a1\u30a4\u30eb\u3092\u7528\u610f\u3057\u3066\u3044\u304d\u307e\u3057\u3087\u3046","title":"Docker\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u6e96\u5099"},{"location":"laravel/docker-compose/#laravel","text":"\u307e\u305a\u306fLaravel\u306e\u8a2d\u5b9a\u304b\u3089\u884c\u3044\u307e\u3057\u3087\u3046\u3002 $ vi Dockerfile FROM php:7.2-fpm-alpine ARG UID = 991 ARG UNAME = www ARG GID = 991 ARG GNAME = www ENV WORKDIR = /var/www/html WORKDIR $WORKDIR COPY ./docker/php/php.ini /usr/local/etc/php COPY composer.json composer.lock ${ WORKDIR } / RUN set -x \\ && apk add --no-cache git php7-zlib zlib-dev \\ && docker-php-ext-install pdo_mysql zip \\ && curl -sS https://getcomposer.org/installer | php -- --install-dir = /usr/local/bin --filename = composer \\ && composer install --no-autoloader --no-progress --no-dev COPY . . RUN set -x \\ && composer install --no-progress --no-dev \\ && php artisan config:clear \\ && addgroup ${ GNAME } -g ${ GID } \\ && adduser -D -G ${ GNAME } -u ${ UID } ${ UNAME } \\ && chown -R ${ UNAME } : ${ GNAME } ${ WORKDIR } \\ && mv /root/.composer /home/ ${ UNAME } / \\ && chown -R ${ UNAME } : ${ GNAME } /home/ ${ UNAME } USER ${UNAME} PHP\u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\u306fPHP\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb php.ini \u304c\u6b32\u3057\u3044\u305f\u3081\u3001\u305d\u306e\u4f5c\u6210\u3092\u884c\u3044\u307e\u3059\u3002 $ mkdir -p docker/php/php.ini $ vi docker/php/php.ini [php] expose_php = Off default_charset = \"UTF-8\" max_execution_time = 30 memory_limit = 128M file_uploads = On upload_max_filesize = 5M post_max_size = 5M laravel\u81ea\u4f53\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002 \u30cf\u30f3\u30ba\u30aa\u30f3\u306e\u7c21\u6613\u5316\u306e\u305f\u3081\u306bdocker-compose\u3067 .env \u3067\u306f\u306a\u304f .env.example \u304b\u3089\u74b0\u5883\u5909\u6570\u306e\u8a2d\u5b9a\u3092\u8aad\u307f\u8fbc\u307f\u307e\u3059\u3002\u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u3067\u306f\u53b3\u5bc6\u306b\u7ba1\u7406\u3057\u305f\u307b\u3046\u304c\u826f\u3044\u3067\u3057\u3087\u3046\u3002 \u74b0\u5883\u5909\u6570\u304b\u3089\u4e0d\u8981\u306a\u8a2d\u5b9a\u3092\u5916\u3057\u3001\u30ed\u30fc\u30ab\u30eb\u3067Laravel\u304b\u3089MySQL\u3078\u306e\u63a5\u7d9a\u8a2d\u5b9a\u3092\u3057\u307e\u3059\u3002 $ vi .env.example APP_NAME=handson APP_ENV=local APP_KEY= APP_KEY=base64:p5Fu8gRUOuPUXzY3VcxpnYsUR9f2h8nTSm5JlYkzPTM= APP_DEBUG=true APP_URL=http://localhost LOG_CHANNEL=stderr DB_CONNECTION=mysql DB_HOST=mysql DB_DATABASE=app DB_USERNAME=root DB_PASSWORD= \u3053\u3053\u307e\u3067\u3067Laravel\u306e\u8a2d\u5b9a\u306f\u7d42\u308f\u308a\u3067\u3059\u3002","title":"Laravel"},{"location":"laravel/docker-compose/#nginx","text":"\u5f93\u6765\u306e\u30db\u30b9\u30c8\u4e0a\u3067\u74b0\u5883\u69cb\u7bc9\u3092\u3059\u308b\u5834\u5408nginx\u3092\u7acb\u3066\u308b\u306e\u306f\u7169\u308f\u3057\u3044\u3060\u3051\u3067\u3057\u305f\u304c\u3001docker\u306e\u304a\u304b\u3052\u3067\u7c21\u5358\u306b\u7acb\u3061\u4e0a\u3052\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002 \u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u74b0\u5883\u3068\u306e\u969b\u3092\u5c0f\u3055\u304f\u3059\u308b\u305f\u3081\u306b\u3082\u3001\u30ed\u30fc\u30ab\u30eb\u3067\u3082nginx\u3092\u7acb\u3066\u3066\u3057\u307e\u3044\u307e\u3057\u3087\u3046\u3002 nginx\u306b\u304d\u305f\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u3092php\u3078\u6e21\u3059\u8a2d\u5b9a\u3092\u66f8\u304d\u307e\u3059\u3002 $ mkdir docker/nginx $ vi docker/nginx/default.conf.template server { listen 80 ; add_header X-Frame-Options \"SAMEORIGIN\" ; add_header X-XSS-Protection \"1 ; mode=block\" ; add_header X-Content-Type-Options \"nosniff\" ; root /var/www/html/public/ ; charset utf-8 ; location = /favicon.ico { access_log off ; log_not_found off ; } location = /robots.txt { access_log off ; log_not_found off ; } location / { try_files $uri /index.php? $query_string ; } location ~ [^/]\\.php(/|$) { fastcgi_pass ${PHP_HOST}:9000 ; fastcgi_split_path_info ^(.+?\\.php)(/.*) $ ; fastcgi_index index.php ; fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name ; fastcgi_param PATH_INFO $fastcgi_path_info ; fastcgi_param REQUEST_FILENAME $request_filename ; include fastcgi_params ; } } nginx\u7528Dockerfile\u306e\u8a18\u8f09\u3092\u884c\u3044\u307e\u3059\u3002 FROM nginx:1.15-alpine COPY public /var/www/html/public COPY docker/nginx/default.conf.template /etc/nginx/conf.d/default.conf.template ENV PHP_HOST = 127 .0.0.1 EXPOSE 80 CMD /bin/sh -c 'sed \"s/\\${PHP_HOST}/${PHP_HOST}/\" /etc/nginx/conf.d/default.conf.template > /etc/nginx/conf.d/default.conf && nginx -g \"daemon off;\"' nginx\u306f1\u70b9\u30dd\u30a4\u30f3\u30c8\u304c\u3042\u308a\u307e\u3059\u3002 \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30c9\u30e9\u30a4\u30d0\u306b\u3088\u3063\u3066DNS\u7d4c\u7531\u304b\u3089\u30ed\u30fc\u30ab\u30eb\u30db\u30b9\u30c8\u7d4c\u7531\u304b\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u304c\u7570\u306a\u308b\u305f\u3081\u3001 default.conf.template \u3067 ${PHP_HOST} \u3067\u4e00\u65e6\u5909\u6570(?)\u306b\u3057\u307e\u3059\u3002 fastcgi_pass ${PHP_HOST}:9000; \u305d\u3057\u3066Docker\u8d77\u52d5\u6642\u306b sed \u3067\u66f8\u304d\u63db\u3048\u307e\u3059\u3002 \u30c7\u30d5\u30a9\u30eb\u30c8\u306fDockerfile\u5185\u306e ENV PHP_HOST=127.0.0.1 \u306b\u3066 127.0.0.1 \u3092\u6307\u5b9a\u3057\u3066\u30ed\u30fc\u30ab\u30eb\u30db\u30b9\u30c8\u306b\u3057\u3066\u3044\u307e\u3059\u3002 CMD /bin/sh -c 'sed \"s/\\${PHP_HOST}/${PHP_HOST}/\" /etc/nginx/conf.d/default.conf.template > /etc/nginx/conf.d/default.conf && nginx -g \"daemon off;\"' \u6570\u304c\u591a\u3044\u5834\u5408 envsubst \u30b3\u30de\u30f3\u30c9\u3067\u3082\u826f\u3044\u306e\u3067\u3059\u304c\u30011\u7b87\u6240\u66f8\u304d\u63db\u3048\u308b\u3060\u3051\u306a\u3089\u30b7\u30f3\u30d7\u30eb\u306b sed \u306e\u65b9\u304c\u5206\u304b\u308a\u3084\u3059\u3044\u3067\u3057\u3087\u3046\u3002 \u3053\u3053\u307e\u3067\u3067docker\u306e\u8a2d\u5b9a\u306f\u5b8c\u4e86\u3067\u3059\u3002","title":"nginx"},{"location":"laravel/docker-compose/#docker-compose","text":"\u5148\u307b\u3069\u4f5c\u6210\u3057\u305fDockerfile\u3068\u5404\u7a2e\u8a2d\u5b9a\u3092\u8aad\u307f\u8fbc\u3080docker-compose\u306e\u8a2d\u5b9a\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002 $ vi docker-compose.yaml version : '3.7' services : nginx : build : context : . dockerfile : docker/nginx/Dockerfile volumes : - ./public:/var/www/html/public:ro ports : - 8001:80 environment : PHP_HOST : app app : build : . env_file : - .env.example volumes : - .:/var/www/html:cached mysql : image : mysql:5.7 volumes : - ./mysql:/var/lib/mysql:delegated command : mysqld --character-set-server=utf8mb4 --collation-server=utf8mb4_general_ci environment : MYSQL_ALLOW_EMPTY_PASSWORD : 'yes' MYSQL_DATABASE : 'app' ports : - 3306 \u8a18\u8ff0\u3057\u304a\u308f\u3063\u305f\u3089\u8d77\u52d5\u3057\u3001\u52d5\u4f5c\u78ba\u8a8d\u3092\u3057\u307e\u3059\u3002 $ docker-compose up http://localhost:8001 Laravel\u306e\u30a6\u30a7\u30eb\u30ab\u30e0\u30da\u30fc\u30b8\u304c\u8868\u793a\u3055\u308c\u308c\u3070\u6210\u529f\u3067\u3059\uff01","title":"docker-compose"},{"location":"laravel/docker-compose/#mysql","text":"\u3053\u3053\u304b\u3089\u306fLaravel\u3068MySQL\u3092\u9023\u643a\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002","title":"MySQL\u3092\u4f7f\u7528\u3059\u308b"},{"location":"laravel/docker-compose/#migrate","text":"\u8d77\u52d5\u3057\u3066\u3044\u308bdocker-compose\u3092\u305d\u306e\u307e\u307e\u306b\u3001\u5225\u306e\u30bf\u30fc\u30df\u30ca\u30eb\u3092\u958b\u3044\u3066\u64cd\u4f5c\u3057\u307e\u3059\u3002 \u307e\u305a\u306fmigrate\u306e\u5b9f\u884c\u3092\u884c\u3044\u307e\u3059\u3002 \u65e2\u306b\u8d77\u52d5\u3057\u3066\u3044\u308bDocker\u30b3\u30f3\u30c6\u30ca\u306e\u4e2d\u3067 php \u30b3\u30de\u30f3\u30c9\u3092\u6253\u3063\u3066migrate\u3092\u884c\u3044\u307e\u3059\u3002 $ cd /path/to/introduction-terraform-example/laravel $ docker-compose exec app php artisan migrate","title":"migrate\u306e\u5b9f\u884c"},{"location":"laravel/docker-compose/#api","text":"\u307e\u305a\u306f /api/books \u306e\u30d1\u30b9\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u3001\u4f55\u3082\u5e30\u3063\u3066\u3053\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002 $ curl localhost:8001/api/books [] \u4f55\u56de\u304bPOST\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9001\u3063\u3066\u3001\u30c7\u30fc\u30bf\u3092\u5897\u3084\u3057\u3066\u307f\u307e\u3059\u3002 $ curl -X POST localhost:8001/api/books { \"title\": \"Ramiro Bernhard\", \"updated_at\": \"2019-03-20 04:59:05\", \"created_at\": \"2019-03-20 04:59:05\", \"id\": 1 } $ curl -X POST localhost:8001/api/books { \"title\": \"Ramiro Bernhard\", \"updated_at\": \"2019-03-20 04:59:05\", \"created_at\": \"2019-03-20 04:59:05\", \"id\": 2 } : \u6700\u5f8c\u306b /api/books \u3078GET\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9001\u308a\u3001MySQL\u3078\u30c7\u30fc\u30bf\u304c\u683c\u7d0d\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002 $ curl localhost:8001/api/books [ { \"id\": 1, \"title\": \"Ramiro Bernhard\", \"created_at\": \"2019-03-20 04:59:05\", \"updated_at\": \"2019-03-20 04:59:05\" }, { \"id\": 2, \"title\": \"Mr. Ford Nitzsche\", \"created_at\": \"2019-03-20 05:00:36\", \"updated_at\": \"2019-03-20 05:00:36\" } ]","title":"API\u306e\u52d5\u4f5c\u78ba\u8a8d"},{"location":"laravel/docker-compose/#mysql_1","text":"Docker\u30b3\u30f3\u30c6\u30ca\u4e0a\u3067\u52d5\u304b\u3057\u3066\u3044\u308bMySQL\u3078\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u307f\u307e\u3059\u3002 $ docker-compose exec mysql mysql Your MySQL connection id is 8 Server version: 5.7.25 MySQL Community Server (GPL) Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql> MySQL\u306e\u516c\u5f0fDocker Image \u306f\u74b0\u5883\u5909\u6570\u3067\u5b9a\u7fa9\u3057\u305f app \u3068\u3044\u3046\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002 MySQL\u30b3\u30f3\u30c6\u30ca\u306e\u4e2d\u306b\u5165\u308a\u3001 app \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u30c6\u30fc\u30d6\u30eb\u3092\u4e00\u89a7\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002 mysql> use mysql Reading table information for completion of table and column names You can turn off this feature to get a quicker startup with -A Database changed mysql> show tables; +-----------------+ | Tables_in_app | +-----------------+ | books | | migrations | | password_resets | | users | +-----------------+ 4 rows in set (0.00 sec)","title":"MySQL\u306e\u4e2d\u306b\u5165\u3063\u3066\u307f\u308b"},{"location":"laravel/ecr/","text":"\u3053\u306e\u7ae0\u306e\u76ee\u6a19 \u00b6 \u3053\u306e\u7ae0\u3067\u306fLaravel\u3092\u7acb\u3061\u4e0a\u3052\u308b\u305f\u3081\u306bDocker\u306e\u6e96\u5099\u3092\u884c\u3044\u307e\u3059\u3002 \u3084\u308b\u3053\u3068 \u00b6 ECR\u306e\u4f5c\u6210 docker\u306e\u30d3\u30eb\u30c9 \u30db\u30b9\u30c8\u30de\u30b7\u30f3\u3067\u3084\u308b\u7684\u306a\u3053\u3068 ECR\u3078\u306epush aws cli \u306e\u30ed\u30b0\u30a4\u30f3 ECR\u306e\u4f5c\u6210 \u00b6 Docker\u306e\u4fdd\u7ba1\u306b\u306fAWS\u306eDocker\u30de\u30cd\u30fc\u30b8\u30c9\u30b5\u30fc\u30d3\u30b9\u3067\u3042\u308b \"Elastic Container Registry\" \u3092\u4f7f\u7528\u3057\u307e\u3059\u3002 \u30a4\u30e1\u30fc\u30b8\u3068\u3057\u3066\u306fDockerHub\u306eAWS\u7248\u306e\u3088\u3046\u306a\u3082\u306e\u3067\u3059\u3002 \u524d\u63d0\u3068\u3057\u3066\u306fECR\u3092Terraform\u3067\u7ba1\u7406\u3057\u307e\u305b\u3093\u3002 Terraform\u306f1\u74b0\u5883(STG/PRD\u6bce)\u306e\u5b9a\u7fa9\u306e\u305f\u3081\u306b\u4f7f\u7528\u3057\u307e\u3059\u304c\u3001Docker\u30a4\u30e1\u30fc\u30b8\u306f\u4e00\u822c\u7684\u306b\u8907\u6570\u74b0\u5883\u306b\u307e\u305f\u304c\u3063\u3066\u5171\u901a\u306e\u3082\u306e\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002 IaC\u306f\u975e\u5e38\u306b\u4fbf\u5229\u3067\u3059\u304c\u3001100%\u30b3\u30fc\u30c9\u5316\u3059\u308b\u3079\u304d\u306a\u306e\u304b\u306f\u9069\u5b9c\u5224\u65ad\u3057\u307e\u3057\u3087\u3046\u3002 ECR\u306fAWS\u30b3\u30de\u30f3\u30c9\u304b\u3089\u4f5c\u6210\u3057\u307e\u3059\u3002 nginx \u3068 app (Laravel)'\u306e2\u3064\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002 $ aws ecr create-repository --repository-name nginx $ aws ecr create-repository --repository-name app \u4f5c\u6210\u3055\u308c\u305f\u304b\u306e\u78ba\u8a8d\u3057\u307e\u3059\u3002 $ aws ecr describe-repositories --query 'repositories[].repositoryName' [ \"nginx\", \"app\" ] Docker\u306e\u30d3\u30eb\u30c9 \u00b6 \u30cf\u30f3\u30ba\u30aa\u30f3\u30ea\u30dd\u30b8\u30c8\u30ea\u3078\u30c1\u30a7\u30c3\u30af\u30a2\u30a6\u30c8 $ cd /path/to/introduction-terraform-example/laravel nginx\u306e\u30d3\u30eb\u30c9 $ export ECR_URI_NGINX = $( aws ecr describe-repositories --repository-names nginx --query 'repositories[0].repositoryUri' --output text ) $ docker build -t ${ ECR_URI_NGINX } -f docker/nginx/Dockerfile . Laravel\u306e\u30d3\u30eb\u30c9 $ export ECR_URI_APP = $( aws ecr describe-repositories --repository-names app --query 'repositories[0].repositoryUri' --output text ) $ docker build -t ${ ECR_URI_APP } . ECR\u3078\u306epush \u00b6 ECR\u3078\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002 $ $( aws ecr get-login --no-include-email ) nginx\u306epush $ docker push ${ ECR_URI_NGINX } Laravel\u306epush $ docker push ${ ECR_URI_APP }","title":"ECR"},{"location":"laravel/ecr/#_1","text":"\u3053\u306e\u7ae0\u3067\u306fLaravel\u3092\u7acb\u3061\u4e0a\u3052\u308b\u305f\u3081\u306bDocker\u306e\u6e96\u5099\u3092\u884c\u3044\u307e\u3059\u3002","title":"\u3053\u306e\u7ae0\u306e\u76ee\u6a19"},{"location":"laravel/ecr/#_2","text":"ECR\u306e\u4f5c\u6210 docker\u306e\u30d3\u30eb\u30c9 \u30db\u30b9\u30c8\u30de\u30b7\u30f3\u3067\u3084\u308b\u7684\u306a\u3053\u3068 ECR\u3078\u306epush aws cli \u306e\u30ed\u30b0\u30a4\u30f3","title":"\u3084\u308b\u3053\u3068"},{"location":"laravel/ecr/#ecr","text":"Docker\u306e\u4fdd\u7ba1\u306b\u306fAWS\u306eDocker\u30de\u30cd\u30fc\u30b8\u30c9\u30b5\u30fc\u30d3\u30b9\u3067\u3042\u308b \"Elastic Container Registry\" \u3092\u4f7f\u7528\u3057\u307e\u3059\u3002 \u30a4\u30e1\u30fc\u30b8\u3068\u3057\u3066\u306fDockerHub\u306eAWS\u7248\u306e\u3088\u3046\u306a\u3082\u306e\u3067\u3059\u3002 \u524d\u63d0\u3068\u3057\u3066\u306fECR\u3092Terraform\u3067\u7ba1\u7406\u3057\u307e\u305b\u3093\u3002 Terraform\u306f1\u74b0\u5883(STG/PRD\u6bce)\u306e\u5b9a\u7fa9\u306e\u305f\u3081\u306b\u4f7f\u7528\u3057\u307e\u3059\u304c\u3001Docker\u30a4\u30e1\u30fc\u30b8\u306f\u4e00\u822c\u7684\u306b\u8907\u6570\u74b0\u5883\u306b\u307e\u305f\u304c\u3063\u3066\u5171\u901a\u306e\u3082\u306e\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002 IaC\u306f\u975e\u5e38\u306b\u4fbf\u5229\u3067\u3059\u304c\u3001100%\u30b3\u30fc\u30c9\u5316\u3059\u308b\u3079\u304d\u306a\u306e\u304b\u306f\u9069\u5b9c\u5224\u65ad\u3057\u307e\u3057\u3087\u3046\u3002 ECR\u306fAWS\u30b3\u30de\u30f3\u30c9\u304b\u3089\u4f5c\u6210\u3057\u307e\u3059\u3002 nginx \u3068 app (Laravel)'\u306e2\u3064\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002 $ aws ecr create-repository --repository-name nginx $ aws ecr create-repository --repository-name app \u4f5c\u6210\u3055\u308c\u305f\u304b\u306e\u78ba\u8a8d\u3057\u307e\u3059\u3002 $ aws ecr describe-repositories --query 'repositories[].repositoryName' [ \"nginx\", \"app\" ]","title":"ECR\u306e\u4f5c\u6210"},{"location":"laravel/ecr/#docker","text":"\u30cf\u30f3\u30ba\u30aa\u30f3\u30ea\u30dd\u30b8\u30c8\u30ea\u3078\u30c1\u30a7\u30c3\u30af\u30a2\u30a6\u30c8 $ cd /path/to/introduction-terraform-example/laravel nginx\u306e\u30d3\u30eb\u30c9 $ export ECR_URI_NGINX = $( aws ecr describe-repositories --repository-names nginx --query 'repositories[0].repositoryUri' --output text ) $ docker build -t ${ ECR_URI_NGINX } -f docker/nginx/Dockerfile . Laravel\u306e\u30d3\u30eb\u30c9 $ export ECR_URI_APP = $( aws ecr describe-repositories --repository-names app --query 'repositories[0].repositoryUri' --output text ) $ docker build -t ${ ECR_URI_APP } .","title":"Docker\u306e\u30d3\u30eb\u30c9"},{"location":"laravel/ecr/#ecrpush","text":"ECR\u3078\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002 $ $( aws ecr get-login --no-include-email ) nginx\u306epush $ docker push ${ ECR_URI_NGINX } Laravel\u306epush $ docker push ${ ECR_URI_APP }","title":"ECR\u3078\u306epush"},{"location":"laravel/ecs/","text":"\u3053\u306e\u7ae0\u306e\u76ee\u6a19 \u00b6 \u3053\u306e\u7ae0\u3067\u306fLaravel\u306e\u8d77\u52d5\u3092\u76ee\u6a19\u306b\u3057\u307e\u3059 \u30ea\u30bd\u30fc\u30b9 \u00b6 ECS Service Task Definition IAM Role Cloud Watch Log Group Security Group \u30b3\u30fc\u30c9 \u00b6 \u9577\u304f\u306a\u308a\u307e\u3059\u304c\u3001\u30b3\u30fc\u30c9\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002 ./main.tf module \"ecs_laravel\" { source = \"./ecs_laravel\" name = \"${var.name}\" cluster_name = \"${module.ecs_cluster.cluster_name}\" vpc_id = \"${module.network.vpc_id}\" subnet_ids = \"${module.network.private_subnet_ids}\" https_listener_arn = \"${module.elb.https_listener_arn}\" db_host = \"${module.rds.endpoint}\" db_username = \"myusername\" db_password = \"mypassword\" db_database = \"mydatabase\" app_key = \"base64:p5Fu8gRUOuPUXzY3VcxpnYsUR9f2h8nTSm5JlYkzPTM=\" } ./ecs_laravel/main.tf variable \"name\" { type = \"string\" } variable \"vpc_id\" { type = \"string\" } variable \"https_listener_arn\" { type = \"string\" } variable \"cluster_name\" { type = \"string\" } variable \"subnet_ids\" { type = \"list\" } variable \"db_host\" { type = \"string\" } variable \"db_username\" { type = \"string\" } variable \"db_password\" { type = \"string\" } variable \"db_database\" { type = \"string\" } variable \"app_key\" { type = \"string\" } data \"aws_region\" \"current\" {} data \"aws_caller_identity\" \"current\" {} locals { name = \"${var.name}-laravel\" # \u30a2\u30ab\u30a6\u30f3\u30c8ID account_id = \"${data.aws_caller_identity.current.account_id}\" # \u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u3092\u5b9f\u884c\u3059\u308b\u30ea\u30fc\u30b8\u30e7\u30f3 region = \"${data.aws_region.current.name}\" } resource \"aws_lb_target_group\" \"this\" { name = \"${local.name}\" vpc_id = \"${var.vpc_id}\" port = 80 target_type = \"ip\" protocol = \"HTTP\" health_check = { port = 80 } } data \"template_file\" \"container_definitions\" { template = \"${file(\" . / ecs_laravel / container_definitions . json \")}\" vars = { tag = \"latest\" account_id = \"${local.account_id}\" region = \"${local.region}\" name = \"${local.name}\" db_host = \"${var.db_host}\" db_username = \"${var.db_username}\" db_password = \"${var.db_password}\" db_database = \"${var.db_database}\" app_key = \"${var.app_key}\" } } resource \"aws_ecs_task_definition\" \"this\" { family = \"${local.name}\" container_definitions = \"${data.template_file.container_definitions.rendered}\" cpu = \"256\" memory = \"512\" network_mode = \"awsvpc\" requires_compatibilities = [ \"FARGATE\" ] task_role_arn = \"${aws_iam_role.task_execution.arn}\" execution_role_arn = \"${aws_iam_role.task_execution.arn}\" } resource \"aws_cloudwatch_log_group\" \"this\" { name = \"/${var.name}/ecs\" retention_in_days = \"7\" } resource \"aws_iam_role\" \"task_execution\" { name = \"${var.name}-TaskExecution\" assume_role_policy = << EOF { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Action\": \"sts:AssumeRole\", \"Principal\": { \"Service\": \"ecs-tasks.amazonaws.com\" }, \"Effect\": \"Allow\", \"Sid\": \"\" } ] } EOF } resource \"aws_iam_role_policy\" \"task_execution\" { role = \"${aws_iam_role.task_execution.id}\" policy = << EOF { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Action\": [ \"logs:CreateLogGroup\", \"logs:CreateLogStream\", \"logs:PutLogEvents\", \"logs:DescribeLogGroups\", \"logs:DescribeLogStreams\" ], \"Effect\": \"Allow\", \"Resource\": \"*\" } ] } EOF } resource \"aws_iam_role_policy_attachment\" \"task_execution\" { role = \"${aws_iam_role.task_execution.name}\" policy_arn = \"arn:aws:iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy\" } resource \"aws_lb_listener_rule\" \"this\" { listener_arn = \"${var.https_listener_arn}\" action { type = \"forward\" target_group_arn = \"${aws_lb_target_group.this.id}\" } condition { field = \"path-pattern\" values = [ \"*\" ] } } resource \"aws_security_group\" \"this\" { name = \"${local.name}\" description = \"${local.name}\" vpc_id = \"${var.vpc_id}\" egress { from_port = 0 to_port = 0 protocol = \"-1\" cidr_blocks = [ \"0.0.0.0/0\" ] } tags = { Name = \"${local.name}\" } } resource \"aws_security_group_rule\" \"this_http\" { security_group_id = \"${aws_security_group.this.id}\" type = \"ingress\" from_port = 80 to_port = 80 protocol = \"tcp\" cidr_blocks = [ \"0.0.0.0/0\" ] } resource \"aws_ecs_service\" \"this\" { depends_on = [ \"aws_lb_listener_rule.this\" ] name = \"${local.name}\" launch_type = \"FARGATE\" desired_count = 1 cluster = \"${var.cluster_name}\" task_definition = \"${aws_ecs_task_definition.this.arn}\" network_configuration = { subnets = [ \"${var.subnet_ids}\" ] security_groups = [ \"${aws_security_group.this.id}\" ] } load_balancer = [ { target_group_arn = \"${aws_lb_target_group.this.arn}\" container_name = \"nginx\" container_port = \"80\" }, ] } \u52d5\u4f5c\u78ba\u8a8d \u00b6 \u5b9f\u969b\u306b\u30c9\u30e1\u30a4\u30f3\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3001Laravel\u306e\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u308c\u3070\u6210\u529f\u3067\u3059 DB\u3078\u306emigration \u00b6 \u30cf\u30f3\u30ba\u30aa\u30f3\u3067\u306e\u30ef\u30f3\u30aa\u30d5\u306e\u5b9f\u884c\u306a\u306e\u3067\u3001GUI\u304b\u3089\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002 \u5b9f\u969b\u306b\u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u3067\u884c\u3046\u969b\u306b\u306f\u30b9\u30af\u30ea\u30d7\u30c8\u3084\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306e\u4e2d\u306b\u7d44\u307f\u8fbc\u3080\u306e\u304c\u826f\u3044\u3067\u3059\u304c\u3001migration\u3092\u672c\u5f53\u306b\u81ea\u52d5\u7684\u306b\u5b9f\u884c\u3057\u3066\u826f\u3044\u306e\u304b\u306f\u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u306b\u3088\u3063\u3066\u5909\u308f\u308a\u307e\u3059\u3002\u30d7\u30ed\u30c0\u30af\u30c8\u306e\u6027\u8cea\u306b\u3088\u3063\u3066migration\u306e\u65b9\u6cd5\u306f\u9078\u629e\u3057\u307e\u3057\u3087\u3046\u3002 ECS\u30b3\u30f3\u30bd\u30fc\u30eb\u306b\u5165\u308a\u3001\u8d77\u52d5\u4e2d\u306e\u30bf\u30b9\u30af\u3092\u9078\u629e\u3057\u307e\u3059\u3002 \u300c\u540c\u69d8\u306e\u3082\u306e\u3092\u5b9f\u884c\u300d\u3067\u8d77\u52d5\u4e2d\u306e\u30bf\u30b9\u30af\u3092\u5143\u306b\u65b0\u3057\u3044\u30bf\u30b9\u30af\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002 php artisan migrate \u3092\u5b9f\u884c\u3059\u308b\u305f\u3081\u306b\u3001\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002 \u8d77\u52d5\u30bf\u30a4\u30d7: FARGATE \u30af\u30e9\u30b9\u30bf\u30fcVPC: <\u30cf\u30f3\u30ba\u30aa\u30f3\u3067\u4f5c\u6210\u3057\u305fVPC> \u30b5\u30d6\u30cd\u30c3\u30c8: <\u30cf\u30f3\u30ba\u30aa\u30f3\u3067\u4f5c\u6210\u3057\u305f \u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8 > \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30fc\u30b0\u30eb\u30fc\u30d7: <\u30cf\u30f3\u30ba\u30aa\u30f3\u3067\u4f5c\u6210\u3057\u305f ECS Service\u7528\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30fc\u30b0\u30eb\u30fc\u30d7 > \u30d1\u30d6\u30ea\u30c3\u30afIP\u306e\u81ea\u52d5\u5272\u308a\u5f53\u3066: DISABLE \u30b3\u30f3\u30c6\u30ca\u306e\u4e0a\u66f8\u304d \u30b3\u30de\u30f3\u30c9\u306e\u4e0a\u66f8\u304d: php,artisan,migrate,--force \u5165\u529b\u5f8c\u3001\u300c\u30bf\u30b9\u30af\u306e\u5b9f\u884c\u300d\u3092\u62bc\u4e0b\u3057\u307e\u3059\u3002 migration\u7d50\u679c\u306e\u78ba\u8a8d \u52d5\u4f5c\u78ba\u8a8d \u00b6 $ curl <YOUR DNS NAME>/api/books [] $ curl -X POST <YOUR DNS NAME>/api/books { \"title\": \"tmp title\", \"updated_at\": \"2019-03-20 09:34:00\", \"created_at\": \"2019-03-20 09:34:00\", \"id\": 1 } $ curl -X POST <YOUR DNS NAME>/api/books { \"title\": \"tmp title\", \"updated_at\": \"2019-03-20 09:34:00\", \"created_at\": \"2019-03-20 09:34:00\", \"id\": 2 } $ curl <YOUR DNS NAME>/api/books [ { \"id\": 1, \"title\": \"tmp title\", \"created_at\": \"2019-03-20 09:33:53\", \"updated_at\": \"2019-03-20 09:33:53\" }, { \"id\": 2, \"title\": \"tmp title\", \"created_at\": \"2019-03-20 09:34:00\", \"updated_at\": \"2019-03-20 09:34:00\" } ]","title":"ECS"},{"location":"laravel/ecs/#_1","text":"\u3053\u306e\u7ae0\u3067\u306fLaravel\u306e\u8d77\u52d5\u3092\u76ee\u6a19\u306b\u3057\u307e\u3059","title":"\u3053\u306e\u7ae0\u306e\u76ee\u6a19"},{"location":"laravel/ecs/#_2","text":"ECS Service Task Definition IAM Role Cloud Watch Log Group Security Group","title":"\u30ea\u30bd\u30fc\u30b9"},{"location":"laravel/ecs/#_3","text":"\u9577\u304f\u306a\u308a\u307e\u3059\u304c\u3001\u30b3\u30fc\u30c9\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002 ./main.tf module \"ecs_laravel\" { source = \"./ecs_laravel\" name = \"${var.name}\" cluster_name = \"${module.ecs_cluster.cluster_name}\" vpc_id = \"${module.network.vpc_id}\" subnet_ids = \"${module.network.private_subnet_ids}\" https_listener_arn = \"${module.elb.https_listener_arn}\" db_host = \"${module.rds.endpoint}\" db_username = \"myusername\" db_password = \"mypassword\" db_database = \"mydatabase\" app_key = \"base64:p5Fu8gRUOuPUXzY3VcxpnYsUR9f2h8nTSm5JlYkzPTM=\" } ./ecs_laravel/main.tf variable \"name\" { type = \"string\" } variable \"vpc_id\" { type = \"string\" } variable \"https_listener_arn\" { type = \"string\" } variable \"cluster_name\" { type = \"string\" } variable \"subnet_ids\" { type = \"list\" } variable \"db_host\" { type = \"string\" } variable \"db_username\" { type = \"string\" } variable \"db_password\" { type = \"string\" } variable \"db_database\" { type = \"string\" } variable \"app_key\" { type = \"string\" } data \"aws_region\" \"current\" {} data \"aws_caller_identity\" \"current\" {} locals { name = \"${var.name}-laravel\" # \u30a2\u30ab\u30a6\u30f3\u30c8ID account_id = \"${data.aws_caller_identity.current.account_id}\" # \u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u3092\u5b9f\u884c\u3059\u308b\u30ea\u30fc\u30b8\u30e7\u30f3 region = \"${data.aws_region.current.name}\" } resource \"aws_lb_target_group\" \"this\" { name = \"${local.name}\" vpc_id = \"${var.vpc_id}\" port = 80 target_type = \"ip\" protocol = \"HTTP\" health_check = { port = 80 } } data \"template_file\" \"container_definitions\" { template = \"${file(\" . / ecs_laravel / container_definitions . json \")}\" vars = { tag = \"latest\" account_id = \"${local.account_id}\" region = \"${local.region}\" name = \"${local.name}\" db_host = \"${var.db_host}\" db_username = \"${var.db_username}\" db_password = \"${var.db_password}\" db_database = \"${var.db_database}\" app_key = \"${var.app_key}\" } } resource \"aws_ecs_task_definition\" \"this\" { family = \"${local.name}\" container_definitions = \"${data.template_file.container_definitions.rendered}\" cpu = \"256\" memory = \"512\" network_mode = \"awsvpc\" requires_compatibilities = [ \"FARGATE\" ] task_role_arn = \"${aws_iam_role.task_execution.arn}\" execution_role_arn = \"${aws_iam_role.task_execution.arn}\" } resource \"aws_cloudwatch_log_group\" \"this\" { name = \"/${var.name}/ecs\" retention_in_days = \"7\" } resource \"aws_iam_role\" \"task_execution\" { name = \"${var.name}-TaskExecution\" assume_role_policy = << EOF { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Action\": \"sts:AssumeRole\", \"Principal\": { \"Service\": \"ecs-tasks.amazonaws.com\" }, \"Effect\": \"Allow\", \"Sid\": \"\" } ] } EOF } resource \"aws_iam_role_policy\" \"task_execution\" { role = \"${aws_iam_role.task_execution.id}\" policy = << EOF { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Action\": [ \"logs:CreateLogGroup\", \"logs:CreateLogStream\", \"logs:PutLogEvents\", \"logs:DescribeLogGroups\", \"logs:DescribeLogStreams\" ], \"Effect\": \"Allow\", \"Resource\": \"*\" } ] } EOF } resource \"aws_iam_role_policy_attachment\" \"task_execution\" { role = \"${aws_iam_role.task_execution.name}\" policy_arn = \"arn:aws:iam::aws:policy/service-role/AmazonECSTaskExecutionRolePolicy\" } resource \"aws_lb_listener_rule\" \"this\" { listener_arn = \"${var.https_listener_arn}\" action { type = \"forward\" target_group_arn = \"${aws_lb_target_group.this.id}\" } condition { field = \"path-pattern\" values = [ \"*\" ] } } resource \"aws_security_group\" \"this\" { name = \"${local.name}\" description = \"${local.name}\" vpc_id = \"${var.vpc_id}\" egress { from_port = 0 to_port = 0 protocol = \"-1\" cidr_blocks = [ \"0.0.0.0/0\" ] } tags = { Name = \"${local.name}\" } } resource \"aws_security_group_rule\" \"this_http\" { security_group_id = \"${aws_security_group.this.id}\" type = \"ingress\" from_port = 80 to_port = 80 protocol = \"tcp\" cidr_blocks = [ \"0.0.0.0/0\" ] } resource \"aws_ecs_service\" \"this\" { depends_on = [ \"aws_lb_listener_rule.this\" ] name = \"${local.name}\" launch_type = \"FARGATE\" desired_count = 1 cluster = \"${var.cluster_name}\" task_definition = \"${aws_ecs_task_definition.this.arn}\" network_configuration = { subnets = [ \"${var.subnet_ids}\" ] security_groups = [ \"${aws_security_group.this.id}\" ] } load_balancer = [ { target_group_arn = \"${aws_lb_target_group.this.arn}\" container_name = \"nginx\" container_port = \"80\" }, ] }","title":"\u30b3\u30fc\u30c9"},{"location":"laravel/ecs/#_4","text":"\u5b9f\u969b\u306b\u30c9\u30e1\u30a4\u30f3\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3001Laravel\u306e\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u308c\u3070\u6210\u529f\u3067\u3059","title":"\u52d5\u4f5c\u78ba\u8a8d"},{"location":"laravel/ecs/#dbmigration","text":"\u30cf\u30f3\u30ba\u30aa\u30f3\u3067\u306e\u30ef\u30f3\u30aa\u30d5\u306e\u5b9f\u884c\u306a\u306e\u3067\u3001GUI\u304b\u3089\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002 \u5b9f\u969b\u306b\u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u3067\u884c\u3046\u969b\u306b\u306f\u30b9\u30af\u30ea\u30d7\u30c8\u3084\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306e\u4e2d\u306b\u7d44\u307f\u8fbc\u3080\u306e\u304c\u826f\u3044\u3067\u3059\u304c\u3001migration\u3092\u672c\u5f53\u306b\u81ea\u52d5\u7684\u306b\u5b9f\u884c\u3057\u3066\u826f\u3044\u306e\u304b\u306f\u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u306b\u3088\u3063\u3066\u5909\u308f\u308a\u307e\u3059\u3002\u30d7\u30ed\u30c0\u30af\u30c8\u306e\u6027\u8cea\u306b\u3088\u3063\u3066migration\u306e\u65b9\u6cd5\u306f\u9078\u629e\u3057\u307e\u3057\u3087\u3046\u3002 ECS\u30b3\u30f3\u30bd\u30fc\u30eb\u306b\u5165\u308a\u3001\u8d77\u52d5\u4e2d\u306e\u30bf\u30b9\u30af\u3092\u9078\u629e\u3057\u307e\u3059\u3002 \u300c\u540c\u69d8\u306e\u3082\u306e\u3092\u5b9f\u884c\u300d\u3067\u8d77\u52d5\u4e2d\u306e\u30bf\u30b9\u30af\u3092\u5143\u306b\u65b0\u3057\u3044\u30bf\u30b9\u30af\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002 php artisan migrate \u3092\u5b9f\u884c\u3059\u308b\u305f\u3081\u306b\u3001\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002 \u8d77\u52d5\u30bf\u30a4\u30d7: FARGATE \u30af\u30e9\u30b9\u30bf\u30fcVPC: <\u30cf\u30f3\u30ba\u30aa\u30f3\u3067\u4f5c\u6210\u3057\u305fVPC> \u30b5\u30d6\u30cd\u30c3\u30c8: <\u30cf\u30f3\u30ba\u30aa\u30f3\u3067\u4f5c\u6210\u3057\u305f \u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8 > \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30fc\u30b0\u30eb\u30fc\u30d7: <\u30cf\u30f3\u30ba\u30aa\u30f3\u3067\u4f5c\u6210\u3057\u305f ECS Service\u7528\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30fc\u30b0\u30eb\u30fc\u30d7 > \u30d1\u30d6\u30ea\u30c3\u30afIP\u306e\u81ea\u52d5\u5272\u308a\u5f53\u3066: DISABLE \u30b3\u30f3\u30c6\u30ca\u306e\u4e0a\u66f8\u304d \u30b3\u30de\u30f3\u30c9\u306e\u4e0a\u66f8\u304d: php,artisan,migrate,--force \u5165\u529b\u5f8c\u3001\u300c\u30bf\u30b9\u30af\u306e\u5b9f\u884c\u300d\u3092\u62bc\u4e0b\u3057\u307e\u3059\u3002 migration\u7d50\u679c\u306e\u78ba\u8a8d","title":"DB\u3078\u306emigration"},{"location":"laravel/ecs/#_5","text":"$ curl <YOUR DNS NAME>/api/books [] $ curl -X POST <YOUR DNS NAME>/api/books { \"title\": \"tmp title\", \"updated_at\": \"2019-03-20 09:34:00\", \"created_at\": \"2019-03-20 09:34:00\", \"id\": 1 } $ curl -X POST <YOUR DNS NAME>/api/books { \"title\": \"tmp title\", \"updated_at\": \"2019-03-20 09:34:00\", \"created_at\": \"2019-03-20 09:34:00\", \"id\": 2 } $ curl <YOUR DNS NAME>/api/books [ { \"id\": 1, \"title\": \"tmp title\", \"created_at\": \"2019-03-20 09:33:53\", \"updated_at\": \"2019-03-20 09:33:53\" }, { \"id\": 2, \"title\": \"tmp title\", \"created_at\": \"2019-03-20 09:34:00\", \"updated_at\": \"2019-03-20 09:34:00\" } ]","title":"\u52d5\u4f5c\u78ba\u8a8d"},{"location":"laravel/rds/","text":"\u3053\u306e\u7ae0\u306e\u76ee\u6a19 \u00b6 \u3053\u306e\u7ae0\u3067\u306fAWS\u306e\u30de\u30cd\u30fc\u30b8\u30c9\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3067\u3042\u308bAurora(MySQL)\u306e\u8d77\u52d5\u3092\u884c\u3044\u307e\u3059\u3002 \u30ea\u30bd\u30fc\u30b9 \u00b6 Subnet Group Parameter Group Cluster Parameter Group Aurora Cluster Aurora Instance \u30b3\u30fc\u30c9 \u00b6 ./main.tf : module \"rds\" { source = \"./rds\" name = \"${var.name}\" vpc_id = \"${module.network.vpc_id}\" subnet_ids = \"${module.network.private_subnet_ids}\" database_name = \"mydatabase\" master_username = \"myusername\" master_password = \"mypassword\" } ./rds/main.tf variable \"name\" { type = \"string\" } variable \"vpc_id\" { type = \"string\" } variable \"subnet_ids\" { type = \"list\" } variable \"database_name\" { type = \"string\" } variable \"master_username\" { type = \"string\" } variable \"master_password\" { type = \"string\" } locals { name = \"${var.name}-mysql\" } resource \"aws_security_group\" \"this\" { name = \"${local.name}\" description = \"${local.name}\" vpc_id = \"${var.vpc_id}\" egress { from_port = 0 to_port = 0 protocol = \"-1\" cidr_blocks = [ \"0.0.0.0/0\" ] } tags = { Name = \"${local.name}\" } } resource \"aws_security_group_rule\" \"mysql\" { security_group_id = \"${aws_security_group.this.id}\" type = \"ingress\" from_port = 3306 to_port = 3306 protocol = \"tcp\" cidr_blocks = [ \"10.0.0.0/16\" ] } resource \"aws_db_subnet_group\" \"this\" { name = \"${local.name}\" description = \"${local.name}\" subnet_ids = [ \"${var.subnet_ids}\" ] } resource \"aws_rds_cluster\" \"this\" { cluster_identifier = \"${local.name}\" db_subnet_group_name = \"${aws_db_subnet_group.this.name}\" vpc_security_group_ids = [ \"${aws_security_group.this.id}\" ] engine = \"aurora-mysql\" port = \"3306\" database_name = \"${var.database_name}\" master_username = \"${var.master_username}\" master_password = \"${var.master_password}\" } resource \"aws_rds_cluster_instance\" \"this\" { identifier = \"${local.name}\" cluster_identifier = \"${aws_rds_cluster.this.id}\" engine = \"aurora-mysql\" instance_class = \"db.t3.small\" } output \"endpoint\" { value = \"${aws_rds_cluster.this.endpoint}\" }","title":"RDS"},{"location":"laravel/rds/#_1","text":"\u3053\u306e\u7ae0\u3067\u306fAWS\u306e\u30de\u30cd\u30fc\u30b8\u30c9\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3067\u3042\u308bAurora(MySQL)\u306e\u8d77\u52d5\u3092\u884c\u3044\u307e\u3059\u3002","title":"\u3053\u306e\u7ae0\u306e\u76ee\u6a19"},{"location":"laravel/rds/#_2","text":"Subnet Group Parameter Group Cluster Parameter Group Aurora Cluster Aurora Instance","title":"\u30ea\u30bd\u30fc\u30b9"},{"location":"laravel/rds/#_3","text":"./main.tf : module \"rds\" { source = \"./rds\" name = \"${var.name}\" vpc_id = \"${module.network.vpc_id}\" subnet_ids = \"${module.network.private_subnet_ids}\" database_name = \"mydatabase\" master_username = \"myusername\" master_password = \"mypassword\" } ./rds/main.tf variable \"name\" { type = \"string\" } variable \"vpc_id\" { type = \"string\" } variable \"subnet_ids\" { type = \"list\" } variable \"database_name\" { type = \"string\" } variable \"master_username\" { type = \"string\" } variable \"master_password\" { type = \"string\" } locals { name = \"${var.name}-mysql\" } resource \"aws_security_group\" \"this\" { name = \"${local.name}\" description = \"${local.name}\" vpc_id = \"${var.vpc_id}\" egress { from_port = 0 to_port = 0 protocol = \"-1\" cidr_blocks = [ \"0.0.0.0/0\" ] } tags = { Name = \"${local.name}\" } } resource \"aws_security_group_rule\" \"mysql\" { security_group_id = \"${aws_security_group.this.id}\" type = \"ingress\" from_port = 3306 to_port = 3306 protocol = \"tcp\" cidr_blocks = [ \"10.0.0.0/16\" ] } resource \"aws_db_subnet_group\" \"this\" { name = \"${local.name}\" description = \"${local.name}\" subnet_ids = [ \"${var.subnet_ids}\" ] } resource \"aws_rds_cluster\" \"this\" { cluster_identifier = \"${local.name}\" db_subnet_group_name = \"${aws_db_subnet_group.this.name}\" vpc_security_group_ids = [ \"${aws_security_group.this.id}\" ] engine = \"aurora-mysql\" port = \"3306\" database_name = \"${var.database_name}\" master_username = \"${var.master_username}\" master_password = \"${var.master_password}\" } resource \"aws_rds_cluster_instance\" \"this\" { identifier = \"${local.name}\" cluster_identifier = \"${aws_rds_cluster.this.id}\" engine = \"aurora-mysql\" instance_class = \"db.t3.small\" } output \"endpoint\" { value = \"${aws_rds_cluster.this.endpoint}\" }","title":"\u30b3\u30fc\u30c9"}]}